(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([[4252],{78303:(e,t,o)=>{"use strict";o.d(t,{L:()=>u,P:()=>l});var r=o(3285),n=o(78914),i=o(11524),a=o(45060),s=o(24008),c=o(87340);const l="local-dockerfile",u=e=>{const{dispatch:t,getState:o}=e.store,u=o().user.is_anonymous,d=!s.clientConfig.runtimeConfig.IS_SINGLE_TENANCY,p=!o().project.environment_id||o().project.environment_id===l||d,f={async fetchCustomEnvironments(){const e=o().project.id,n=await fetch(`/api/project/${e}/environments`,{method:"GET",credentials:"include",headers:{"Content-Type":"application/json"}});if(!n.ok)return c.Z.error({message:"Failed to fetch list of available environments for the project. Please try again later or contact our support."}),void(0,r.D)(new Error(`[/api/project/${e}]/environments] failed with ${n.statusText}`),"error");const i=[...(await n.json()).environments,...p?[{name:"Local ./Dockerfile",id:l,link:"./Dockerfile",is_public:!0}]:[]];t({type:"SET_ENVIRONMENTS",list:i})},async changeProjectEnvironment(s){if(u)return void e.modalApi.openModal({newModal:a.Qi.SIGN_IN_MODAL,title:"Sign up to run code"});const d=o().project.id;t({type:"SET_ENV_LOADING",value:!0});const p=await fetch(`/api/project/${d}/environment`,{method:"PUT",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({environment_id:s===l?null:s})});if(!p.ok)return c.Z.error({message:"Failed to change project's environment. Please try again later or contact our support."}),void(0,r.D)(new Error(`[/api/${d}]/environment/${s}] failed with ${p.statusText}`),"error");if(s===l){const t=o().filesystem.entities[n.oH];if(!(t&&(0,i.zE)(t)))try{await e.fileApi.generateDockerfile()}catch(e){c.Z.error({message:"Failed to generate Dockerfile. Please try again later or contact our support."}),(0,r.D)(e,"error")}e.projectFocusApi.focusDockerfile()}t({type:"SET_ENV_LOADING",value:!1}),s!==l&&t({type:"SET_IMAGE_IMPORTING",value:!0}),await e.projectApi.restartHardware(),await e.projectApi.refetchProject()},async deleteCustomEnvironment(e){const t=o().project.team_id,n=await fetch(`/api/environments/${e}`,{method:"DELETE",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({team_id:t})});if(!n.ok){const e=(await n.json()).error;return c.Z.error({message:null!=e?e:"We failed to delete the custom environment. Please try again later or contact our support."}),void(0,r.D)(new Error(`[/api/environments] failed with ${n.statusText}`),"error")}await f.fetchCustomEnvironments()},async createCustomEnvironment({link:e,name:t}){const n=o().project.team_id,i=await fetch("/api/environments",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({team_id:n,name:t||void 0,link:e||void 0})});if(!i.ok)throw c.Z.error({message:"We failed to create a custom environment. Please try again later or contact our support."}),(0,r.D)(new Error(`[/api/environments] failed with ${i.statusText}`),"error"),new Error("Failed to create a custom environment");await f.fetchCustomEnvironments();return await i.json()},async updateCustomEnvironment({id:e,link:t,name:o}){const n=await fetch(`/api/environments/${e}`,{method:"PUT",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:o||void 0,link:t||void 0})});if(!n.ok)return c.Z.error({message:"We failed to update a custom environment. Please try again later or contact our support."}),void(0,r.D)(new Error(`[/api/environments] failed with ${n.statusText}`),"error");await f.fetchCustomEnvironments()},setImageImporting(e){t({type:"SET_IMAGE_IMPORTING",value:e})}};return f}},35928:(e,t,o)=>{"use strict";o.d(t,{BO:()=>w,D:()=>_,KX:()=>k,Lu:()=>L,N4:()=>E,QK:()=>D,S6:()=>h,Vl:()=>m,Z2:()=>C,Z8:()=>v,d:()=>A,dG:()=>I,fA:()=>j,fT:()=>F,lH:()=>b,sb:()=>y,xR:()=>N});var r=o(72037),n=o(1067),i=o(14058),a=o(3285),s=o(55236),c=o(18434),l=o(62039),u=o(5707),d=o(2638);function p(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,r)}return o}function f(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?p(Object(o),!0).forEach((function(t){g(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):p(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}function g(e,t,o){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var o=e[Symbol.toPrimitive];if(void 0!==o){var r=o.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function h(e){var t,o,n;const i=null!==(t=e.existingCellCounts.sql)&&void 0!==t?t:0,a={cell_type:"sql",source:null!==(o=e.source)&&void 0!==o?o:`SELECT *\nFROM ${null!==(n=e.variableName)&&void 0!==n?n:"<dataframe variable name or path to a csv file>"}`,metadata:f({deepnote_variable_name:`df_${i+1}`},e.integrationId?{sql_integration_id:e.integrationId}:{}),outputs:[],execution_count:null,block_group:(0,r.EL)()};return f({cellId:e.id},a)}function m(e){return e&&(t=e)===(0,n.mk)(t)?e:null;var t}function y(e){return e[e.length-1]}function b(e,t){const o={deepnote_app_coordinates:e.metadata.deepnote_app_coordinates};if("code"===t){return{id:e.id,type:"code",version:e.version,sorting_key:e.sorting_key,block_group:e.block_group,metadata:"code"===e.type?e.metadata:f({},o),state:"code"===e.type?e.state:{execution_count:null},children:(0,c.J2)(e)?e.children:[{text:s.NB.string(e)}]}}if("markdown"===t){return{id:e.id,type:"markdown",version:e.version,sorting_key:e.sorting_key,block_group:e.block_group,metadata:"markdown"===e.type?e.metadata:f({},o),children:(0,c.J2)(e)?e.children:[{text:s.NB.string(e)}]}}if((0,i.UX)(t)){return{id:e.id,type:t,version:e.version,sorting_key:e.sorting_key,block_group:e.block_group,metadata:e.type===t?e.metadata:f(f({},o),{},{is_collapsed:!1}),children:e.children}}throw(0,n.UT)(t),new Error(`Invalid argument newType: ${t}`)}function v(e,t){var o;const r=null!==(o=null==t?void 0:t.getBoundingClientRect().height)&&void 0!==o?o:120,i=Math.max(0,Math.ceil(r/u.RA));switch(e){case"input-text":case"input-select":case"input-slider":case"input-date":return{x:0,y:0,w:8,h:4};case"text-cell-p":case"text-cell-bullet":case"text-cell-todo":case"text-cell-callout":return{x:0,y:0,w:8,h:2};case"text-cell-h1":case"text-cell-h2":case"text-cell-h3":case"markdown":case"image":case"code":case"visualization":case"sql":return{x:0,y:0,w:12,h:i};default:(0,n.vE)(e)}}function E(e,t){if(!t)return l.F;const o=e[t];return 0===(null==o?void 0:o.length)?l.F:o}function w(e){return!e||0===e.length}const k=(e,t)=>"leading"===t?e.replace(/^(\r\n|\n|\r)/,""):"trailing"===t?e.replace(/(\r\n|\n|\r)$/,""):(0,n.UT)(t),S=e=>"notebook-focused-cell-"+e,C=(e,t)=>{const o=S(e);t?(0,d.p)(o,t):(0,d.E)(o)},_=e=>{const t=S(e);try{return localStorage.getItem(t)}catch(e){return(0,a.D)(e),null}},T=e=>"project-focus-"+e,I=(e,t)=>{const o=T(e);(0,d.p)(o,t)},A=e=>{const t=T(e);try{return localStorage.getItem(t)}catch(e){return(0,a.D)(e),null}},O=e=>`scroll-${e}`,P=e=>`scroll-target-${e}`,j=(e,t)=>{const o=O(e);try{var r;const e=Math.max(t,0);null===(r=sessionStorage)||void 0===r||r.setItem(o,e.toString())}catch(e){(0,a.D)(e)}},D=(e,t,o)=>{const r=P(e);try{if(t){var n;const e=[t.type,t.id,o].join(",");null===(n=sessionStorage)||void 0===n||n.setItem(r,e)}else{var i;null===(i=sessionStorage)||void 0===i||i.removeItem(r)}}catch(e){(0,a.D)(e)}},N=e=>{const t=O(e);try{var o,r;const e=parseInt(null!==(o=null===(r=sessionStorage)||void 0===r?void 0:r.getItem(t))&&void 0!==o?o:"",10),n=Math.max(e,0);return Number.isNaN(e)?null:n}catch(e){return(0,a.D)(e),null}},L=e=>{const t=P(e);try{var o,r;const e=null!==(o=null===(r=sessionStorage)||void 0===r?void 0:r.getItem(t))&&void 0!==o?o:null;if(!e)return null;const[n,i,a]=e.split(",");return{target:{type:n,id:i},offset:parseInt(a,10)||0}}catch(e){return(0,a.D)(e),null}},F=e=>!((0,c.EA)(e)||(0,c.xV)(e)||(0,c.FZ)(e)||(0,c.Jo)(e))&&(!(!(0,c.eb)(e)&&!(0,c.Q2)(e))||void(0,n.vE)(e))},86386:(e,t,o)=>{"use strict";o.d(t,{h:()=>u});var r=o(97217),n=o(54748),i=o(55075),a=o(51625);function s(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,r)}return o}function c(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?s(Object(o),!0).forEach((function(t){l(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):s(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}function l(e,t,o){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var o=e[Symbol.toPrimitive];if(void 0!==o){var r=o.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}const u=({trigger:e,isLazy:t,searchBar:o,placement:s,menuProps:l,menuWrapper:u,children:d})=>{const p=null!=u?u:e=>(0,a.tZ)(a.HY,{children:e});return(0,a.tZ)(r.v,{placement:s,isLazy:t,lazyBehavior:"keepMounted",children:({onClose:t})=>(0,a.BX)(a.HY,{children:[e,p((0,a.BX)(n.q,c(c({paddingX:2},l),{},{children:[o,(0,a.tZ)(i.xu,{onClick:()=>t(),children:d})]})))]})})}},5707:(e,t,o)=>{"use strict";o.d(t,{RA:()=>a,h7:()=>r,mX:()=>n,xl:()=>i});const r=1240,n=24,i=r/n,a=r/n/2},2809:(e,t,o)=>{"use strict";o.d(t,{TJ:()=>f,Xp:()=>k,Xw:()=>E,gD:()=>v,im:()=>p,ug:()=>b});var r=o(1067),n=o(76674),i=o(79675),a=o.n(i),s=o(18434),c=o(89367);function l(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,r)}return o}function u(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?l(Object(o),!0).forEach((function(t){d(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):l(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}function d(e,t,o){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var o=e[Symbol.toPrimitive];if(void 0!==o){var r=o.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function p(e,t){var o,r;const{block:n}=null!==(o=(0,s.cP)(e,t))&&void 0!==o?o:{};return n&&(0,s.xV)(n)&&null!==(r=n.metadata.deepnote_chart_filter)&&void 0!==r?r:null}const f=e=>`${e}_filtered`,g=({values:e})=>`.isin([${e.map((e=>"string"==typeof e?'"'+e.replaceAll('"','\\"')+'"':e)).join(",")}])`,h=e=>"string"==typeof e?`pd.to_datetime(${(0,c._J)(e)}, unit='ms')`:e,m=(e,t)=>{const o=("values"===t.selectionType?[t]:t.axes).map((e=>{if("values"===e.selectionType)return{column:e.field,selectionFunction:g(e)};if("range"===e.selectionType){const o=y(e),r=`.between(${h((t=e).start)}, ${h(t.end)})`;return{column:e.field,selectionFunction:o?`.dt.tz_localize(None)${r}`:r}}return(0,r.vE)(e);var t})).map((t=>`${e}["${t.column}"]${t.selectionFunction}`));return"exclude"===t.filterType?((e,t)=>t?`~(${e})`:`~${e}`)(o.join(" & "),o.length>1):o.join(" & ")},y=e=>"range"===e.selectionType&&("string"==typeof e.start||"string"==typeof e.start),b=(e,t,{filter:o})=>{if(0===o.length)return`${t}=${e}\n${t}`;const r=o.map(((o,r)=>{const n=0===r?e:t;return`${t} = ${n}[${m(n,o)}]`})).join("\n");return`${o.some((e=>"data"===e.selectionType&&e.axes.some(y)))?"import pandas as pd\n\n":""}${r}\n${t}`};function v(e,t,o){var r;const{block:n}=null!==(r=(0,s.cP)(e,t))&&void 0!==r?r:{};n&&(0,s.xV)(n)&&(0,s.HT)(e,t,{deepnote_chart_filter:null!=o?o:void 0})}function E(e,t){return(0,n.ZP)(t,(t=>{t.filter.filter((t=>{var o,r;return!("field"in t&&((null==e||null===(o=e.encoding.color)||void 0===o?void 0:o.field)===t.field||(null==e||null===(r=e.encoding.size)||void 0===r?void 0:r.field)===t.field))}))}))}const w=(e,t)=>u(u({},e),{},{source:t}),k=(e,t,o,r)=>{const n=[e?w(e,"color_legend"):null,t?w(t,"size_legend"):null,o?w(o,"data"):null];return a()(n).map((e=>u(u({},e),{},{filterType:r})))}},89367:(e,t,o)=>{"use strict";o.d(t,{GO:()=>v,Yy:()=>b,_J:()=>h,rl:()=>d,sQ:()=>p});var r=o(1067),n=o(76674),i=o(79675),a=o.n(i),s=o(18166),c=o.n(s),l=o(60775);const u={E:"values",R:"range"},d=e=>(t,o)=>{if(!o||"object"!=typeof o)return;if(!("fields"in o)||!("values"in o))return;if(!Array.isArray(o.fields)||!Array.isArray(o.values))return;if(0===o.fields.length)return void(null==e||e("data",null));const{fields:n,values:i}=o,s=n.map(((e,t)=>{if(!e||"object"!=typeof e||!("field"in e)||"string"!=typeof e.field)return null;const o=e.field,n=u[e.type];if("values"===n)return{selectionType:"values",field:o,values:i[t]};if("range"===n){const e=i[t].sort(((e,t)=>((0,l.isDate)(e)?e.getTime():e)-((0,l.isDate)(t)?t.getTime():t))).map((e=>(0,l.isDate)(e)?g(e):e));return{selectionType:"range",field:o,start:e[0],end:e[1]}}return(0,r.vE)(n)}));e("data",{selectionType:"data",axes:a()(s)})},p=(e,t)=>(o,r)=>{if(!r||"object"!=typeof r)return;const n="vlPoint"in r?c()(r,"vlPoint"):r;if(0===Object.keys(n).length)return void t(e,null);const[i,a]=Object.entries(n)[0];i&&a&&t(e,{selectionType:"values",field:i,values:a})},f=(e,t)=>({field:e,oneOf:t}),g=e=>new Date(e).toISOString(),h=e=>new Date(e).getTime(),m=(e,t,o)=>({field:e,range:[t,o].map((e=>"string"==typeof e?(e=>{const t=new Date(e);return{year:t.getUTCFullYear(),month:t.getUTCMonth()+1,date:t.getUTCDate(),hours:t.getUTCHours(),minutes:t.getUTCMinutes(),seconds:t.getUTCSeconds(),milliseconds:t.getUTCMilliseconds()}})(e):e))}),y=e=>{var t;return"values"===e.selectionType?f(e.field,null!==(t=e.values)&&void 0!==t?t:[]):m(e.field,e.start,e.end)};function b(e){return{and:e.filter.map((e=>{var t;const o="values"===e.selectionType?f(e.field,null!==(t=e.values)&&void 0!==t?t:[]):{and:(Array.isArray(e.axes)?e.axes:[]).map(y)};return"exclude"===e.filterType?{not:o}:o}))}}function v(e,t){return(0,n.ZP)(e,(e=>{Object.keys(t).length>0&&(e.transform=[{filter:t}])}))}},82400:(e,t,o)=>{"use strict";o.d(t,{AI:()=>g,B2:()=>h,B6:()=>I,Fj:()=>O,K0:()=>L,KJ:()=>y,LK:()=>N,Rk:()=>b,VA:()=>k,dk:()=>A,dt:()=>m,kp:()=>F,p_:()=>_,qd:()=>T,wp:()=>f,z6:()=>S});var r=o(72219),n=o(14058),i=o(77535),a=o(76674),s=o(93834),c=o.n(s),l=(o(72008),o(79675)),u=o.n(l);o(2809),o(89367);const d=[],p=["x","y","color"];class f extends r.GU{}function g(){return{$schema:"https://vega.github.io/schema/vega-lite/v5.json",mark:{type:"bar",tooltip:!0},encoding:Object.fromEntries(p.map((e=>[e,{field:"",type:"nominal",sort:null,scale:{type:"linear"},format:{type:"default",decimals:null}}]))),width:"container",height:"container",config:{customFormatTypes:!0}}}function h(e,t){var o,r,n,i;const a=t[e];if("DataFrame"!==(null==a?void 0:a.varType))return d;const s=null!==(o=null===(r=t[e])||void 0===r?void 0:r.varColumns)&&void 0!==o?o:d,c=null!==(n=null===(i=t[e])||void 0===i?void 0:i.varColumnTypes)&&void 0!==n?n:d;return s.map(((e,t)=>({name:e,type:c[t]})))}function m(e){return Object.entries(e).filter((([,e])=>"DataFrame"===e.varType)).map((([e])=>e))}function y(e,t,o){const r=g();t.editCellVariableName(o,e),t.editVisualizationCellSpec(o,r),t.clearCellOutputsById([o])}function b(e,t){return`legend_${e}_${t}`}const v=(e,t)=>{var o,r,n;return null!==(o=null===(r=e.encoding)||void 0===r||null===(n=r[t])||void 0===n?void 0:n.timeUnit)&&void 0!==o?o:null};function E(e,t){const o=[{name:b("size",e),select:{type:"point",encodings:["size"],toggle:"true"},bind:"legend"},{name:b("color",e),select:{type:"point",encodings:["color"],toggle:"true"},bind:"legend"}],r="0"===e||"0_0"===e,n=u()(["x","y"].filter((e=>t&&_(t)&&!v(t,e))));return[...o,...r&&n.length>0?[{name:"interval_selection",select:{type:"interval",encodings:n}}]:[]]}function w(e,t){const o="point"===t||"circle"===t||"bar"===t;return{condition:{test:{and:[{param:b("size",e)},{param:b("color",e)},...o?[{param:"interval_selection"}]:[]]},value:1},value:.2}}function k(e){var t,o;return null!==(t=null===(o=e.layer)||void 0===o?void 0:o.map((e=>S(e))))&&void 0!==t?t:[]}function S(e){if(_(e))return e;if(I(e))return e.layer[0];throw new f(`Unexpected layer spec: ${JSON.stringify(e)}`)}function C(e){const{mark:t}="mark"in e?e:e.layer[0];return"string"==typeof t?t:t.type}function _(e){return!("layer"in e)&&(("string"!=typeof e.mark||"text"!==e.mark)&&("string"==typeof e.mark||"text"!==e.mark.type))}function T(e){const t="string"==typeof e.mark&&"text"===e.mark,o="string"!=typeof e.mark&&"text"===e.mark.type;return t||o}function I(e){if(!("layer"in e&&e.layer.length>0))return!1;const t=e.layer[0].mark;return"string"!=typeof t&&"text"!==t.type}function A(e){return(0,a.ZP)(e,(t=>{var o;if(t.layer)t.layer.forEach(((e,t)=>{(function(e){if(_(e))return[e];if(I(e))return e.layer;throw new f(`Invalid layer: ${JSON.stringify(e)}`)})(e).forEach(((e,o)=>{e.params=E(`${t}_${o}`,null)}));const o=S(e),r=`${t}`;o.params=E(r,o);const n=C(o);o.encoding.opacity=w(r,n)}));else if(t.encoding){t.params=E("0",t);const e=C(t);t.encoding.opacity=w("0",e)}t.height="container",t.width="container",t.padding=null!==(o=e.padding)&&void 0!==o?o:32,t.autosize={type:"fit"},t.config||(t.config={}),t.config.legend||(t.config.legend={}),t.config.legend.labelFont="Inter, sans-serif",t.config.legend.labelFontSize=12,t.config.legend.titleFont="Inter, sans-serif",t.config.legend.titleFontSize=12,t.config.legend.titleFontWeight="bold",t.config.title={anchor:"start",color:"#40566C",font:"Inter, sans-serif",fontSize:16,fontWeight:"normal",dy:-16},t.config.axis={labelFont:"Inter, sans-serif",labelFontSize:12,labelFontWeight:"normal",titleFont:"Inter, sans-serif",titleFontSize:12,titleFontWeight:"bold",labelOverlap:"parity"},t.config.customFormatTypes=!0}))}function O(e,t){const o=function(e){const t=e=>`%%%${e}%%%`,o=JSON.stringify(e,((e,o)=>"boolean"==typeof o?t(o?"True":"False"):null===o?t("None"):o),2);return o.replaceAll(/"%%%(.+?)%%%"/g,"$1")}(e);return n.G5.executeVisualizationWithSpecDict(t,o)}const P=440,j=280,D=1e3,N=e=>e?c()(e,j,D):P,L=e=>{var t;const o=(0,i.Pd)(e)?e.data:null;return o&&(null!==(t=o["application/vnd.vegalite.v4+json"])&&void 0!==t?t:o["application/vnd.vegalite.v5+json"])};function F(e){return(0,a.ZP)(e,(e=>{e.layer&&(e.layer=e.layer.filter((e=>{var t,o;const r=S(e);return(null===(t=r.encoding.x)||void 0===t?void 0:t.field)||(null===(o=r.encoding.y)||void 0===o?void 0:o.field)})))}))}},98521:(e,t,o)=>{"use strict";o.d(t,{DI:()=>c,Aq:()=>l});const r=e=>"application/zip"===e||"application/x-zip-compressed"===e,n=e=>!!e&&["application/gzip","application/x-gzip","application/tar","application/tar+gzip","application/x-gtar","application/x-tgz"].includes(e);var i=o(24822),a=o(69299);const s=[".txt",".gitignore",".json",".bowerrc",".jshintrc",".jscsrc",".eslintrc",".babelrc",".har",".abap",".cls",".azcli",".bat",".cmd",".mligo",".clj",".cljs",".cljc",".edn",".coffee",".c",".h",".cpp",".cc",".cxx",".hpp",".hh",".hxx",".cs",".csx",".cake",".css",".dockerfile",".fs",".fsi",".ml",".mli",".fsx",".fsscript",".go",".graphql",".gql",".handlebars",".hbs",".html",".htm",".shtml",".xhtml",".mdoc",".jsp",".asp",".aspx",".jshtm",".ini",".properties",".gitconfig",".java",".jav",".js",".es6",".jsx",".kt",".less",".lua",".md",".markdown",".mdown",".mkdn",".mkd",".mdwn",".mdtxt",".mdtext",".s",".dax",".msdax",".m",".pas",".p",".pp",".ligo",".pl",".php",".php4",".php5",".phtml",".ctp",".dats",".sats",".hats",".pq",".pqm",".ps1",".psm1",".psd1",".jade",".pug",".py",".rpy",".pyw",".cpy",".gyp",".gypi",".r",".rhistory",".rprofile",".rt",".cshtml",".redis",".rst",".rb",".rbx",".rjs",".gemspec",".pp",".rs",".rlib",".sb",".scm",".ss",".sch",".rkt",".scss",".sh",".bash",".sol",".aes",".sql",".st",".iecst",".iecplc",".lc3lib",".swift",".tcl",".twig",".ts",".tsx",".vb",".xml",".dtd",".ascx",".csproj",".config",".wxi",".wxl",".wxs",".xaml",".svg",".svgz",".opf",".xsl",".yaml",".yml",".scala",".sbt"];i.define({"notebook/ipynb":["ipynb"]},!0),i.define({"text/python":["py"]},!0);let c=function(e){return e[e.IMG=0]="IMG",e[e.EDITOR=1]="EDITOR",e[e.UNSUPPORTED=2]="UNSUPPORTED",e[e.PDF=3]="PDF",e[e.ARCHIVE=4]="ARCHIVE",e[e.CSV=5]="CSV",e}({});function l(e){const t=(0,a.UO)(e),o=function(e){const t=i.getType(e);return null==t?{type:"unknown",subtype:"unknown"}:{type:t.split("/")[0],subtype:t.split("/")[1]}}(t);return function(e){if(!e)return!1;if(e.startsWith(".")&&e.length>1)return!0;const t="."+(0,a.mD)(e);return s.some((e=>e===t))}(t)||"text"===o.type||"Dockerfile"===t?c.EDITOR:"image"===o.type?c.IMG:"notebook"===o.type?c.EDITOR:"application"===o.type&&"pdf"===o.subtype?c.PDF:"application"===o.type&&n("application/"+o.subtype)||"application"===o.type&&r("application/"+o.subtype)?c.ARCHIVE:c.UNSUPPORTED}},8641:(e,t,o)=>{"use strict";o.d(t,{v:()=>G});var r=o(1067),n=o(77424),i=o(3285),a=o(19654),s=o(21823),c=o(11524),l=o(76904),u=o.n(l),d=o(45060),p=o(35928),f=o(27704),g=o(47358),h=o(57664),m=o(86263),y=o(15800),b=o(15531),v=o(69299),E=o(61707),w=o(26199),k=o(89304),S=o(98521),C=o(86401),_=o(2611),T=o(55236),I=o(65064);function A(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,r)}return o}function O(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?A(Object(o),!0).forEach((function(t){P(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):A(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}function P(e,t,o){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var o=e[Symbol.toPrimitive];if(void 0!==o){var r=o.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function j(e,t,o,r={}){var n;(0,i.D)(t,o,O({slateState:e?(n=e,{children:n.children.map((e=>D(e))),selection:n.selection,marks:n.marks}):null},r))}function D(e){return T.xv.isText(e)?O(O({},e),{},{text:"<redacted>",length:e.text.length}):(0,I.L_)(e)?O(O({},e),{},{url:"<redacted>",children:e.children.map((e=>D(e)))}):O(O({},e),{},{children:e.children.map((e=>D(e)))})}var N=o(99012),L=o(24973),F=o.n(L),R=o(33161),U=o(87340);function x(e,t,o){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var o=e[Symbol.toPrimitive];if(void 0!==o){var r=o.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}const M=e=>{const t=e[e.length-1];return t?"number"==typeof(o=t).p[0]?o.p[0]:null:null;var o};class B{constructor(e){this.doc=e,x(this,"listenerStore",{}),x(this,"undoStack",[]),x(this,"undoStackPointer",-1),x(this,"tryToComposeOps",!1),x(this,"compositionTimeout",void 0),x(this,"addOps",(e=>{this.undoStackPointer!==this.undoStack.length-1&&(this.undoStack=this.undoStack.slice(0,this.undoStackPointer+1)),this.tryToComposeOps&&this.undoStack[this.undoStackPointer]&&this.opsComposable(this.undoStack[this.undoStackPointer])&&this.opsComposable(e)&&this.opsComposable([e[0],this.undoStack[this.undoStackPointer][0]])?this.undoStack[this.undoStack.length-1]=this.undoStack[this.undoStack.length-1].concat(e):(100===this.undoStack.length&&this.undoStack.shift(),this.undoStack.push(e),this.tryToComposeOps=!0,this.compositionTimeout&&clearTimeout(this.compositionTimeout),this.compositionTimeout=setTimeout((()=>{this.tryToComposeOps=!1,this.compositionTimeout=void 0}),300)),this.undoStackPointer=this.undoStack.length-1})),x(this,"restoreAutocompleteInfo",((e,t)=>{const o=e.slice().reverse();for(let e=0;e<o.length;e++)t[e].i=o[e].i;return t})),x(this,"undo",(()=>{if((0,N.n_)({message:"Called Undo"}),this.undoStackPointer<0)return null;const e=this.undoStack[this.undoStackPointer];this.undoStackPointer--;const t=this.restoreAutocompleteInfo(e,F().type.invert(e));return this.submitOps(t,"Undo"),M(e)})),x(this,"redo",(()=>{if(this.undoStackPointer>=this.undoStack.length-1)return null;const e=this.undoStack[this.undoStackPointer+1];return this.undoStackPointer++,this.submitOps(e,"Redo"),M(e)})),x(this,"registerOpListener",(e=>{const t=(0,R.Z)();return this.listenerStore[t]=e,t})),x(this,"removeOpListener",(e=>{delete this.listenerStore[e]})),x(this,"destroy",(()=>{this.listenerStore={},this.compositionTimeout&&(clearTimeout(this.compositionTimeout),delete this.compositionTimeout)})),x(this,"reset",(()=>{this.undoStack=[],this.undoStackPointer=-1})),x(this,"submitOps",((e,t)=>{e.forEach((e=>{this.doc.submitOp([e],void 0,(e=>{e&&(this.reset(),e.message=t+" failed because of a conflict with a collaborator. "+e.message,(0,N.n_)(e),U.Z.closeAll(),U.Z.warning({message:t+" failed because of a conflict with a collaborator."}))}))}));for(const t of Object.values(this.listenerStore))t(e)})),x(this,"opsTargetFile",((e,t)=>1===e.p.length&&1===t.p.length&&"number"==typeof e.p[0]&&"number"==typeof t.p[0])),x(this,"opsComposable",(e=>{if(0===e.length)return!0;const t=e[0];return e.every((e=>this.opsTargetFile(t,e)))}))}}function H(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,r)}return o}function $(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?H(Object(o),!0).forEach((function(t){W(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):H(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}function W(e,t,o){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var o=e[Symbol.toPrimitive];if(void 0!==o){var r=o.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}const q="/notebook.ipynb";function G(e){const{controllerRef:t,store:o,slateRef:l,terminalStore:T}=e,I={openTerminal:e=>{const t=o.getState().project.collaborationProperties.currentUserAccessType,i=o.getState().terminal.terminals;(0,r.C5)(t,n.EJ.RUN_TERMINAL)&&i[e]&&o.dispatch(d.tc(e))},clearEditorRefs({currentlyFocusedItem:e,controller:t,newItemPath:o,newItemId:r}){const n=(0,b.rN)(e)&&e.relativePath===o,i=(0,b.hE)(e)&&e.id===r;n||i||t.clearRefs()},async defocusNotebookIfActiveAndFocusAnother(t){const r=o.getState().project.focusedItem;if((0,b.hE)(r)&&r.id===t){o.dispatch((0,d.Kz)());const r=o.getState().project.id,n=o.getState().project.init_notebook_id,i=(await e.notebooksFetcher.fetchNotebooks(r,{fetchPolicy:"cache-first"})).filter((e=>e.id!==n&&e.id!==t));if(i.length>0){const e=i[0];return I.setActiveNotebook(e.id)}}},saveCurrentlyFocusedItem(t){const a=h.l.selectSharedbFiles(o.getState()),s=g.H.selectCurrentUserAccessType(o.getState()),c=(0,r.C5)(s,n.EJ.MANIPULATE_FILES);(0,b.hE)(t)&&void 0!==a[t.id]&&c&&e.fileSaver.saveFile(t.id).catch((e=>{(0,i.D)(e,"error")}))},updateFocusedNotebookName(e,t){const r=o.getState().project.focusedItem;if(!(0,b.mt)(r)||r.id!==e)return;const n=$($({},r),{},{name:t});o.dispatch((0,d.ki)(n))},updateAndRememberUrl({addToHistory:e,cellIdToFocus:t,controller:r,path:n,notebookInDB:i}){const{relativeUrlWithFile:a}=(0,w.g)({project:o.getState().project,urlHash:null!=t?t:void 0,filePath:n,notebookInDB:i});if(e){const e=null!=n?n:null==i?void 0:i.id;e&&(0,p.dG)(r.projectId,e),window.history.pushState(null,r.projectId,a)}else window.history.replaceState(null,r.projectId,a)},setActiveNotebook:async(r,n={})=>{var s,c;const{addToHistory:l,cellIdToFocus:u}=n;y.l.pushWithTimeStamp("setActiveNotebook");const p=t.current;if(!p)return{loaded:!1};(0,a.j)("Notebook opened",{workspaceId:p.workspaceId});const f=p.getControlChannelApi(),g=o.getState().project.focusedItem;let h,m,v;try{const e=await f.loadNotebook(r);if(!e)return await p.refreshFilesystem(),{loaded:!1};h=e.truncated,m=e.name,v=e.relativePath;if(!await I.loadDocAndSubscribe(r,"/",m))return{loaded:!1}}catch(e){(0,i.D)(e,"error")}const E={id:r,name:null!==(s=m)&&void 0!==s?s:""};I.saveCurrentlyFocusedItem(g),y.l.pushWithTimeStamp("focusedNotebookOp"),I.updateAndRememberUrl({addToHistory:l,notebookInDB:E,cellIdToFocus:u,controller:p});const w={type:"notebook",id:E.id,name:E.name,relativePath:null!==(c=v)&&void 0!==c?c:`/${E.name}.ipynb`,truncated:h};I.clearEditorRefs({currentlyFocusedItem:g,controller:p,newItemId:null==E?void 0:E.id});return!((0,b.hE)(g)&&g.id===(null==E?void 0:E.id))&&p.clearRefs(),o.dispatch((0,d.ki)(w)),u&&e.commonApi.scrollToCell(u),{loaded:!0}},setActiveFile:async(r,n={})=>{const{openRaw:c,addToHistory:l=!0,cellIdToFocus:u}=n;if(y.l.pushWithTimeStamp(`setActiveFile ${r}`),!r)return void o.dispatch((0,d.Kz)());if(r){const e=(0,v.hU)(r),n=o.getState().filesystem.expandedDirPaths;var p;if(e.some((e=>!n.includes(e))))o.dispatch({type:d.xg.SET_EXPANDED_DIRS,expandedDirPaths:[...new Set([...n,...e])]}),await(null===(p=t.current)||void 0===p?void 0:p.refreshFilesystem())}const f=t.current;if(!f)return;(0,a.j)("File opened",{path:r,type:(0,v.mD)(r),workspaceId:f.workspaceId});const g=(0,S.Aq)(r),h=null!=c?c:o.getState().filesystem.openRawList.includes(r),m=f.getControlChannelApi(),E=o.getState().project.focusedItem;let w,k;if(g===S.DI.EDITOR||h)try{const t=await m.loadItem(r);if(!t){if(r.endsWith(".ipynb")){const t=o.getState().project.id,i=(await e.notebooksFetcher.fetchNotebooks(t)).find((e=>e.name===(0,s.vQ)(r)));if(i)return await I.setActiveNotebook(i.id,{cellIdToFocus:n.cellIdToFocus,addToHistory:!1})}return void await f.refreshFilesystem()}w=t.id,k=t.truncated;const i=await I.loadDocAndSubscribe(w,r);if(!i)return;w!==((0,b.rN)(E)&&E.id)&&(f.textFileUndoStacks[w]||(f.textFileUndoStacks[w]=new B(i)))}catch(e){(0,i.D)(e,"error")}I.saveCurrentlyFocusedItem(E),y.l.pushWithTimeStamp("focusedFileOp"),I.updateAndRememberUrl({addToHistory:l,path:r,cellIdToFocus:u,controller:f}),h&&!o.getState().filesystem.openRawList.includes(r)&&o.dispatch({type:d.xg.SET_OPEN_RAW_LIST,openRawList:[...o.getState().filesystem.openRawList,r]});const C=w?{type:"file",id:w,truncated:k,relativePath:r}:{type:"preview",relativePath:r};I.clearEditorRefs({currentlyFocusedItem:E,controller:f,newItemPath:r,newItemId:w}),o.dispatch((0,d.ki)(C)),u&&e.commonApi.scrollToCell(u)},extractFilePathFromUrl:async e=>{const t=(0,k.bp)();if(t){const e=(0,s.aR)(t);return{filePath:null,notebookInDB:{id:e.id,name:e.name}}}const o=(0,k.A6)();return o?{filePath:o,notebookInDB:null}:{filePath:null,notebookInDB:null}},focusActiveItem:async e=>{var i,a,s;const l=o.getState().project.focusedItem,g=o.getState().project.default_notebook_id,h=null===(i=t.current)||void 0===i?void 0:i.projectId,y=h?(0,p.d)(h):null,E=(0,b.rs)(l)&&l.id||(null==y?void 0:y.startsWith(f.nH))&&y.slice(f.nH.length);if(E)return(0,r.C5)(o.getState().project.collaborationProperties.currentUserAccessType,n.EJ.RUN_TERMINAL)&&T[E]?o.dispatch((0,d.ki)({id:E,type:"terminal"})):o.dispatch((0,d.ki)(null));const w=t.current;if(!w)return;const{filePath:k,notebookInDB:S}=await I.extractFilePathFromUrl(w.getControlChannelApi()),C=k||(0,b.rN)(l)&&l.relativePath||void 0,_=C===k&&((0,b.G5)(C)||(0,b.mt)(l))?I.getCellIdToFocus(l):void 0;if(S){const{loaded:t}=await I.setActiveNotebook(S.id,{cellIdToFocus:e?_:void 0,addToHistory:!1});if(t)return}else if(C)return I.setActiveFile(C,{cellIdToFocus:e?_:void 0,addToHistory:!1});const A=32===(null==y?void 0:y.length)&&"/"!==(null==y?void 0:y[0])?y:null;if(A){const{loaded:e}=await I.setActiveNotebook(A,{addToHistory:!1});if(e)return}else if(y)return I.setActiveFile(y,{addToHistory:!1});if(g){const{loaded:e}=await I.setActiveNotebook(g,{addToHistory:!1});if(e)return}const O=u()(o.getState().filesystem.entities,v.F5).sort(((e,t)=>e.relativePath.localeCompare(t.relativePath,void 0,{numeric:!0})));let P=O.find((e=>(0,b.G5)(e.relativePath)&&e.relativePath!==q));if(P=null!==(a=P)&&void 0!==a?a:o.getState().filesystem.entities[q],P=null!==(s=P)&&void 0!==s?s:O.find((e=>"file"===e.type&&e.relativePath.toLowerCase().endsWith(".py"))),(0,c.zE)(P))return I.setActiveFile(P.relativePath,{cellIdToFocus:_,addToHistory:!1});o.dispatch({type:"SWITCH_PROJECT_LAYOUT",layout:m.k7.CONTENT})},getCellIdToFocus:e=>{const t=(0,b.hE)(e)?(0,p.D)(e.id):void 0,o=(0,k._R)();return null!=o?o:t},registerNotebookCallbacks:(e,r,n)=>{const a=o.getState().sessionConfig.sessionId,s=(0,C.z3)(["executionQueue"],(()=>{var o;const s=n.data;null!=s&&s.executionQueue||(0,i.D)(new Error("Notebook has no execution queue"),"warning",{supposedNotebook:s}),null===(o=t.current)||void 0===o||o.possiblyDisplayNotification(e,t.current.workspaceId,r,s.executionQueue,a)}));n.on("op",s)},loadDocAndSubscribe:async(e,r,n)=>{const i=t.current;if(!i)return;i.getControlChannelApi().fetchCellLayoutMetadata(e).then((e=>{o.dispatch({type:"CACHED_CELL_LAYOUT_FETCHED",payload:e})}));const a=i.getDoc(e);return null!=a&&a.type||(a.removeAllListeners("load"),a.removeAllListeners("del"),a.removeAllListeners("error"),a.once("load",(()=>{I.registerNotebookCallbacks(e,null!=n?n:(0,v.UO)(r),a),(0,_.I)(a,o,`files.${e}`)})),a.on("load",(()=>{console.log("Doc loaded, fileId:",e)})),a.on("del",(()=>{console.log("Doc deleted, fileId:",e)})),a.on("error",(e=>{(0,E.Y)(!1),j(l.current,new Error(`Doc error: ${e.message} , code: ${e.code}`),"error")})),await(0,C.EM)((e=>a.subscribe(e))),y.l.pushWithTimeStamp("fileDocSubscribed")),a}};return I}},86401:(e,t,o)=>{"use strict";async function r(e){return new Promise(((t,o)=>{e(((e,r)=>{if(e)return o(e);t(r)}))}))}function n(e,t){return(o,r)=>{let n=!1;for(const t of o)if(e.every(((e,o)=>t.p[o]===e))){n=!0;break}n&&t(o,r)}}function i(e){return!!e&&"string"==typeof e.data}o.d(t,{EM:()=>r,Hz:()=>i,z3:()=>n})},2611:(e,t,o)=>{"use strict";o.d(t,{I:()=>l});var r=o(3285),n=o(1067),i=o(72008),a=o.n(i),s=o(72307),c=o.n(s);function l(e,t,o){void 0!==e.data&&t.dispatch({type:"RECEIVE_SHAREDB_LOAD",path:o,data:e.data});let i=[];const s=()=>{try{const e=a()(i);i=[],t.dispatch({type:"RECEIVE_SHAREDB_OP",path:o,op:e})}catch(e){(0,r.D)(e,"error",{path:o,ops:i})}},l=c()((()=>{s()}),1e3,{trailing:!0,leading:!1});e.on("load",(()=>{null!==e.type&&t.dispatch({type:"RECEIVE_SHAREDB_LOAD",path:o,data:e.data})})),e.on("create",(()=>{t.dispatch({type:"RECEIVE_SHAREDB_LOAD",path:o,data:e.data})})),e.on("op batch",(o=>{i=[...i,...o],o.every((o=>function(e,t,o){const r=e.p;if(4===r.length&&"cells"===r[0]&&"metadata"===r[2]&&"source_hash"===r[3])return!0;if(4===r.length&&"cells"===r[0]&&"metadata"===r[2]&&"deepnote_to_be_reexecuted"===r[3])return!0;if(4===r.length&&"cells"===r[0]&&"metadata"===r[2]&&"execution_start"===r[3])return!0;if(4===r.length&&"cells"===r[0]&&"metadata"===r[2]&&"execution_millis"===r[3])return!0;if(1===r.length&&"kernelStatus"===r[0])return!0;if(r.length>=1&&"executionQueue"===r[0]){const r=o.getState().sharedbState.files[t],i=r&&(0,n.nZ)(r)?r.executionQueue:null;if(!i||0===i.length)return!1;if(1===i.length&&0===e.ld)return!1}if(3===r.length&&"cells"===r[0]&&"execution_count"===r[2])return!0;if(3===r.length&&"cells"===r[0]&&"source_hash"===r[2])return!0;return!1}(o,e.id,t)))?l():s()})),e.on("del",(()=>{t.dispatch({type:"RECEIVE_SHAREDB_LOAD",path:o,data:e.data})}))}},3215:(e,t,o)=>{"use strict";o.d(t,{q:()=>n});var r=o(64119);const n=r.Ps`
  fragment FullBlockFragment on Block {
    id
    version
    sorting_key
    block_group
    type
    content
    metadata
    state {
      output_cleared
      execution_start
      execution_millis
      source_hash
      deepnote_to_be_reexecuted
      execution_count
      deepnote_table_state {
        pageSize
        pageIndex
        filters {
          ... on TableOutputColumnContainsFilter {
            id
            value
          }
        }
        sortBy {
          id
          type
        }
      }
      deepnote_table_loading
      deepnote_table_invalid
    }
  }
`;r.Ps`
  fragment BlockAmendFragment on Block {
    id
    version
    sorting_key
    state {
      output_cleared
      execution_start
      execution_millis
      source_hash
      deepnote_to_be_reexecuted
      execution_count
      deepnote_table_state {
        pageSize
        pageIndex
        filters {
          ... on TableOutputColumnContainsFilter {
            id
            value
          }
        }
        sortBy {
          id
          type
        }
      }
      deepnote_table_loading
      deepnote_table_invalid
    }
  }
`},49952:(e,t,o)=>{"use strict";o.d(t,{ex:()=>k,TK:()=>S,lM:()=>w,AU:()=>C,DK:()=>E});var r=o(14058),n=o(3285),i=o(17062),a=o(86649);new i.n2({name:"Date",description:"Date custom scalar type",serialize(e){if(e instanceof Date)return e.getTime();throw Error("GraphQL Date Scalar serializer expected a `Date` object")},parseValue:e=>"number"==typeof e?new Date(e):((0,n.D)(new Error("GraphQL Date Scalar parser expected a `number`"),"error"),new Date(0)),parseLiteral:e=>e.kind===a.h.INT?new Date(parseInt(e.value,10)):null});const s=new i.n2({name:"Double",description:"Large integer (over 32 bits)",serialize(e){if("number"==typeof e)return[e%2**32,Math.floor(e/2**32)];throw Error("GraphQL Date Scalar serializer expected a `Date` object")},parseValue:e=>Array.isArray(e)&&2===e.length&&"number"==typeof e[0]&&"number"==typeof e[1]?e[0]+e[1]*2**32:((0,n.D)(new Error("GraphQL Date Scalar parser expected a `[number, number]` tuple"),"error"),0),parseLiteral:e=>e.kind===a.h.INT&&"string"==typeof e.value?parseInt(e.value,10):0});var c=o(1067),l=o(77839),u=o(75732),d=o(18434),p=o(19941);const f=["formattedRanges"],g=["__typename","deepnote_table_state","execution_millis","execution_count"],h=["__typename"];function m(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,r)}return o}function y(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?m(Object(o),!0).forEach((function(t){b(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):m(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}function b(e,t,o){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var o=e[Symbol.toPrimitive];if(void 0!==o){var r=o.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function v(e,t){if(null==e)return{};var o,r,n=function(e,t){if(null==e)return{};var o,r,n={},i=Object.keys(e);for(r=0;r<i.length;r++)o=i[r],t.indexOf(o)>=0||(n[o]=e[o]);return n}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)o=i[r],t.indexOf(o)>=0||Object.prototype.propertyIsEnumerable.call(e,o)&&(n[o]=e[o])}return n}function E(e,t){return{type:"notebook",notebookId:e,children:t.map((e=>w(e)))}}function w(e){const t=(0,l.Tu)(e.type)?e.type:null;if(!t)throw new Error(`Unknown block type: ${e.type}`);if((0,d.LY)(e.type)&&(0,r.UX)(e.type)){const t=e.metadata,{formattedRanges:o}=t,r=v(t,f),n=(0,u.D0)(e.content,null!=o?o:[]);return{id:e.id,version:e.version,type:e.type,sorting_key:e.sorting_key,block_group:e.block_group,metadata:y({},r),children:n}}if((0,d.US)(t)){e.state||(0,n.D)(new Error("Missing state in executable block from the Block API"),"error",{blockId:e.id,blockType:t});const o=_(e.state);return{id:e.id,version:e.version,type:t,sorting_key:e.sorting_key,block_group:e.block_group,metadata:y({},e.metadata),state:o,children:[{text:e.content}]}}return{id:e.id,version:e.version,type:t,sorting_key:e.sorting_key,block_group:e.block_group,metadata:y({},e.metadata),children:[{text:e.content}]}}function k(e,t){if((0,d.Uo)(e)){t.state||(0,n.D)(new Error("Missing state in executable block from the Block API"),"error",{blockId:e.id,blockType:e.type});const o=_(t.state);return y(y({},e),{},{version:t.version,sorting_key:t.sorting_key,state:o})}return t.state&&(0,n.D)(new Error("Unexpected state in non-executable block from the Block API"),"error",{blockId:e.id,blockType:e.type,state:t.state}),y(y({},e),{},{version:t.version,sorting_key:t.sorting_key})}function S(e){if((0,d.EA)(e)){const{source:t,formattedRanges:o}=(0,u.oP)(e.children);return{type:e.type,content:t,metadata:y(y({},e.metadata),{},{formattedRanges:o}),block_group:e.block_group}}return{type:e.type,content:(0,p.y)(e),metadata:y({},e.metadata),block_group:e.block_group}}function C(e){return{partialMetadata:{deepnote_variable_value:e.metadata.deepnote_variable_value}}}function _(e){const t=null!=e?e:{},{__typename:o,deepnote_table_state:r,execution_millis:n,execution_count:i}=t,a=v(t,g),l=r?function(e){var t,o;return(0,c.Q9)({pageSize:e.pageSize,pageIndex:e.pageIndex,sortBy:e.sortBy,filters:null!==(t=null===(o=e.filters)||void 0===o?void 0:o.map((e=>function(e){switch(e.__typename){case"TableOutputColumnContainsFilter":{const{__typename:t}=e;return y({type:"contains"},v(e,h))}case void 0:throw new Error("Missing __typename in table filter");default:(0,c.vE)(e.__typename)}}(e))))&&void 0!==t?t:null})}(r):null,u=n?s.parseValue(n):null;return y(y({},(0,c.Q9)(y(y({},a),{},{deepnote_table_state:l,execution_millis:u}))),{},{execution_count:null!=i?i:null})}},45585:(e,t,o)=>{"use strict";o.d(t,{L:()=>f,X:()=>g});var r=o(14058),n=o(85508),i=o.n(n),a=o(55236),s=o(49952),c=o(16925),l=o(18434);function u(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,r)}return o}function d(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?u(Object(o),!0).forEach((function(t){p(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):u(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}function p(e,t,o){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var o=e[Symbol.toPrimitive];if(void 0!==o){var r=o.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function f(e,t,o){const r=o?(0,s.lM)(o):null,n=(0,l.cP)(e,t);n?r?h(e,n,r):e.apply({type:"remove_node",path:n.path,node:n.block,remote:!0,affectsUserEditableData:!0}):r&&function(e,t){const o=(0,l.iW)(e,t);e.apply({type:"insert_node",path:o,node:t,remote:!0,affectsUserEditableData:!0})}(e,r)}function g(e,t,o){const r=(0,l.cP)(e,t);if(r)if(o){h(e,r,(0,s.ex)(r.block,o))}else e.apply({type:"remove_node",path:r.path,node:r.block,remote:!0,affectsUserEditableData:!0});else o&&console.warn("Block amend failed: block not found",{blockId:t})}function h(e,t,o){const{block:n,path:s}=t,u=n.type!==o.type,p=n.sorting_key!==o.sorting_key;if(u){e.apply({type:"remove_node",path:s,node:n,remote:!0,affectsUserEditableData:!0});const t=p?(0,l.iW)(e,o):s;e.apply({type:"insert_node",path:t,node:o,remote:!0,affectsUserEditableData:!0})}else{const u=(0,l.ER)(t.block,o);if(u){const t=function(e,t){const o=d(d({},(0,c.H)(e)),{},{cellId:e.id,block_group:""}),n=d(d({},(0,c.H)(t)),{},{cellId:t.id,block_group:""}),a=(0,r.St)(o),s=(0,r.St)(n);return!i()(a,s)}(n,o),f=p?(0,l.iW)(e,o):s,g=e.selection;if(u.children&&!(0,l.J2)(o)&&g){const t=(0,l.bo)(e,g);if((null==t?void 0:t.block.id)===o.id){const{anchor:o,focus:r}=g;e.apply({type:"set_selection",properties:{anchor:o,focus:r},newProperties:{anchor:{path:a.ML.path(e,t.path,{edge:"start"}),offset:0},focus:{path:a.ML.path(e,t.path,{edge:"start"}),offset:0}}})}}e.apply({type:"set_node",path:s,properties:(0,l.qk)(u,n),newProperties:u,remote:!0,affectsUserEditableData:t}),i()(s,f)||e.apply({type:"move_node",path:s,newPath:f,remote:!0,affectsUserEditableData:!0})}}}},77839:(e,t,o)=>{"use strict";o.d(t,{$W:()=>m,CU:()=>g,Tu:()=>y,Wj:()=>i,gn:()=>f,hI:()=>a,lO:()=>p,wv:()=>u,yf:()=>d,zR:()=>l,zS:()=>h});var r=o(32902),n=o.n(r);const i=["text-cell-h1","text-cell-h2","text-cell-h3"],a=["code","sql"],s=[...a,"markdown"],c=["text-cell-bullet","text-cell-todo"],l=[...c,"text-cell-callout"],u=["text-cell-p","text-cell-callout",...i,...c],d=["input-text","input-select","input-slider","input-date"],p=["visualization",...s,...d,"image"],f=["sql",...d],g=["visualization",...a,...d],h=["visualization","code","sql"],m=n()([...g,...s,...u,"image"]);function y(e){return m.includes(e)}},75732:(e,t,o)=>{"use strict";o.d(t,{D0:()=>f,oP:()=>p});var r=o(79675),n=o.n(r),i=o(65064),a=o(75778);const s=["text"];function c(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,r)}return o}function l(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?c(Object(o),!0).forEach((function(t){u(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):c(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}function u(e,t,o){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var o=e[Symbol.toPrimitive];if(void 0!==o){var r=o.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function d(e,t){if(null==e)return{};var o,r,n=function(e,t){if(null==e)return{};var o,r,n={},i=Object.keys(e);for(r=0;r<i.length;r++)o=i[r],t.indexOf(o)>=0||(n[o]=e[o]);return n}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)o=i[r],t.indexOf(o)>=0||Object.prototype.propertyIsEnumerable.call(e,o)&&(n[o]=e[o])}return n}function p(e){return e.reduce(((e,t)=>(0,i.L_)(t)?function(e,t){const o=p(t.children),r={type:"link",url:t.url,fromCodePoint:e.codePointLength,toCodePoint:e.codePointLength+o.codePointLength,ranges:o.formattedRanges};return{codePointLength:e.codePointLength+o.codePointLength,source:e.source+o.source,formattedRanges:[...e.formattedRanges,r]}}(e,t):(0,a.aP)(t)?e:function(e,t){const o=t,{text:r}=o,n=d(o,s),i=function(e){return[...e].length}(r),a=Object.keys(n).length>0;return{codePointLength:e.codePointLength+i,source:`${e.source}${r}`,formattedRanges:a?e.formattedRanges.concat({type:"marks",fromCodePoint:e.codePointLength,toCodePoint:e.codePointLength+i,marks:n}):e.formattedRanges}}(e,t)),{codePointLength:0,source:"",formattedRanges:[]})}function f(e,t){const o=[...e],r=function(e,t){return t.every((t=>function(e,t){return e.fromCodePoint>=0&&e.fromCodePoint<t.length&&e.toCodePoint>=0&&e.toCodePoint<=t.length&&e.fromCodePoint<=e.toCodePoint}(t,e)))}(o,t),n={type:"marks",fromCodePoint:0,toCodePoint:o.length,marks:{}},i=r?function(e,t){return t.reduce(((e,t)=>{const o=e.at(-1);return o?[...e.slice(0,-1),...g(o,t)]:e}),[e])}(n,t):[n];return i.flatMap(((e,t)=>{if("link"===e.type){const a=i[t-1],s=a&&"link"===a.type&&a.toCodePoint===e.fromCodePoint;return[...0===e.fromCodePoint||s?[{text:""}]:[],(r=o,n=e,{type:"inline-link",url:n.url,children:f(h(r,n),n.ranges)}),...e.toCodePoint===o.length?[{text:""}]:[]]}return function(e,t){return l({text:h(e,t)},t.marks)}(o,e);var r,n}))}function g(e,t){const o=e.fromCodePoint<t.fromCodePoint?l(l({},e),{},{toCodePoint:t.fromCodePoint}):null,r=e.toCodePoint>t.toCodePoint?l(l({},e),{},{fromCodePoint:t.toCodePoint}):null;return n()([o,t,r])}function h(e,t){return e.slice(t.fromCodePoint,t.toCodePoint).join("")}},8283:(e,t,o)=>{"use strict";o.d(t,{MO:()=>i});new WeakMap;const r=new WeakMap,n=new WeakMap,i={isMerging:e=>n.get(e),isSaving:e=>r.get(e),redo(e){e.redoEdit()},undo(e){e.undoEdit()},withoutMerging(e,t){const o=i.isMerging(e);n.set(e,!1),t(),n.set(e,o)},withoutSaving(e,t){const o=i.isSaving(e);r.set(e,!1),t(),r.set(e,o)}}},65064:(e,t,o)=>{"use strict";o.d(t,{Ij:()=>c,L_:()=>a,Pz:()=>d,V7:()=>u,tr:()=>l,yI:()=>s});var r=o(19654),n=o(6307),i=o(55236);function a(e){return i.W_.isElement(e)&&"inline-link"===e.type}function s(e,t){if(!t)return!1;const o=[...i.ML.nodes(e,{at:t,match:a})];if(1!==o.length)return!1;const[,r]=o[0];return i.y$.isAncestor(r,t.anchor.path)&&i.y$.isAncestor(r,t.focus.path)}function c(e,t){if(!t)return!1;const[o]=i.ML.nodes(e,{at:t,match:a});return!!o}function l(e="",t){return{type:"inline-link",url:e,children:null!=t?[{text:t}]:[]}}function u(e){e.selection&&(c(e,e.selection)?i.YR.unwrapNodes(e,{match:a}):i.YR.wrapNodes(e,l(),{split:!0}))}function d(e,t,o){(0,n.ZP)("mod+shift+u",t)&&(u(e),(0,r.W)("Text formatting applied",{type:"hyperlink",origin:"shortcut",workspaceId:o}))}},16925:(e,t,o)=>{"use strict";o.d(t,{H:()=>E,J:()=>v});var r=o(36417),n=o(1067),i=o(75732),a=o(19941);const s=["formattedRanges"],c=["execution_count"],l=["execution_count"],u=["execution_count"],d=["execution_count"],p=["execution_count"],f=["execution_count"],g=["execution_count"];function h(e,t){if(null==e)return{};var o,r,n=function(e,t){if(null==e)return{};var o,r,n={},i=Object.keys(e);for(r=0;r<i.length;r++)o=i[r],t.indexOf(o)>=0||(n[o]=e[o]);return n}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)o=i[r],t.indexOf(o)>=0||Object.prototype.propertyIsEnumerable.call(e,o)&&(n[o]=e[o])}return n}function m(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,r)}return o}function y(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?m(Object(o),!0).forEach((function(t){b(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):m(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}function b(e,t,o){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var o=e[Symbol.toPrimitive];if(void 0!==o){var r=o.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function v(e,t,o){var a;switch(t.cell_type){case"code":{var c;const{state:n,metadata:i}=(0,r.Q)({metadata:t.metadata,execution_count:t.execution_count});return{type:"code",id:e,uniqueId:!0,version:0,sorting_key:o.sortingKey,block_group:null!==(c=o.blockGroup)&&void 0!==c?c:e,children:[{text:t.source}],metadata:i,state:n}}case"sql":{var l;const{state:n,metadata:i}=(0,r.Q)({metadata:t.metadata,execution_count:t.execution_count});return{type:"sql",id:e,uniqueId:!0,version:0,sorting_key:o.sortingKey,block_group:null!==(l=o.blockGroup)&&void 0!==l?l:e,children:[{text:t.source}],metadata:i,state:n}}case"markdown":return{children:[{text:t.source}],type:"markdown",id:e,uniqueId:!0,version:0,sorting_key:o.sortingKey,block_group:null!==(a=o.blockGroup)&&void 0!==a?a:e,metadata:y({},t.metadata)};case"visualization":{var u;const{state:n,metadata:i}=(0,r.Q)({metadata:t.metadata,execution_count:t.execution_count});return{type:"visualization",id:e,uniqueId:!0,version:0,sorting_key:o.sortingKey,block_group:null!==(u=o.blockGroup)&&void 0!==u?u:e,children:[{text:t.source}],metadata:i,state:n}}case"text-cell-h1":case"text-cell-h2":case"text-cell-h3":case"text-cell-p":case"text-cell-bullet":case"text-cell-todo":case"text-cell-callout":{var d;const r=t.metadata,{formattedRanges:n}=r,a=h(r,s);return{children:(0,i.D0)(t.source,null!=n?n:[]),type:t.cell_type,id:e,uniqueId:!0,version:0,sorting_key:o.sortingKey,block_group:null!==(d=o.blockGroup)&&void 0!==d?d:e,metadata:y({},a)}}case"input-text":{var p;const{state:n,metadata:i}=(0,r.Q)({metadata:t.metadata,execution_count:t.execution_count});return{type:"input-text",children:[{text:t.source}],id:e,uniqueId:!0,version:0,sorting_key:o.sortingKey,block_group:null!==(p=o.blockGroup)&&void 0!==p?p:e,metadata:i,state:n}}case"input-select":{var f;const{state:n,metadata:i}=(0,r.Q)({metadata:t.metadata,execution_count:t.execution_count});return{type:"input-select",children:[{text:t.source}],id:e,uniqueId:!0,version:0,sorting_key:o.sortingKey,block_group:null!==(f=o.blockGroup)&&void 0!==f?f:e,metadata:i,state:n}}case"input-slider":{var g;const{state:n,metadata:i}=(0,r.Q)({metadata:t.metadata,execution_count:t.execution_count});return{type:"input-slider",children:[{text:t.source}],id:e,uniqueId:!0,version:0,sorting_key:o.sortingKey,block_group:null!==(g=o.blockGroup)&&void 0!==g?g:e,metadata:i,state:n}}case"input-date":{var m;const{state:n,metadata:i}=(0,r.Q)({metadata:t.metadata,execution_count:t.execution_count});return{type:"input-date",children:[{text:t.source}],id:e,uniqueId:!0,version:0,sorting_key:o.sortingKey,block_group:null!==(m=o.blockGroup)&&void 0!==m?m:e,metadata:i,state:n}}case"image":var b;return{children:[{text:""}],type:"image",id:e,version:0,sorting_key:o.sortingKey,block_group:null!==(b=o.blockGroup)&&void 0!==b?b:e,metadata:t.metadata};default:return(0,n.vE)(t)}}function E(e){switch(e.type){case"code":{const t=e.state,{execution_count:o}=t,r=h(t,c);return{cell_type:"code",source:(0,a.y)(e),metadata:y(y({},e.metadata),r),outputs:[],execution_count:o,block_group:e.block_group}}case"sql":{const t=e.state,{execution_count:o}=t,r=h(t,l);return{cell_type:"sql",source:(0,a.y)(e),metadata:y(y({},e.metadata),r),outputs:[],execution_count:o,block_group:e.block_group}}case"markdown":return{cell_type:"markdown",source:(0,a.y)(e),metadata:y({},e.metadata),block_group:e.block_group};case"visualization":{const t=e.state,{execution_count:o}=t,r=h(t,u);return{cell_type:"visualization",metadata:y(y({},e.metadata),r),outputs:[],execution_count:o,source:"",block_group:e.block_group}}case"text-cell-h1":case"text-cell-h2":case"text-cell-h3":case"text-cell-p":case"text-cell-bullet":case"text-cell-todo":case"text-cell-callout":{const{source:t,formattedRanges:o}=(0,i.oP)(e.children);return{cell_type:e.type,source:t,metadata:y(y({},e.metadata),{},{formattedRanges:o}),block_group:e.block_group}}case"input-text":{const t=e.state,{execution_count:o}=t,r=h(t,d);return{cell_type:"input-text",metadata:y(y({},e.metadata),r),source:"",outputs:[],execution_count:o,block_group:e.block_group}}case"input-select":{const t=e.state,{execution_count:o}=t,r=h(t,p);return{cell_type:"input-select",metadata:y(y({},e.metadata),r),source:"",outputs:[],execution_count:o,block_group:e.block_group}}case"input-slider":{const t=e.state,{execution_count:o}=t,r=h(t,f);return{cell_type:"input-slider",metadata:y(y({},e.metadata),r),source:"",outputs:[],execution_count:o,block_group:e.block_group}}case"input-date":{const t=e.state,{execution_count:o}=t,r=h(t,g);return{cell_type:"input-date",metadata:y(y({},e.metadata),r),source:"",outputs:[],execution_count:o,block_group:e.block_group}}case"image":return{cell_type:"image",source:"",metadata:e.metadata,block_group:e.block_group};default:return(0,n.vE)(e)}}},75778:(e,t,o)=>{"use strict";o.d(t,{Fj:()=>c,Hl:()=>s,Nx:()=>a,aP:()=>n,uY:()=>i});o(6307);var r=o(55236);function n(e){return r.W_.isElement(e)&&"inline-slash-command"===e.type}function i(e,t){if(!t)return!1;const o=[...r.ML.nodes(e,{at:t,match:n})];if(1!==o.length)return!1;const[,i]=o[0];return r.y$.isAncestor(i,t.anchor.path)&&r.y$.isAncestor(i,t.focus.path)}function a(e){return r.NB.string(e).replace(/^\//,"")}function s(e){return`/${e}`}function c(e,t){return t.some((t=>null==t?void 0:t.toLowerCase().includes(e.toLowerCase())))}},18434:(e,t,o)=>{"use strict";o.d(t,{Bu:()=>B,Dr:()=>ge,Qi:()=>de,am:()=>$,zB:()=>H,$R:()=>be,Sd:()=>ue,UA:()=>Y,nt:()=>J,VR:()=>z,bo:()=>K,cP:()=>Z,ER:()=>x,Su:()=>he,Ep:()=>me,WC:()=>V,iW:()=>Se,gz:()=>we,qk:()=>M,ku:()=>X,GI:()=>ve,_C:()=>oe,hv:()=>ye,LY:()=>S,nM:()=>fe,my:()=>U,bA:()=>ne,Kl:()=>O,Uo:()=>A,US:()=>I,Q2:()=>_,wz:()=>j,VM:()=>P,Jo:()=>F,bO:()=>te,FZ:()=>T,eb:()=>D,m3:()=>ee,Le:()=>ie,x$:()=>ae,Du:()=>Ce,EA:()=>re,eT:()=>R,xV:()=>N,J2:()=>C,jM:()=>Ee,GW:()=>W,NK:()=>ke,yu:()=>q,wW:()=>G,qe:()=>pe,NR:()=>ce,HT:()=>se});var r=o(72037),n=o(14058),i=o(76674),a=o(72008),s=o.n(a),c=o(79675),l=o.n(c),u=o(85508),d=o.n(u),p=o(55236),f=o(10284);function g(e,t){const o=e.split(t),r=o[o.length-1],n=parseInt(r,10);if(1===o.length||isNaN(n))return e+t+"2";return o.slice(0,-1).join(t)+t+(n+1||2)}var h=o(77839),m=o(8283);const y=["at","match"],b=["at","match","targetBlockGroup"];function v(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,r)}return o}function E(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?v(Object(o),!0).forEach((function(t){w(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):v(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}function w(e,t,o){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var o=e[Symbol.toPrimitive];if(void 0!==o){var r=o.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function k(e,t){if(null==e)return{};var o,r,n=function(e,t){if(null==e)return{};var o,r,n={},i=Object.keys(e);for(r=0;r<i.length;r++)o=i[r],t.indexOf(o)>=0||(n[o]=e[o]);return n}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)o=i[r],t.indexOf(o)>=0||Object.prototype.propertyIsEnumerable.call(e,o)&&(n[o]=e[o])}return n}function S(e){return h.$W.includes(e)}function C(e){return t=e.type,h.lO.includes(t);var t}function _(e){return h.hI.includes(e.type)}function T(e){return h.yf.includes(e.type)}function I(e){return h.CU.includes(e)}function A(e){return _(e)||T(e)||N(e)}function O(e){return t=e.type,h.zS.includes(t);var t}function P(e){return h.Wj.includes(e)}function j(e){return P(e.type)}function D(e){return"markdown"===e.type}function N(e){return"visualization"===e.type}function L(e){return h.gn.includes(e.type)}function F(e){return"image"===e.type}function R(e){return"text-cell-todo"===e.type}function U(e){return"text-cell-callout"===e.type}function x(e,t){const o={},r=new Set([...Object.keys(e),...Object.keys(t)]);for(const n of r)d()(e[n],t[n])||(o[n]=t[n]);return Object.keys(o).length>0?o:null}function M(e,t){const o={};for(const r of Object.keys(e))o[r]=t[r];return o}function B(e){return{block:e[0],path:e[1]}}function H(e){if(0===e.children.length)return null;return p.ML.node(e,[0])[0]}function $(e,t){const o=null!=t?t:{},{at:r,match:n}=o,i=k(o,y);return p.ML.nodes(e,E(E({},i),{},{at:e.children.length>0?null!=r?r:ge([]):[],match:e=>oe(e)&&(!n||n(e))}))}function W(e,t){const{at:o,match:r,targetBlockGroup:n}=t,i=k(t,b);p.ML.withoutNormalizing(e,(()=>{const t=$(e,{at:null!=o?o:ge([]),match:e=>oe(e)&&(!r||r(e))});for(const[o,r]of t)n&&o.block_group===n||G(e,r,n),p.YR.moveNodes(e,E(E({},i),{},{at:r}))}))}function q(e,t,o,r={}){const n=Z(e,t);return n?G(e,n.path,o,r):null}function G(e,t,o,n={}){const i=null!=o?o:(0,r.EL)(),a=z(e,t);return a?(e.apply({type:"set_node",path:t,properties:{block_group:a.block_group},newProperties:{block_group:i},isMergeable:Boolean(n.isMergeable)}),i):null}function Z(e,t){var o;const r=null!==(o=[...$(e,{match:e=>e.id===t})][0])&&void 0!==o?o:null;return r?B(r):null}function J(e,t){try{const o=p.ML.node(e,ge([t]));return oe(o[0])?B(o):null}catch{return null}}function z(e,t){let o=p.ML.node(e,t);for(;o&&!("id"in o[0])&&o[1].length>0;)o=p.ML.parent(e,o[1]);return o&&"id"in o[0]?o[0]:null}function V(e){const t=e.selection;return t?Q(e,t):[]}function Y(e){const t=e.selection;return t?K(e,t):null}function Q(e,t){return[...$(e,{at:t})].map(B)}function K(e,t){const o=Q(e,t);return 1===o.length?o[0]:null}function X(e,t){var o;const r=K(e,t);return null!==(o=null==r?void 0:r.block.id)&&void 0!==o?o:null}function ee(e){return p.W_.isElement(e)&&"notebook"===e.type}function te(e){return!("text"in e)&&!("id"in e)}function oe(e){return"id"in e}function re(e){return oe(e)&&(0,n.UX)(e.type)}function ne(e){return"code"===e.type}function ie(e){return h.zR.includes(e.type)}function ae(e,t){const o=he(t)-1;if(o<0)return!1;const r=J(e,o);return Boolean(r&&re(r.block)&&p.ML.isEmpty(e,r.block))}function se(e,t,o){const r=Z(e,t);r&&le(e,r,o)}function ce(e,t,o){const r=f.F3.findPath(e,t);if(!r)return;le(e,{block:t,path:r},o)}function le(e,t,o){const r=t.block.metadata,n="function"==typeof o?(0,i.Uy)(r,o):E(E({},r),o);d()(r,n)||p.YR.setNodes(e,{metadata:n},{at:t.path})}function ue(e){const t={};for(const[r]of $(e)){var o;const e=r.type;t[e]=(null!==(o=t[e])&&void 0!==o?o:0)+1}return t}function de(e,t){const o=s()(e);if(o.id=(0,r.EL)(),o.uniqueId=!0,o.sorting_key=null,o.block_group=(0,r.EL)(),A(o)&&(o.state={execution_count:null},o.metadata.allow_embed=!1),L(o)){const e=o.metadata.deepnote_variable_name;if(e){let r=e;for(;t.existingVariableNames.has(r);)r=g(r,"_");o.metadata.deepnote_variable_name=r}}return o}function pe(e,t){return p.y$.isCommon(t,e.anchor.path)&&p.y$.isCommon(t,e.focus.path)?{anchorOffset:e.anchor.offset,focusOffset:e.focus.offset}:null}function fe(e,t){return p.e6.includes(e,t)}function ge(e){return[0,...e]}function he(e){return e[1]}function me(e){return[0,e]}function ye(e){return e.length>ge([]).length}function be(e){var t;const o=null===(t=Y(e))||void 0===t?void 0:t.block;o&&e.isVoid(o)||f.F3.focus(e)}function ve(e){return 0===e.offset&&e.path.every((e=>0===e))}function Ee(e,t){const o=s()(e);for(const[e,r]of p.NB.nodes(o))if(oe(e)){const n=t(e);if(n!==e){p.NB.parent(o,r).children[r[r.length-1]]=n}}return o}function we(e){const t=[...$(e,{at:ge([]),match:L})],o=l()(t.map((e=>e[0].metadata.deepnote_variable_name)));return new Set(o)}function ke(e,t){m.MO.withoutSaving(e,(()=>{const o=H(e);o?e.apply({type:"set_node",path:ge([]),properties:o,newProperties:t,remote:!0,isMergeable:!1}):e.apply({type:"insert_node",path:ge([]),node:t,remote:!0,isMergeable:!1})}))}function Se(e,t){const o=t.sorting_key;if(!o)return ge([0]);const r=$(e);let n=0;for(const[e]of r)if(e.id!==t.id&&e.sorting_key){if(e.sorting_key>=o)break;n+=1}return ge([n])}function Ce(e,t){return Boolean(e.selection&&p.e6.isCollapsed(e.selection)&&p.ML.isStart(e,e.selection.focus,t))}},19941:(e,t,o)=>{"use strict";function r(e){var t,o;return null!==(t=null===(o=e.children[0])||void 0===o?void 0:o.text)&&void 0!==t?t:""}function n(e){return[...e,0]}o.d(t,{v:()=>n,y:()=>r})},18882:(e,t,o)=>{"use strict";o.d(t,{H:()=>b});o(34974);var r=o(3285),n=o(1067),i=o(77424),a=o(44689),s=o(90142),c=o.n(s),l=o(45060),u=o(87340),d=o(4850),p=o(15531),f=o(65317);function g(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,r)}return o}function h(e,t,o){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var o=e[Symbol.toPrimitive];if(void 0!==o){var r=o.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}const[m,y]=(0,f.Z)((()=>o.e(1802).then(o.t.bind(o,46466,23))),"We failed to load terminals. Please try refreshing the page.");function b(e){const{store:t,terminalStore:o}=e;function s(e,o){var n;if(null===(n=m.current)||void 0===n||!n.Terminal)return;const i=new m.current.Terminal({cursorBlink:!1,fontFamily:a.F$,fontSize:14,fontWeightBold:"500"});i.loadAddon(new(c()));const s=i.onData((n=>{const i=t.getState().connection.hardwareStatus,a=t.getState().connection.isConnected;(0,d.OJ)(i)&&a?e.sendTerminalMessage(o,"stdin",[n]).catch((e=>{const t=new Error(`error when sending terminal stdin: ${e.message}`);(0,r.D)(t,"error",{terminalId:o})})):(u.Z.closeAll(),u.Z.info({message:a?"Machine is not running yet. You can start typing once it's ready.":"It seems you're offline. You can start typing when you're back online."}))}));return{terminal:i,listener:s}}return{createNewTerminal:s,deleteTerminal:function(e){o[e].listenerStore.forEach((e=>e.dispose())),o[e].terminal.dispose(),delete o[e];const r=t.getState().project.focusedItem;(0,p.rs)(r)&&(null==r?void 0:r.id)===e&&t.dispatch(l.Kz());const n=function(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?g(Object(o),!0).forEach((function(t){h(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):g(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}({},t.getState().terminal.terminals);delete n[e],t.dispatch({type:"SET_TERMINAL_NAMES",terminals:n})},initializeProjectTerminals:async function(e){const a=t.getState().project.collaborationProperties.currentUserAccessType;if((0,n.C5)(a,i.EJ.RUN_TERMINAL)){const n=await e.getExistingTerminals();await y();const i=n.map((({terminalContents:t,terminalId:n,name:i,createdAt:a,terminalColumns:c,terminalRows:l,version:u})=>{const d=s(e,n);if(!d)return(0,r.D)(new Error("Failed to create while initializing project terminals. Likely we failed to load xterm."),"error"),null;const{terminal:p,listener:f}=d;return p.resize(c,l),p.write(t),o[n]={terminal:p,version:u,listenerStore:[f]},{[n]:{name:i,createdAt:a}}})).filter(Boolean);t.dispatch({type:"SET_TERMINAL_NAMES",terminals:Object.assign({},...i)})}else t.dispatch({type:"SET_TERMINAL_NAMES",terminals:{}})},terminalStdOut:async function(e,t,o){const{terminalId:r,version:n,content:i}=t;if(n===e.version+1)e.terminal.write(i),e.version=n;else{const{terminalContents:t,version:n}=await o.refetchTerminal(r);e.terminal.reset(),e.terminal.write(t),e.version=n}},isTerminalLoaded:function(){return Boolean(m.current)}}}},4850:(e,t,o)=>{"use strict";function r(){return"undefined"!=typeof window&&window.navigator.platform.includes("Mac")}o.d(t,{C0:()=>l,OJ:()=>n,Rx:()=>u,V5:()=>r,aJ:()=>a,eS:()=>d,kQ:()=>s,q9:()=>c,yl:()=>i});function n(e){return"ready"===e}function i(e){return"submitted"===e||"scaling-up"===e}function a(e){return"stopping"===e}function s(e){return"not-exist"===e}function c(e){return l(e)||"not-exist"===e}function l(e){return e.includes("error")}function u(e){return"idle"===e||"busy"===e}const d=e=>e.startsWith("int")||e.startsWith("short")||e.startsWith("long")||e.startsWith("float")||e.startsWith("half")||e.startsWith("single")||e.startsWith("double")||e.startsWith("byte")||e.startsWith("uint")||e.startsWith("ushort")||e.startsWith("ulong")||e.startsWith("ubyte")},89146:(e,t,o)=>{"use strict";o.d(t,{Is:()=>l,Kw:()=>d,Sx:()=>p,kd:()=>u});var r=o(13636),n=o(11506),i=o.n(n),a=o(27704),s=o(87340),c=o(51625);function l(e){const t=decodeURIComponent(e.split(/#|\?/)[0]).split("/").pop();return null!=t?t:"url-uploaded-file"}const u=e=>{s.Z.error({message:(0,c.BX)("div",{children:['A file "',i()(e,{length:25}),"\" you're trying to upload exceeds the maximum size limit of ",a.Zi/1e9,"GB.",(0,c.BX)("a",{href:r._.docsPage("deepnote-shared-datasets"),target:"_blank",rel:"noreferrer",style:{cursor:"pointer"},children:[" ","Upload it as a ",(0,c.tZ)("strong",{children:"Shared dataset"})," instead."]})]}),duration:5*a.Ln})},d=e=>e.size>a.Zi;function p(e){return Math.floor(e.loaded/e.total*100)}},62039:(e,t,o)=>{"use strict";o.d(t,{F:()=>r});const r=[]},49512:(e,t,o)=>{"use strict";o.d(t,{GS:()=>Be,gs:()=>$e,h_:()=>He});var r=o(93102),n=o(91987),i=o(1067),a=o(3285);const s=e=>{const{store:t}=e,o={async getMentionableCollaborators(){const o=t.getState().project,r=o.collaborationProperties,n=[r.owner,...r.collaborators].filter((e=>e.name)).map((e=>e)),s=o.owner;if((0,i.Ul)(o.owner.teamAccessType))return new Set(n);const c=await e.commonApi.getTeamMembersBySlug(s.slug).then((e=>e.filter((e=>e.name)).map((e=>({email:e.email,name:e.name,avatar:e.avatar}))))).catch((e=>((0,a.D)(e,"error"),[])));return new Set([...n,...c])},openCommentContainer(e){t.dispatch({type:"OPEN_COMMENT_CONTAINER",cellId:e})},closeCommentContainer(e){t.dispatch({type:"CLOSE_COMMENT_CONTAINER",cellId:e})},closeAllCommentContainers(){t.dispatch({type:"CLOSE_ALL_COMMENT_EDITORS"})},openCommentEditMode(e,o){t.dispatch({type:"OPEN_COMMENT_EDIT_MODE",cellId:e,commentId:o})},closeCommentEditMode(e,o){t.dispatch({type:"CLOSE_COMMENT_EDIT_MODE",cellId:e,commentId:o})},openNewCommentEditor(e){t.dispatch({type:"OPEN_NEW_COMMENT_EDITOR",cellId:e})},closeNewCommentEditor(e){t.dispatch({type:"CLOSE_NEW_COMMENT_EDITOR",cellId:e})}};return o};var c=o(77424),l=o(87340);const u=e=>{const{store:t}=e,o=[c.TD.EDIT_NOTEBOOK,c.TD.NEW_FILE,c.TD.DELETE_FILE],r={async setCommentsNotificationPreferences(e){var o,r,n;const{isSetByUser:i}=e;if(t.getState().user.is_anonymous)return;const s=t.getState().project.id,c=null!==(o=null===(r=t.getState().config.commentsNotificationPreferences)||void 0===r?void 0:r.preference)&&void 0!==o?o:null;if(!(null===(n=t.getState().config.commentsNotificationPreferences)||void 0===n?void 0:n.isSetByUser)||i){t.dispatch({type:"SET_COMMENT_NOTIFICATION_PREFERENCE",preferences:e});try{const t=await fetch(`/api/project/${s}/notifications`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(e)});if(!t.ok)throw new Error(t.statusText)}catch(e){l.Z.error({message:"There was an error setting notification preference"}),(0,a.D)(e,"error"),t.dispatch({type:"SET_COMMENT_NOTIFICATION_PREFERENCE",preferences:{preference:c,isSetByUser:!1}})}}},setCommentsNotificationPreferencesForFirstEdit(){var e;null===(()=>{var e;const r=t.getState().history.projectLogs,n=t.getState().user.id;return null!==(e=null==r?void 0:r.find((e=>o.includes(e.type)&&e.userId===n)))&&void 0!==e?e:null})()&&"all_threads"!==(null===(e=t.getState().config.commentsNotificationPreferences)||void 0===e?void 0:e.preference)&&r.setCommentsNotificationPreferences({preference:"all_threads",isSetByUser:!1}).catch((e=>{(0,a.D)(e,"warning")}))},setCommentsDisplayPreferences(e){t.dispatch({type:"SET_COMMENT_DISPLAY_PREFERENCES",option:e})}};return r};var d=o(23278),p=o(19941),f=o(21324),g=o(38046),h=o(4850);const m=e=>{const{blockTransforms:t,controllerRef:o,slateRef:r,store:n}=e,i={async submitOpsToUndoStackAndCurrentFile(e,t=!0){var r,n;const i=null===(r=o.current)||void 0===r?void 0:r.getFocusedFileUndoStack(),s=null===(n=o.current)||void 0===n?void 0:n.getFocusedDoc();return new Promise(((o,r)=>{if(i&&i.addOps(e),null==s||!s.type){const e=new Error("Trying to submit ops, but there is no doc");return s?(0,a.D)(e,"fatal",{doc:{type:s.type,id:s.id,collection:s.collection,version:s.version}}):(0,a.D)(e,"fatal"),void r(e)}s.submitOp(e,{source:!0},(e=>{if(e)return t&&l.Z.error({message:"The operation could not be performed"}),r(e);o()}))}))},triggerEditorHoverCallback(e,t){var r;const n=null===(r=o.current)||void 0===r?void 0:r.editorRefs[t];null!=n&&n.current&&n.current.onHover(e)},async requestBlockApiAutocomplete(e,r){if(!o.current)return;if(!t.getBlockById(e.cellId))return void(0,a.D)(new Error(`Tried to request autocomplete for cell ${e.cellId} that isn't present in the notebook`),"error");const n=o.current.getControlChannelApi(),i=this._getAutocompleteBlocks();return i?null==n?void 0:n.requestAutocomplete(e,r,i):void 0},async requestBlockApiHover(e,t){const r=g.q.selectHardwareStatus(n.getState());if((0,h.OJ)(r)&&o.current){const r=o.current.getControlChannelApi(),n=this._getAutocompleteBlocks();if(!n)return;return null==r?void 0:r.requestHover(e,t,n)}},async requestBlockApiSignatureHelp(e,t){const r=f.W.selectIsConnected(n.getState()),i=g.q.selectHardwareStatus(n.getState());if(r&&(0,h.OJ)(i)&&o.current){const r=o.current.getControlChannelApi(),n=this._getAutocompleteBlocks();if(!n)return;return null==r?void 0:r.requestSignatureHelp(e,t,n)}},_getAutocompleteBlocks(){const e=t.getCodeBlocks({excludeShellBlocks:!0});if(e)return e.map((e=>({id:e.id,source:(0,p.y)(e)})));{const e=new Error("Cannot collect code blocks, missing Slate instance");(0,a.D)(e,"error")}},getBlocksForInlineCodeCompletion(e,o){const r=t.getBlocksByTypes(e);if(!r){const e=new Error("Cannot collect blocks for code completion, missing Slate instance");return(0,a.D)(e,"error"),null}return null!=o&&o.integrationId?r.filter((e=>{var t;return"sql"!==e.type||(null===(t=e.metadata)||void 0===t?void 0:t.sql_integration_id)===o.integrationId})):r},setFileEditorPosition(t,o){var r,n,i;const a=null===(r=e.notebookApi.getEditorRef("file-editor"))||void 0===r||null===(n=r.current)||void 0===n?void 0:n.editorInstance,s=null==a||null===(i=a.getModel())||void 0===i?void 0:i.getPositionAt(t);s&&(null==a||a.setPosition(s),null!=o&&o.alsoScrollEditor&&(null==a||a.revealLine(s.lineNumber)))},undo(){var e;if(r.current)return void r.current.undoEdit();const t=null===(e=o.current)||void 0===e?void 0:e.getFocusedFileUndoStack();if(!t)return(0,a.D)(new Error("Trying to undo but there is no undostack"),"warning");const n=t.undo();null!==n&&i.setFileEditorPosition(n,{alsoScrollEditor:!0})},redo(){var e;if(r.current)return void r.current.redoEdit();const t=null===(e=o.current)||void 0===e?void 0:e.getFocusedFileUndoStack();if(!t)return(0,a.D)(new Error("Trying to redo but there is no undostack"),"warning");const n=t.redo();null!==n&&i.setFileEditorPosition(n,{alsoScrollEditor:!0})}};return i};var y=o(78303),b=o(21823),v=o(11524),E=o(80351),w=o(32902),k=o.n(w),S=o(66648),C=o.n(S),_=o(8097),T=o(33161),I=o(45060),A=o(69299),O=o(86401),P=o(29975),j=o(89146),D=o(15531),N=o(26199);const L=e=>{const{controllerRef:t,store:o,notebooksFetcher:r,gettingStartedMutator:n}=e,s=o.dispatch,u=async r=>{e.commentsPreferencesApi.setCommentsNotificationPreferencesForFirstEdit();try{var n;const e=null===(n=t.current)||void 0===n?void 0:n.getControlChannelApi(),a=o.getState().project.collaborationProperties.currentUserAccessType;if(!(0,i.C5)(a,c.EJ.MANIPULATE_FILES))return await Promise.reject(new Error("Not enough permissions"));if(!e)throw new Error("The controlChannelApi is not available in createNewNotebookInDB()");return await e.createNotebookInDB(r)}catch(e){throw(0,a.D)(e,"fatal"),new Error("Failed to create notebook")}},d={decompressFile:async e=>{var r;const n=null===(r=t.current)||void 0===r?void 0:r.getControlChannelApi(),a=o.getState().project.collaborationProperties.currentUserAccessType;if((0,i.C5)(a,c.EJ.MANIPULATE_FILES))return await(null==n?void 0:n.decompressContents(e).catch((()=>l.Z.error({message:"Not able to decompress the file"})))),l.Z.success({message:"File was successfully decompressed"})},deleteFile:r=>{var n;const a=null===(n=t.current)||void 0===n?void 0:n.getControlChannelApi(),s=o.getState().project.collaborationProperties.currentUserAccessType;if(!(0,i.C5)(s,c.EJ.MANIPULATE_FILES))return;e.commentsPreferencesApi.setCommentsNotificationPreferencesForFirstEdit();const u=o.getState().project.focusedItem;((0,D.rN)(u)||(0,D.JF)(u))&&u.relativePath===r&&o.dispatch((0,I.Kz)()),null==a||a.deleteItem(r).catch((()=>{l.Z.error({message:"File could not be deleted"})}))},deleteNotebookInDb:async r=>{var n;const a=o.getState().project.collaborationProperties.currentUserAccessType;if(!(0,i.C5)(a,c.EJ.MANIPULATE_FILES))return;e.commentsPreferencesApi.setCommentsNotificationPreferencesForFirstEdit();const s=null===(n=t.current)||void 0===n?void 0:n.getControlChannelApi();try{await(null==s?void 0:s.deleteNotebookInDB(r))}catch(e){l.Z.error({message:"Unable to delete a notebook. Please contact support."})}},createNewItem:async(r,n)=>{var a;const u=null===(a=t.current)||void 0===a?void 0:a.getControlChannelApi(),d=o.getState().project.collaborationProperties.currentUserAccessType;if(!(0,i.C5)(d,c.EJ.MANIPULATE_FILES))return Promise.reject(new Error("Not enough permissions"));e.layoutApi.switchProjectSidebarTab("project");const p=o.getState().project.focusedItem,f="file"===(null==p?void 0:p.type)&&p.relativePath,g=null!=n?n:f?C().dirname(f):"/";let h=g;const m=[];for(;"/"!==h;)m.push(h),h=C().dirname(h);const y=C().join(null!=g?g:"/","untitled");e.commentsPreferencesApi.setCommentsNotificationPreferencesForFirstEdit();try{const e=await(null==u?void 0:u.createNewItem(y,r));return s({type:I.xg.SET_RENAMING_FILE_PATH,renamingFilePath:e}),s({type:I.xg.SET_LATEST_CREATED_FILE_PATH,latestCreatedFilePath:e}),s({type:I.xg.SET_EXPANDED_DIRS,expandedDirPaths:k()([...o.getState().filesystem.expandedDirPaths,...m])}),await Promise.resolve(e)}catch(e){return l.Z.error({message:`Unable to create a new ${"directory"===r?"folder":r}`}),Promise.reject(e)}},createNewNotebookInDB:u,createNewNotebookInDBWithUniqueName:async()=>{const e=await r.fetchNotebooks(o.getState().project.id),t=(0,b.js)(e,"Notebook",{separator:" ",startWithNumber:!0});return u(t)},duplicateItem:async r=>{var n;const a=null===(n=t.current)||void 0===n?void 0:n.getControlChannelApi(),u=o.getState().project.collaborationProperties.currentUserAccessType;if((0,i.C5)(u,c.EJ.MANIPULATE_FILES)){e.commentsPreferencesApi.setCommentsNotificationPreferencesForFirstEdit();try{const e=await(null==a?void 0:a.duplicateItem(r));return s({type:I.xg.SET_RENAMING_FILE_PATH,renamingFilePath:e}),await Promise.resolve(e)}catch(e){return l.Z.error({message:"Unable to duplicate a file"}),Promise.reject(e)}}},duplicateNotebookInDb:async r=>{var n;const a=o.getState().project.collaborationProperties.currentUserAccessType;if(!(0,i.C5)(a,c.EJ.MANIPULATE_FILES))return;e.commentsPreferencesApi.setCommentsNotificationPreferencesForFirstEdit();const s=null===(n=t.current)||void 0===n?void 0:n.getControlChannelApi();try{return await(null==s?void 0:s.duplicateNotebookInDB(r))}catch(e){l.Z.error({message:"Unable to duplicate a notebook. Please contact support."})}},getDownloadLink(e){const t=o.getState().project.id;return(0,A.uX)(e,t)},getExportLink:()=>`/api/project/${o.getState().project.id}/export`,cancelFileRename(){const e=o.getState().project.collaborationProperties.currentUserAccessType;(0,i.C5)(e,c.EJ.MANIPULATE_FILES)&&s({type:I.xg.SET_RENAMING_FILE_PATH})},startFileRename(e){const t=o.getState().project.collaborationProperties.currentUserAccessType;(0,i.C5)(t,c.EJ.MANIPULATE_FILES)&&s({type:I.xg.SET_RENAMING_FILE_PATH,renamingFilePath:e})},async renameFile(r,n){const u=o.getState().filesystem.latestCreatedFilePath,d=u===r;u&&s({type:I.xg.SET_LATEST_CREATED_FILE_PATH});const p=o.getState().filesystem.entities,f=Object.values(p).find((e=>e.relativePath===r));if(!f){const e="File you are trying to rename no longer exist.";return l.Z.error({message:e}),s({type:I.xg.SET_RENAMING_FILE_PATH}),void(0,a.D)(new Error(e),"error")}if(r!==n){const e=o.getState().project.collaborationProperties.currentUserAccessType;if(!(0,i.C5)(e,c.EJ.MANIPULATE_FILES)){const e="You do not have an authorization to rename this file.";return l.Z.error({message:e}),s({type:I.xg.SET_RENAMING_FILE_PATH}),void(0,a.D)(new Error(e),"error")}try{var g;const e=null===(g=t.current)||void 0===g?void 0:g.getControlChannelApi();await(null==e?void 0:e.renameItem(r,n))}catch(e){const t="Error while renaming or moving file.";return l.Z.error({message:t}),s({type:I.xg.SET_RENAMING_FILE_PATH}),void(0,a.D)(e,"error")}}const h=o.getState().project.focusedItem,m=(0,D.rN)(h)||(0,D.JF)(h)?h:null;f.relativePath===(null==m?void 0:m.relativePath)&&s({type:I.Vm.UPDATE_FOCUSED_ITEM,item:{relativePath:n}}),d&&(0,v.zE)(f)&&(s({type:I.xg.CHANGE_PATH,oldPath:r,newPath:n}),e.projectFocusApi.setActiveFile(n).catch((e=>(0,a.D)(e,"warning")))),s({type:I.xg.SET_RENAMING_FILE_PATH})},async renameNotebookInDb(e,r,n,s){const u=o.getState().project.collaborationProperties.currentUserAccessType;if((0,i.C5)(u,c.EJ.MANIPULATE_FILES))try{var d;const o=null===(d=t.current)||void 0===d?void 0:d.getControlChannelApi();await(null==o?void 0:o.renameNotebookInDB(e,r,n,s))}catch(e){const t="Error while renaming or moving notebook.";l.Z.error({message:t}),(0,a.D)(e,"error")}},async refreshFilesystem(){var e;await(null===(e=t.current)||void 0===e?void 0:e.refreshFilesystem())},isFilePathEmpty:e=>!o.getState().filesystem.entities[e],async cloneGitRepo(e,t,r,n){const i=o.getState().config.collaborationServiceUrl,a=o.getState().project.id;return fetch(`${i}/project/${a}/upload-file-from-url`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({downloadUrl:e,targetFolderPath:t,oauthToken:r,type:n})})},async uploadItemFromUrl(e,t,r,n){const i=o.getState().config.collaborationServiceUrl,a=o.getState().project.id,c=d.addUploadingItem(n,t),u=await fetch(`${i}/project/${a}/upload-file-from-url`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({downloadUrl:e,targetFolderPath:r})});if(u.ok)o.getState().modalManager.openedModal!==I.Qi.FILE_UPLOAD_MODAL?(l.Z.success({message:`${t} has been uploaded successfully!`}),s({type:I.xg.REMOVE_UPLOADING_ITEMS,uuids:[c]})):d.updateUploadingItemStatus(c,P.D.DONE);else{if(507===u.status)(0,j.kd)(e);else{const e=406===u.status?"Your URL is badly formed or contains invalid characters":"An error ocurred while uploading the file.";l.Z.error({message:e})}d.updateUploadingItemStatus(c,P.D.ERROR)}},async readMissingPaths(e){var r;const n=null===(r=t.current)||void 0===r?void 0:r.getControlChannelApi(),i=e.map((e=>o.getState().filesystem.entities[e])).filter((e=>e&&"directory"===e.type&&(void 0===e.children||0===e.children.length))).map((e=>e.relativePath));await(null==n?void 0:n.fetchFilesystemEntities(i).then((e=>{s({type:I.xg.ENTITIES_LOADED,entities:e,partial:!0})})).catch((()=>{s({type:I.xg.SET_FILESYSTEM_UNAVAILABLE,isUnavailable:!0})})))},async uploadLocalFile(r,a,u,p=!1){const f=o.getState().project.collaborationProperties.currentUserAccessType;if((0,i.C5)(f,c.EJ.MANIPULATE_FILES)){if(!(0,j.Kw)(r))return new Promise(((i,c)=>{var f,g;const h=d.addUploadingItem(P.A.LOCAL,null!==(f=r.path)&&void 0!==f?f:r.name,r.size),m=o.getState().project.id,y=new FormData,b=null!=a?a:"/",v=C().join(b,C().dirname(null!==(g=r.path)&&void 0!==g?g:""));y.append("targetFolderPath",v),y.append("file",r,r.name),u&&y.append("uploadNotebooksToDb","true");const w=e=>{p||l.Z.error({message:"An error occurred while uploading the files."}),d.updateUploadingItemStatus(h,P.D.ERROR),c(new Error("An error occurred while uploading the files."))},k=new XMLHttpRequest;k.upload.addEventListener("progress",(e=>{e.lengthComputable&&d.updateUploadingItemProgress(h,(0,j.Sx)(e))}),!1),k.addEventListener("load",(a=>{var c;if(k.status>=400)return void w();o.getState().modalManager.openedModal===I.Qi.FILE_UPLOAD_MODAL||p?d.updateUploadingItemStatus(h,P.D.DONE):l.Z.success({message:`${r.name} has been uploaded successfully!`}),null===(c=t.current)||void 0===c||c.refreshFilesystem().then((()=>{s({type:I.xg.REMOVE_UPLOADING_ITEMS,uuids:[h]})}));try{const e=k.responseText,t=JSON.parse(e);i({uploadedFilePath:t.uploadedFilePath,uploadedNotebookId:t.uploadedNotebookId})}catch(e){i(void 0)}const u=o.getState().filesystem.entities,f=2===Object.keys(u).filter((e=>e.includes(".ipynb"))).length;r.name.includes(".ipynb")&&f&&e.projectFocusApi.setActiveFile(C().join(v,r.name)).catch(console.error);const g=Object.keys(u).filter((e=>e.includes(".csv"))).length<1;if(r.name.includes(".csv")&&g){const e=o.getState().project.team_id;n.updateGettingStartedStepCompletionData(e,E.R.DATA_CONNECTION_SUBSTEP_CSV_UPLOADED)}}),!1),k.addEventListener("error",(e=>{w()}),!1),k.open("POST",`/api/project/${m}/upload-file`),k.withCredentials=!0,k.send(y)}));(0,j.kd)(r.name)}else l.Z.warning({message:"You need at least Edit-level access to upload files"})},async saveFile(t){await(0,_.V)(e.fileSaver.saveFile(t),5e3)},async saveActiveFile(){const t=o.getState().project.focusedItem;(0,D.rN)(t)&&await e.fileSaver.forceSave(t.id).catch((e=>(0,a.D)(e,"warning")))},async generateInitNotebook(){var e;const o=null===(e=t.current)||void 0===e?void 0:e.getControlChannelApi();return null==o?void 0:o.generateInitNotebook()},async generateDockerfile(){var e;const o=null===(e=t.current)||void 0===e?void 0:e.getControlChannelApi();return null==o?void 0:o.generateDockerfile()},addUploadingItem(e,t,o){const r=(0,T.Z)();return s({type:I.xg.ADD_UPLOADING_ITEM,source:e,name:t,size:o,uuid:r}),r},setIsTooltipOpen(e){s({type:I.xg.SET_IS_TOOLTIP_OPEN,isOpen:e})},updateUploadingItemStatus(e,t){s({type:I.xg.UPDATE_UPLOADING_ITEM_STATUS,uuid:e,status:t})},updateUploadingItemProgress(e,t){s({type:I.xg.UPDATE_UPLOADING_ITEM_PROGRESS,uuid:e,progress:t})},removeUploadedItems(){const e=[];for(const[t,r]of Object.entries(o.getState().filesystem.uploadingItems))r.status===P.D.DONE&&e.push(t);s({type:I.xg.REMOVE_UPLOADING_ITEMS,uuids:e})},removeUploadedItemsById(e){s({type:I.xg.REMOVE_UPLOADING_ITEMS,uuids:e})},collapseDirectory(e){const{expandedDirPaths:t}=o.getState().filesystem;t.includes(e.relativePath)&&(0,v.IQ)(e)&&s({type:I.xg.SET_EXPANDED_DIRS,expandedDirPaths:t.filter((t=>t!==e.relativePath))})},async expandDirectory(e){const{expandedDirPaths:t}=o.getState().filesystem,r=t.includes(e.relativePath),n=[...t,e.relativePath];if(!r&&(0,v.IQ)(e))return s({type:I.xg.SET_EXPANDED_DIRS,expandedDirPaths:n}),d.readMissingPaths(n)},setDraggedId(e){s({type:I.xg.SET_DRAGGED_ID,id:e})},setDraggedOverId(e){s({type:I.xg.SET_DRAGGED_OVER_ID,id:e})},async handleDrop(e,t){const{entities:r}=o.getState().filesystem,n=r[t];if(!(0,A._U)(e.relativePath,n.relativePath))return;if(t===e.relativePath||!n)return;const i=(0,A.Zg)(n,e);return d.renameFile(t,i)},resetDrag(){d.setDraggedId(""),d.setDraggedOverId("")},async appendTextToFile(r,n){var a;const s=o.getState().project.collaborationProperties.currentUserAccessType;if(!(0,i.C5)(s,c.EJ.MANIPULATE_FILES))return;const l=null===(a=t.current)||void 0===a?void 0:a.getControlChannelApi();d.isFilePathEmpty(r)&&await(null==l?void 0:l.createNewItem(r,"file"));const u=await(null==l?void 0:l.loadItem(r));if(!u||!t.current)throw new Error("A file we just ensured exists could not be loaded");const p=await e.itemFocusApi.loadDocAndSubscribe(u.id,r);if(!p)throw new Error("The doc of a file we just ensured exists could not be loaded");const f=p.data,g=f.length;let h=n;g>0&&"\n"!==f.charAt(g-1)&&(h="\n"+n),await(0,O.EM)((e=>p.submitOp([{p:[g],si:h}],void 0,e)))},openFileInNewTab(e){const t=o.getState().project,r=(0,N.g)({project:t,filePath:e.relativePath});window.open(r.fullUrlWithFile)},async selectFile(t){const{filesystem:r}=o.getState(),n=r.renamingFilePath===t.relativePath,i=r.expandedDirPaths.includes(t.relativePath),a=r.loadingFilePath===t.relativePath;if(!n){if(!i&&(0,v.IQ)(t))return d.expandDirectory(t);if(i&&(0,v.IQ)(t)&&d.collapseDirectory(t),!(n||(0,v.IQ)(t)||a))return e.projectFocusApi.setActiveFile(t.relativePath)}},showRawCsv(){s({type:"SHOW_RAW_CSV"})},hideRawCsv(){s({type:"HIDE_RAW_CSV"})},async loadReadOnlyDocument(e){try{const t=this.getDownloadLink(e),o=await fetch(t,{method:"GET",credentials:"include",headers:{"Content-Type":"application/json"}});if(!o.ok)throw new Error(`loadReadOnlyDocument() failed, status: ${o.status}`);const r=await o.text();s({type:I.xg.SET_READONLY_DOCUMENT,path:e,content:r})}catch(e){throw(0,a.D)(e,"error"),new Error("Failed to load readonly document")}}};return d};var F=o(37936);function R(e){const{fileApi:t,store:o}=e,r={async connectIntegrationWithConfirmation(e,t){const n=o.getState().connection.hardwareStatus,i=(0,h.OJ)(n),a=o.getState().integrationsState.integrations.find((t=>t.id===e));if(!a)return!1;if(a.state===F.ws.ALWAYS_ON)return!0;if(i&&F.is.includes(a.type))return new Promise(((o,n)=>{t({title:"Connect integration to project?",content:"Your machine will be restarted, and your notebook variables will be cleared.",confirmText:"Connect integration",onConfirm:()=>{r.connectIntegration(e).then((()=>o(!0))).catch(n)}})}));const s=await r.connectIntegration(e);return!s.ok&&s.forcible?new Promise(((o,n)=>{t({title:"Interrupt running notebook to connect integration?",content:"We need to interrupt your notebook's execution in order to connect this integration now or you can connect the integration after the execution is finished",confirmText:"Interrupt and connect",onConfirm:()=>{r.connectIntegration(e,{force:!0}).then((()=>o(!0))).catch(n)}})})):s.ok},async disconnectIntegrationWithConfirmation(e,t){const r=o.getState().connection.hardwareStatus,i=(0,h.OJ)(r),a=o.getState().integrationsState.integrations.find((t=>t.id===e));if(!a)return;if(a.state===F.ws.ALWAYS_ON)return!0;if(i&&F.is.includes(a.type))return new Promise(((o,r)=>{t({title:"Disconnect integration?",content:"Your machine will be restarted, and your notebook variables will be cleared.",confirmText:"Disconnect integration",onConfirm:()=>{n(e).then((()=>o(!0))).catch(r)}})}));const s=await n(e);return!s.ok&&s.forcible?new Promise(((o,r)=>{t({title:"Interrupt running notebook to disconnect integration?",content:"We need to interrupt your notebook's execution in order to disconnect this integration now, or you can disconnect the integration after the execution is finished",confirmText:"Interrupt and disconnect",onConfirm:()=>{n(e,{force:!0}).then((()=>o(!0))).catch(r)}})})):void 0},async connectIntegration(e,r){o.dispatch({type:"INTEGRATION_STATE_SET",payload:{integrationId:e,nextState:F.ws.CONNECTING}});const n=o.getState().project.id,i=await U("connect",e,n,r);if(i.ok){o.dispatch({type:"INTEGRATION_STATE_SET",payload:{integrationId:e,nextState:F.ws.CONNECTED}});const r=o.getState().integrationsState.integrations.find((t=>t.id===e));r&&(0,F.D7)(r.state)&&await t.refreshFilesystem()}else o.dispatch({type:"INTEGRATION_STATE_SET",payload:{integrationId:e,nextState:F.ws.AVAILABLE}});return i},async refetchIntegrations(){const t=o.getState().project.id;await e.integrationFetcher.fetchAndStoreIntegrations(t)},async revokeIntegrationAuthToken(e){200!==(await fetch(`/auth/token/${e}`,{method:"DELETE",credentials:"include",headers:{"Content-Type":"application/json"}})).status&&(0,a.D)(new Error("Failed to revoke integration auth token"),"error",{integrationId:e})},setIntegrationOAuthDoneCallback(e,t,o={}){window.deepnote.oauthDoneCallback=n=>{n?(o.refetchIntegration&&r.refetchIntegrations(),e(!0)):((0,a.D)(new Error("Federated integration authentication failed"),"error",{integrationId:o.integrationId,federatedAuthType:o.federatedAuthType}),o.displayMessageInCaseOfError&&l.Z.error({message:"Failed to authenticate the integration. Please try again later or contact our support."}),t(new Error("Federated integration authentication failed")))}},authenticate:async(e,t,o,n={displayMessageInCaseOfError:!0,refetchIntegration:!0})=>new Promise(((a,s)=>{switch(e){case F.As.OKTA:window.open(`/auth/snowflake/okta/${t}?source=${o}`,void 0,"popup");break;case F.As.NATIVE_SNOWFLAKE:window.open(`/auth/snowflake/native/${t}?source=${o}`,void 0,"popup");break;case F.As.AZURE_AD:window.open(`/auth/snowflake/azuread/${t}?source=${o}`,void 0,"popup");break;case F.rw.GOOGLE_OAUTH:window.open(`/auth/bigquery/google-oauth/${t}?source=${o}`,void 0,"popup");break;default:(0,i.vE)(e)}r.setIntegrationOAuthDoneCallback(a,s,{federatedAuthType:e,integrationId:t,displayMessageInCaseOfError:n.displayMessageInCaseOfError,refetchIntegration:n.refetchIntegration})})),reAuthenticate:async(e,t)=>(await r.revokeIntegrationAuthToken(t),r.authenticate(e,t,"notebook"))},n=async(e,t)=>{o.dispatch({type:"INTEGRATION_STATE_SET",payload:{integrationId:e,nextState:F.ws.DISCONNECTING}});const r=o.getState().project.id,n=await U("disconnect",e,r,t);return n.ok?o.dispatch({type:"INTEGRATION_STATE_SET",payload:{integrationId:e,nextState:F.ws.AVAILABLE}}):o.dispatch({type:"INTEGRATION_STATE_SET",payload:{integrationId:e,nextState:F.ws.CONNECTED}}),n};return r}async function U(e,t,o,r){const n=await fetch(`/api/integration/connect/${t}/${o}`,{method:"connect"===e?"POST":"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({force:null==r?void 0:r.force})});if(n.ok)return{ok:!0};if(409===n.status)return{ok:!0};if(405===n.status)return{ok:!1,forcible:!0};{(0,a.D)(new Error(`Operation ${e} of ${t} to project ${o} failed with status ${n.status}`),"error");const r="connect"===e?"Failed to connect the integration to the project. Please try again later or contact our support.":"Failed to disconnect the integration from the project. Please try again later or contact our support.";return l.Z.error({message:r}),{ok:!1,forcible:!1}}}const x=e=>{const{store:t}=e,o=t.dispatch;return{switchProjectSidebarTab(e){o({type:"SWITCH_PROJECT_SIDEBAR_TAB",tab:e})}}};var M=o(14058),B=o(9551),H=o(38537),$=o(2809),W=o(16925),q=o(18434),G=o(28630),Z=o(79305),J=o(47358),z=o(57664),V=o(28424),Y=o(37354),Q=o(89304),K=o(82400),X=o(35928);function ee(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,r)}return o}function te(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?ee(Object(o),!0).forEach((function(t){oe(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):ee(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}function oe(e,t,o){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var o=e[Symbol.toPrimitive];if(void 0!==o){var r=o.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}const re=e=>{const{blockTransforms:t,controllerRef:o,store:r,projectTrack:n}=e,s=r.dispatch,u=e=>{l.Z.error({message:"The operation could not be performed"}),(0,a.D)(new Error(`ShareDB error: code ${e.code} - ${e.message}`),"error")};const d={canExecute(e){const t=r.getState().connection.hardwareStatus,o=r.getState().connection.isConnected,n=J.H.selectCurrentUserAccessType(r.getState()),a=!e||(0,i.C5)(n,c.EJ.EXECUTE_CELL);return t&&(0,h.OJ)(t)&&o&&a},splitCell(){const e=J.H.selectCurrentUserAccessType(r.getState());(0,i.C5)(e,c.EJ.MANIPULATE_CELLS)&&t.transact((()=>{const e=t.splitCell();e&&(n.track("Block split",{type:e.type}),d.focusCell(e.id))}))},async formatCell(e=null){const o=r.getState().config.formatterUrl,s=J.H.selectCurrentUserAccessType(r.getState());if(!o||!(0,i.C5)(s,c.EJ.MANIPULATE_CELLS))return l.Z.error({message:"Formatting failed"});try{await t.formatCell(e,(async e=>{const t=await fetch(o,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({snippet:e})});if(!t.ok)throw new Error(`Formatter failed with status ${t.status}`);const r=await t.json();if("InvalidInput"===r.errorType)return l.Z.error({message:"Parsing failed, please check your code for errors."}),null;if(r.errorMessage)throw new Error(r.errorMessage);return r})),n.track("Block formatted")}catch(e){console.log(e),(0,a.D)(e,"warning"),l.Z.error({message:"Formatting failed"})}},async publishProject(t,n,i,c,u={}){var d;const p=null!==(d=u.successMessage)&&void 0!==d?d:"Notebook was published successfully";if(t&&await e.fileApi.saveFile(t),i){var f;const e=null===(f=o.current)||void 0===f?void 0:f.getControlChannelApi();await(null==e?void 0:e.saveItem(i))}const g=r.getState().project.id,h=await fetch(`/api/project/${g}/publish`,{headers:{Accept:"application/json","Content-Type":"application/json"},credentials:"include",method:"POST",body:JSON.stringify({filesystemNotebookPath:n,publishedAccess:c,notebookInDbID:i})});if(h.ok)l.Z.info({message:p}),s(I.j7(n,new Date,c,i));else if(403===h.status)await l.Z.error({message:"Apps are not allowed to be shared publicly in your workspace. Contact a workspace admin to enable it."});else await l.Z.error({message:"Failed to publish project, please contact our support."}),(0,a.D)(new Error(`Failed to publish project. Response status: ${h.statusText}, body: ${await h.json()}`),"error")},async unpublishProject(e={}){var t,o;const n=null!==(t=e.errorMessage)&&void 0!==t?t:"Failed to unpublish project",i=null!==(o=e.successMessage)&&void 0!==o?o:"Notebook was unpublished successfully",c=r.getState().project.id,u=await fetch(`/api/project/${c}/publish`,{credentials:"include",method:"DELETE"});if(!u.ok)return l.Z.error({message:n}),void(0,a.D)(new Error(`Failed to unpublish project. Response status: ${u.statusText}`),"error");l.Z.info({message:i}),s(I.EO())},submitUserInput(e){var t;const r=null===(t=o.current)||void 0===t?void 0:t.getControlChannelApi();null==r||r.submitUserInput(e)},startHardwareAndRunCellById:async(e,t={})=>d.startHardwareAndRun((()=>d.executeCell(e,t)),!1).catch((e=>{(0,a.D)(e,"warning"),l.Z.error({message:"Executing block failed"})})),startHardwareAndRunCellsByIds:async(e,t={})=>d.startHardwareAndRun((()=>d.executeCellsByIds(e,t)),!1).catch((e=>{(0,a.D)(e,"warning"),l.Z.error({message:"Executing block failed"})})),async startHardwareAndRun(o,n){if(n){const e=t.getFocusedCellType();if(e&&"markdown"===e)return o()}const s=r.getState().connection.hardwareStatus;if((0,h.kQ)(s)){if(!await e.projectApi.startHardware())return;try{return await(0,i.PM)((()=>Promise.resolve((0,h.OJ)(r.getState().connection.hardwareStatus))),48e4,100,"Timed out waiting for running HW"),o()}catch(e){return l.Z.error({message:"Failed to start the machine. Try restarting it from the Environment tab, or contact support."}),void(0,a.D)(e,"error")}}return o()},async executeAll({skipSqlCache:t}={}){const o=J.H.selectCurrentUserAccessType(r.getState());if(!(0,i.C5)(o,c.EJ.EXECUTE_CELL))return;if(!r.getState().user.is_anonymous)return await e.projectApi.restartKernel(),d.startHardwareAndRun((()=>d._executeRange(null,null,{skipSqlCache:t})));e.modalApi.openModal({newModal:I.Qi.SIGN_IN_MODAL,title:"Sign up to run code",redirectTo:d._getLinkToCurrentLocation()})},async executeFromThisCell(t){const o=J.H.selectCurrentUserAccessType(r.getState());if(!(0,i.C5)(o,c.EJ.EXECUTE_CELL))return;if(!r.getState().user.is_anonymous)return d.startHardwareAndRun((()=>d._executeRange(t,null)));e.modalApi.openModal({newModal:I.Qi.SIGN_IN_MODAL,title:"Sign up to run code",redirectTo:d._getLinkToCurrentLocation()})},async executeAboveThisCell(t){const o=J.H.selectCurrentUserAccessType(r.getState());if(!(0,i.C5)(o,c.EJ.EXECUTE_CELL))return;if(!r.getState().user.is_anonymous)return d.startHardwareAndRun((()=>d._executeRange(null,t)));e.modalApi.openModal({newModal:I.Qi.SIGN_IN_MODAL,title:"Sign up to run code",redirectTo:d._getLinkToCurrentLocation()})},focusCell(e,o={}){const{position:n=null,align:i=null,initial:s=!1}=o;i&&d.scrollToCell(e,{initial:s,align:i});const c=J.H.selectFocusedItem(r.getState());if(!(0,D.hE)(c)){const e=new Error("focusCell works only on notebook files");return(0,a.D)(e,"warning")}t.focusCell(e,{position:n})},defocus(){t.defocus()},focusInitialCell(e){var t;const o=null===(t=r.getState().project.focusedItem)||void 0===t?void 0:t.relativePath,n=(0,Q.A6)(),i=(0,Q._R)();if(i&&o===n)return d.focusCell(i,{initial:!0,align:"center"}),void(0,Q.nr)(n);const a=(0,X.D)(e);a&&d.focusCell(a,{initial:!0,align:"center"})},doesPositionExist:e=>t.doesPositionExist(e),cellCanExecute(e){const o=J.H.selectCurrentUserAccessType(r.getState());if(!(0,i.C5)(o,c.EJ.EXECUTE_CELL))return!1;const n=t.getCellType(e);if("markdown"===n)return!0;if(!d.canExecute(!1))return!1;const a=g.q.createKernelStatusSelector()(r.getState()),s=z.l.createExecutionQueueSelector()(r.getState());return"executing"!==(0,Y.vj)(a,s,!1,e)||"visualization"===n},async fetchAst(){const e=f.W.selectIsConnected(r.getState()),t=d.getFocusedNotebookId();if(!t)return null;if(e&&o.current){const e=o.current.getControlChannelApi(),r=await d.startHardwareAndRun((()=>null==e?void 0:e.fetchBlockVariablesDAG(t)),!1);return console.log("AST",r),null!=r?r:null}return null},focusInputRequestEditor(){var e;const t=null===(e=d.getInputRequestEditorRef())||void 0===e?void 0:e.current;null==t||t.focus()},insertCellByType(e,o,i){var s;const l=z.l.createFocusedNotebookSelector()(r.getState()),u=J.H.selectCurrentUserAccessType(r.getState()),p=J.H.selectFocusedItem(r.getState());if(!l||!(0,Z.q)(u,c.EJ.MANIPULATE_CELLS,p))return;if("sql"===e&&(null==i||!i.integration))return void(0,a.D)(new Error("Attempting to insert an sql cell but integration was not provided."),"error",{cellType:e,where:o});const f=r.getState().project.published_at&&"article"===l.metadata.deepnote_app_layout||"powerful-article"===l.metadata.deepnote_app_layout?(0,X.Z8)(e,null):null,g=t.insertCellByType(e,o,te(te({},null!=i?i:{}),{},{hideCodeInPublishedApp:l.metadata.deepnote_app_hide_all_code_blocks_enabled,appCoordinates:f}));if(g){if(n.track("Block created",{parent:null==i?void 0:i.parent,type:e,location:o,projectId:null==i?void 0:i.projectId,button:null==i?void 0:i.button,accessType:u,integrationType:"sql"===e?null==i||null===(s=i.integration)||void 0===s?void 0:s.type:void 0}),"visualization"===g.type&&null!=i&&i.cellId){const e=t.getCellDataFrameVariableName(i.cellId);e&&(0,K.KJ)(e,d,g.id)}return d._focusAddedCell(g.id),g.id}},_focusAddedCell(e){d.focusCell(e,{align:"in-view"})},convertCell(e,o){const n=J.H.selectCurrentUserAccessType(r.getState());(0,i.C5)(n,c.EJ.MANIPULATE_CELLS)&&t.convertCell(e,o,{workspaceId:r.getState().project.team_id})},getCellSqlIntegrationId:e=>t.getCellSqlIntegrationId(e),async changeSqlCellIntegration(e,o){const n=J.H.selectCurrentUserAccessType(r.getState());(0,i.C5)(n,c.EJ.MANIPULATE_CELLS)&&await t.changeSqlCellIntegration(e,o)},async executeCell(s,u={}){if(r.getState().user.is_anonymous)return void e.modalApi.openModal({newModal:I.Qi.SIGN_IN_MODAL,title:"Sign up to run code",redirectTo:d._getLinkToCurrentLocation()});const p=J.H.selectCurrentUserAccessType(r.getState());if(!(0,i.C5)(p,c.EJ.EXECUTE_CELL))return;if(!s){var f;const e=null===(f=d.getInputRequestEditorRef())||void 0===f?void 0:f.current;if(null!=e&&e.isFocused())return void e.insert("\n")}const g=J.H.selectFocusedItem(r.getState());if(!(0,D.hE)(g))throw new Error("Execute works only on notebook files");const h=g.id;if(!h)return(0,a.D)(new Error("Trying to execute a cell, but there is not focused file"),"fatal"),void l.Z.error({message:"You need to focus a file in order to execute"});if(!d.cellCanExecute(s))return;const m=t.getBlockById(s);if(m){if((0,M.jk)(m.type)){if("sql"===m.type){const e=t.getCellSqlIntegrationId(m.id);if(!e)return void l.Z.info({message:"Select a database for this SQL block."});{const t=r.getState().integrationsState.integrations.find((t=>t.id===e));if(!t||!(0,G.L3)(t.state))return void l.Z.info({message:"Assign the SQL block to a connected integration."})}}"input-select"===m.type&&t.ensureSelectInputValidValue(m.id);try{var y;const a=te({cellId:m.id},(0,W.H)(m)),s=null===(y=o.current)||void 0===y?void 0:y.getControlChannelApi(),c=await(null==s?void 0:s.executeCells(h,[a],u.skipSqlCache)),l=r.getState().project,d=te({type:m.type,projectId:l.id,accessType:p,workspaceId:l.team_id},(e=>{const{cellId:o,cellType:n}=e;if("sql"===n){const e=t.getCellSqlIntegrationId(o),n=r.getState().integrationsState.integrations.find((t=>t.id===e));return{integrationType:null==n?void 0:n.type,integrationId:e}}return{}})({cellId:m.id,cellType:m.type}));if(n.track("Block executed",d),"InvalidFederatedOAuthCredentials"===(null==c?void 0:c.error)){const o=t.getCellSqlIntegrationId(m.id),n=(0,i.Xi)(r.getState().integrationsState.integrations,{integrationId:o});e.modalApi.openModal({newModal:I.Qi.PROMPT_FEDERATED_AUTH_SIGNIN,federatedAuthMethod:n.federatedAuthMethod,integrationId:n.id,integrationType:n.type,integrationName:n.name})}}catch(e){l.Z.error({message:"Could not execute block, please try again later"}),(0,a.D)(e,"error")}}u.selectBelow?d._focusOrCreateNextCell(m.id):"markdown"===m.type&&d.focusCell(m.id)}},async executeCellsByIds(e,o={}){const n=J.H.selectCurrentUserAccessType(r.getState());if((0,i.C5)(n,c.EJ.EXECUTE_CELL))try{var s;const r=(null!==(s=t.getBlocksByIds(e))&&void 0!==s?s:[]).filter((e=>(0,q.Uo)(e.block))).map((({block:e})=>e));if(0===r.length)return void l.Z.warning({message:"None of the blocks are runnable."});await d._executeBlocks(r,{skipSqlCache:Boolean(o.skipSqlCache)});const n=e.at(-1);o.selectBelow&&n&&d._focusOrCreateNextCell(n)}catch(e){l.Z.error({message:"Could not execute blocks, please try again later"}),(0,a.D)(e,"error")}},async _executeRange(e,o,n={}){const s=J.H.selectCurrentUserAccessType(r.getState());if((0,i.C5)(s,c.EJ.EXECUTE_CELL))try{const r=t.getExecutableBlocksInRange(e,o);if(!r){const e=new Error("No executable blocks in range");return(0,a.D)(e,"error"),void l.Z.warning({message:"None of the blocks are runnable."})}await d._executeBlocks(r,{skipSqlCache:Boolean(n.skipSqlCache)})}catch(e){l.Z.error({message:"Could not execute blocks, please try again later"}),(0,a.D)(e,"error")}},async _executeBlocks(t,n){var s;const c=J.H.selectFocusedItem(r.getState());if(!(0,D.hE)(c))throw new Error("_executeBlocks() works only on notebook files");const u=c.id;if(!u){const e=new Error("Trying to execute a block, but there is not focused file");return(0,a.D)(e,"fatal"),void l.Z.error({message:"You need to focus a file in order to execute"})}const d=null===(s=o.current)||void 0===s?void 0:s.getControlChannelApi();if(!d){const e=new Error("The controlChannelApi is not available in _executeBlocks()");return void(0,a.D)(e,"fatal")}const p=t.map((e=>te({cellId:e.id},(0,W.H)(e)))),f=await d.executeCells(u,p,n.skipSqlCache);if("InvalidFederatedOAuthCredentials"===(null==f?void 0:f.error)){const t=(0,i.Xi)(r.getState().integrationsState.integrations);e.modalApi.openModal({newModal:I.Qi.PROMPT_FEDERATED_AUTH_SIGNIN,federatedAuthMethod:t.federatedAuthMethod,integrationId:t.id,integrationType:t.type,integrationName:t.name})}},_focusOrCreateNextCell(e){const o=t.getNextAvailableCellId(e,{canBePreviousBlock:!1});if(o)return void d.focusCell(o,{align:"in-view"});const n=J.H.selectCurrentUserAccessType(r.getState());if(!(0,i.C5)(n,c.EJ.MANIPULATE_CELLS))return;const a=t.getBlockById(e),s=null==a?void 0:a.type;if("sql"===s){const t=r.getState().integrationsState.integrations.filter(c.Pv).find((e=>e.id===a.metadata.sql_integration_id));return d.insertCellByType(s,"below",{cellId:e,integration:t})}return"markdown"===s||"code"===s||"text-cell-p"===s?d.insertCellByType(s,"below",{cellId:e}):void 0},up(e){const o=J.H.selectCurrentUserAccessType(r.getState());if(!(0,i.C5)(o,c.EJ.MANIPULATE_CELLS))return;const n=t.up(e);n&&d.scrollToCell(n,{align:"center"})},down(e){const o=J.H.selectCurrentUserAccessType(r.getState());if(!(0,i.C5)(o,c.EJ.MANIPULATE_CELLS))return;const n=t.down(e);n&&d.scrollToCell(n,{align:"center"})},moveCellsUp(e){const o=J.H.selectCurrentUserAccessType(r.getState());if(!(0,i.C5)(o,c.EJ.MANIPULATE_CELLS))return;e.every((e=>t.up(e)));const n=e[0];n&&d.scrollToCell(n,{align:"center"})},moveCellsDown(e){const o=J.H.selectCurrentUserAccessType(r.getState());if(!(0,i.C5)(o,c.EJ.MANIPULATE_CELLS))return;const n=[...e].reverse();n.every((e=>t.down(e)));const a=n[0];a&&d.scrollToCell(a,{align:"in-view"})},moveCell(e,t,o){d.moveCells([e],e,t,o)},moveCells(e,o,n,a){const s=J.H.selectCurrentUserAccessType(r.getState());(0,i.C5)(s,c.EJ.MANIPULATE_CELLS)&&t.moveCells(e,o,n,a)},duplicateCell(e){const o=J.H.selectCurrentUserAccessType(r.getState());return(0,i.C5)(o,c.EJ.MANIPULATE_CELLS)?t.duplicateCell(e):null},duplicateCells(e){const o=J.H.selectCurrentUserAccessType(r.getState());return(0,i.C5)(o,c.EJ.MANIPULATE_CELLS)?t.duplicateCells(e):null},deleteCell(e){const o=J.H.selectCurrentUserAccessType(r.getState());if(!(0,i.C5)(o,c.EJ.MANIPULATE_CELLS))return;const n=t.getNextAvailableCellId(e,{canBePreviousBlock:!0});n&&d.focusCell(n,{align:"in-view"});z.l.createExecutionQueueSelector()(r.getState()).find((t=>t.cellId===e))&&d.interrupt(),t.deleteCell(e)},deleteCells(e){const o=J.H.selectCurrentUserAccessType(r.getState());if(!(0,i.C5)(o,c.EJ.MANIPULATE_CELLS))return;const n=e.at(-1),a=n?t.getNextAvailableCellId(n,{canBePreviousBlock:!0}):null;a&&d.focusCell(a,{align:"in-view"});z.l.createExecutionQueueSelector()(r.getState()).find((t=>e.includes(t.cellId)))&&d.interrupt(),t.deleteCells(e)},getFocusedNotebookId(){const e=J.H.selectFocusedItem(r.getState());return(0,D.hE)(e)?e.id:null},async interrupt(){var e,t;const n=J.H.selectCurrentUserAccessType(r.getState());if(!(0,i.C5)(n,c.EJ.EXECUTE_CELL))return;const s=g.q.createKernelStatusSelector()(r.getState());if(!d.canExecute(!1)||!(0,h.Rx)(s))return l.Z.closeAll(),void l.Z.info({message:"Machine is starting - please wait."});const u=J.H.selectFocusedItem(r.getState());if(!(0,D.hE)(u))throw new Error("interrupt works only on notebook files");const p=u.id;if(!p)return(0,a.D)(new Error("Trying to execute a cell, but there is not focused file"),"fatal"),void l.Z.error({message:"You need to focus a file in order to execute"});await(null===(e=o.current)||void 0===e||null===(t=e.getControlChannelApi())||void 0===t?void 0:t.interruptExecution(p))},async exportDataframe(e){var n,s;const u=J.H.selectCurrentUserAccessType(r.getState());if(!(0,i.C5)(u,c.EJ.EXECUTE_CELL))return;const p=g.q.createKernelStatusSelector()(r.getState());if(!d.canExecute(!1)||!(0,h.Rx)(p))return l.Z.closeAll(),void l.Z.info({message:"Machine is starting - please wait."});const f=J.H.selectFocusedItem(r.getState());if(!(0,D.hE)(f))throw new Error("Export works only in notebook files");const m=f.id;if(!m)return(0,a.D)(new Error("Trying to export data, but there is not focused file"),"fatal"),void l.Z.error({message:"You need to focus a file in order to export"});const y=t.getBlockById(e),b=y?(0,W.H)(y):null;return b?null===(n=o.current)||void 0===n||null===(s=n.getControlChannelApi())||void 0===s?void 0:s.exportDataframe(m,b):void 0},scrollToCell(...t){e.commonApi.scrollToCell(...t)},async clearAllCellOutputs(){const e=J.H.selectCurrentUserAccessType(r.getState());if(!(0,i.C5)(e,c.EJ.MANIPULATE_CELLS))return;const o=t.getAllBlockIds();return o?d.clearCellOutputsById(o):void 0},async clearCellOutputsById(e){var n,a,s,l;const u=J.H.selectCurrentUserAccessType(r.getState());if(!(0,i.C5)(u,c.EJ.MANIPULATE_CELLS))return;const p=d.getFocusedNotebookId();if(!p)return;const f=(null!==(n=null===(a=t.getBlocksByIds(e))||void 0===a?void 0:a.filter((({block:e})=>(0,q.Uo)(e)&&!e.state.output_cleared)))&&void 0!==n?n:[]).map((({block:e})=>e.id));0!==f.length&&await(null===(s=o.current)||void 0===s||null===(l=s.getControlChannelApi())||void 0===l?void 0:l.clearNotebookCellOutputs(p,f))},setCellSharingStatus(e,o){const n=J.H.selectCurrentUserAccessType(r.getState());(0,i.C5)(n,c.EJ.MANIPULATE_CELLS)&&(t.setCellSharingStatus(e,o),async function(e,t){const o=r.getState().project.id;await fetch(`/api/project/${o}/trackCellShareStatus/${e}`,{headers:{Accept:"application/json","Content-Type":"application/json"},credentials:"include",method:"POST",body:JSON.stringify({cellId:e,toggle:!1!==t})})}(e,o))},shareCell(t){e.modalApi.openModal({newModal:I.Qi.CELL_EMBED_MODAL,cellId:t})},toggleAllCellVisibility(e,o={}){const n=J.H.selectCurrentUserAccessType(r.getState());(0,i.C5)(n,c.EJ.MANIPULATE_CELLS)&&t.toggleAllCellVisibility(e,o)},toggleCellVisibility(e,o,n={}){const a=J.H.selectCurrentUserAccessType(r.getState());(0,i.C5)(a,c.EJ.MANIPULATE_CELLS)&&t.toggleCellVisibility(e,o,n)},addCellToApp(e,o={}){t.addCellToApp(e,o),n.track("App block added",{blockId:e,type:t.getCellType(e)})},updateCellAppCoordinates(e,o){t.updateCellAppCoordinates(e,o)},removeCellFromApp(e){t.removeCellFromApp(e),n.track("App block deleted")},toggleCellCodeInApp(e,o){t.toggleCellCodeInApp(e,o),o?n.track("App block code hidden"):n.track("App block code shown")},toggleCellOutputInApp(e,o){t.toggleCellOutputInApp(e,o),o?n.track("App block output hidden"):n.track("App block output shown")},setBlockDropdownPosition(e){s({type:"SET_BLOCK_ADDING_DROPDOWN_POSITION",position:e})},createArticleFromEmptyState(){t.createArticleFromEmptyState(),n.track("App layout set",{to:"article"})},createPowerfulArticleFromEmptyState(){t.createPowerfulArticleFromEmptyState(),n.track("App layout set",{to:"powerful-article"})},createDashboardFromEmptyState(){t.createDashboardFromEmptyState(),n.track("App layout set",{to:"dashboard"})},setAppLayout(e){var i,a;const s=null!==(i=null===(a=o.current)||void 0===a?void 0:a.getFocusedNotebookDoc())&&void 0!==i?i:null,c=z.l.createFocusedNotebookSelector()(r.getState());if(!s||!c)return;const l=c.metadata.deepnote_app_layout,d=[e?{p:["metadata","deepnote_app_layout"],oi:e}:{p:["metadata","deepnote_app_layout"],od:c.metadata.deepnote_app_layout}];s.submitOp(d,{source:!0},(e=>e&&u(e))),e||t.clearAllAppCoordinates(),n.track("App layout changed",{from:l,to:e})},getInputRequestEditorRef(){var e;return null===(e=o.current)||void 0===e?void 0:e.inputRequestEditorRef},getEditorRef(e){return"input-request"===e?d.getInputRequestEditorRef():"file-editor"===e?null===(t=o.current)||void 0===t?void 0:t.fileEditorRef:void 0;var t},async addToRequirements(t){t.length>0&&await e.fileApi.appendTextToFile("/requirements.txt",t.join("\n")+"\n")},async addToDockerfile(t){t.length>0&&await e.fileApi.appendTextToFile("/Dockerfile","\n"+t.join("\n"))},copyLinkToCell(e){const t=d._getLinkToCell(e),o=new URL(t);(0,B.n)(o.href),l.Z.success({message:"Link successfully copied."})},getLinkToFile(e){const t=r.getState(),{fullUrlWithFile:o}=(0,N.g)({project:t.project,filePath:e});return o},async editVisualizationCellSpec(e,o){const n=J.H.selectCurrentUserAccessType(r.getState());(0,i.C5)(n,c.EJ.MANIPULATE_CELLS)&&await t.editVisualizationCellSpec(e,o)},async editCellTableMetadata(e,t,n){var a;const s=J.H.selectCurrentUserAccessType(r.getState()),l=r.getState().user.is_anonymous,u=null===(a=o.current)||void 0===a?void 0:a.getControlChannelApi();(0,i.C5)(s,c.EJ.EXECUTE_CELL)&&!l&&u&&await u.updateCellTable(e,t,n)},editCellVariableName(e,o){const n=J.H.selectCurrentUserAccessType(r.getState()),i=J.H.selectFocusedItem(r.getState());(0,Z.q)(n,c.EJ.MANIPULATE_CELLS,i)&&t.editCellVariableName(e,o)},editInputCellSelectMetadata(e,o,n,a,s){const l=J.H.selectCurrentUserAccessType(r.getState());(0,i.C5)(l,c.EJ.MANIPULATE_CELLS)&&t.editInputCellSelectMetadata(e,o,n,a,s)},setCellColor(e,o){const n=J.H.selectCurrentUserAccessType(r.getState());(0,i.C5)(n,c.EJ.MANIPULATE_CELLS)&&t.setCellColor(e,o)},_getLinkToCurrentLocation(){const e=t.getFocusedCellId();return d._getLinkToCell(e)},_getLinkToCell(e){const t=r.getState().project,o=J.H.selectFocusedItem(r.getState()),{fullUrlWithFile:n}=(0,D.mt)(o)?(0,N.g)({project:t,urlHash:null!=e?e:void 0,notebookInDB:{id:o.id,name:o.name}}):(0,N.g)({project:t,filePath:"file"===(null==o?void 0:o.type)||"preview"===(null==o?void 0:o.type)?null==o?void 0:o.relativePath:void 0,urlHash:null!=e?e:void 0});return n},async executeAndCreateCodeCellBelow(e){const t=J.H.selectCurrentUserAccessType(r.getState());if((0,i.C5)(t,c.EJ.MANIPULATE_CELLS))return d.insertCellByType("code","below",{cellId:e}),d.startHardwareAndRun((()=>{d.executeCell(e,{selectBelow:!1})}),!0)},async sendCommMsg(e,t,n,i,a,s=!1,c=!0,l){var u;const d=J.H.selectFocusedItem(r.getState());if(!(0,D.hE)(d)||(0,D.rN)(d)&&!(0,D.G5)(d.relativePath))throw new Error("Can only send comm message in a notebook");if("request_state"===i.method){var p;if(await(null===(p=o.current)||void 0===p?void 0:p.widgetManager.handleStateRequest(e,t,n)))return Promise.resolve()}const f=null===(u=o.current)||void 0===u?void 0:u.getControlChannelApi();return null==f?void 0:f.commMsg(d.id,t,n,i,l,a,s,c)},registerIpyWidgetIframe(e,t){var r;null===(r=o.current)||void 0===r||r.widgetManager.setIframeMessenger(e,t)},unregisterIpyWidgetIframe(e){var t;null===(t=o.current)||void 0===t||t.widgetManager.removeIframeMessenger(e)},async updateCellLayoutMetadata(e,t){if(!o.current)return;const r=o.current.getControlChannelApi();await r.updateCellLayoutMetadata(e,t)},async requestCommInfo(){if(!o.current)return;const e=J.H.selectFocusedItem(r.getState());if(!(0,D.hE)(e)||(0,D.rN)(e)&&!(0,D.G5)(e.relativePath))throw new Error("Can only request comm info for a notebook");const t=g.q.createKernelStatusSelector()(r.getState());let n=o.current.widgetManager.getCachedCommInfo();if("idle"===t){const t=o.current.getControlChannelApi(),r=await t.requestCommInfo(e.id);"ok"===(null==r?void 0:r.content.status)?n=te(te({},n),r.content.comms):(0,a.D)(new Error("Failed to request info about available comms"),"error",{reply:r})}return n},async updateIPyWidgetState(e,t){var r;return null===(r=o.current)||void 0===r||r.widgetManager.updateWidgetState(e,t),Promise.resolve()},setIsDraggingBlocks(e){s({type:"SET_IS_DRAGGING_BLOCKS",isDraggingBlocks:e})},_isCellLockedByAnotherUser(e,t){const o=d._getCellOwner(e),n=r.getState().user.id,i=null!==o,a=o===n,s=0!==Object.values(t).filter((e=>e.user.id===o)).filter((t=>(0,V.$)(t)===e)).length;return i&&!a&&s},updateOwnershipAfterFocusChange(e,t){d._giveUpOwnershipOfOwnedCells({except:e?[e]:[]}),null!==e&&(d._isCellLockedByAnotherUser(e,t)||d.takeOwnershipOfCell(e))},_getCellOwner:e=>z.l.createOwnerCellIdSelector(e)(r.getState()),takeOwnershipOfCell(e){var n;const a=J.H.selectCurrentUserAccessType(r.getState());if(!(0,i.C5)(a,c.EJ.MANIPULATE_CELLS))return;const s=null===(n=o.current)||void 0===n?void 0:n.collabDoc;if(!s)return;const l=t.getBlockById(e);if(!l||!(0,X.fT)(l))return;const d={p:["cellOwnership",e],oi:{owner_user_id:r.getState().user.id}};s.submitOp([d],{source:!0},(e=>e&&u(e)))},_giveUpOwnershipOfOwnedCells(e){var n;const a=null===(n=o.current)||void 0===n?void 0:n.collabDoc;if(!a)return null;const s=t.getAllBlockIds();if(!s)return null;const c=r.getState().user.id,l=s.map((e=>d._getCellOwner(e)===c?e:null)).filter(i.Dw).filter((t=>!e.except.includes(t))).map((e=>({p:["cellOwnership",e],oi:{}})));a.submitOp(l,{source:!0},(e=>e&&u(e)))},setIntentToEditCell(e){s({type:"SET_INTENT_TO_EDIT_CELL",cellId:e})},async restoreSession(){const e=J.H.selectCurrentUserAccessType(r.getState());if(!(0,i.C5)(e,c.EJ.EXECUTE_CELL))return;const t=d.getFocusedNotebookId();if(t){try{var n;const e=null===(n=o.current)||void 0===n?void 0:n.getControlChannelApi();await d.startHardwareAndRun((()=>null==e?void 0:e.restoreNotebookSession(t)))}catch(e){throw l.Z.error({message:"Failed to restore variables, please contact support."}),e}l.Z.success({message:"Variables from your last session were restored succesfully!"})}},setFullWidth(e){var t,i;const a=null!==(t=null===(i=o.current)||void 0===i?void 0:i.getFocusedNotebookDoc())&&void 0!==t?t:null,s=z.l.createFocusedNotebookSelector()(r.getState());if(!a||!s)return;const c=[{p:["metadata","deepnote_full_width"],od:s.metadata.deepnote_full_width,oi:e}];a.submitOp(c,{source:!0},(e=>e&&u(e))),n.track("Full width mode switched",{to:e?"on":"off"})},toggleHideAllCodeBlocksInPublishedApp(e){var t,i;const a=null!==(t=null===(i=o.current)||void 0===i?void 0:i.getFocusedNotebookDoc())&&void 0!==t?t:null,s=z.l.createFocusedNotebookSelector()(r.getState());if(!a||!s)return;const c=[{p:["metadata","deepnote_app_hide_all_code_blocks_enabled"],od:s.metadata.deepnote_app_hide_all_code_blocks_enabled,oi:e}];a.submitOp(c,{source:!0},(e=>e&&u(e))),e?n.track("App blocks hidden"):n.track("App blocks shown")},toggleTableOfContentsInPublishedApp(e){var t,i;const a=null!==(t=null===(i=o.current)||void 0===i?void 0:i.getFocusedNotebookDoc())&&void 0!==t?t:null,s=z.l.createFocusedNotebookSelector()(r.getState());if(!a||!s)return;const c=[{p:["metadata","deepnote_app_table_of_contents_enabled"],od:s.metadata.deepnote_app_table_of_contents_enabled,oi:e}];a.submitOp(c,{source:!0},(e=>e&&u(e))),e?n.track("App TOC enabled"):n.track("App TOC disabled")},setPublishedAppWidth(e){var t,i;const a=null!==(t=null===(i=o.current)||void 0===i?void 0:i.getFocusedNotebookDoc())&&void 0!==t?t:null,s=z.l.createFocusedNotebookSelector()(r.getState());if(!a||!s)return;const c=[{p:["metadata","deepnote_app_width"],od:s.metadata.deepnote_app_width,oi:e}];a.submitOp(c,{source:!0},(e=>e&&u(e))),n.track("App width set",{width:e})},toggleAllowToRunPublishedApp(e){var t,i;const a=null!==(t=null===(i=o.current)||void 0===i?void 0:i.getFocusedNotebookDoc())&&void 0!==t?t:null,s=z.l.createFocusedNotebookSelector()(r.getState());if(!a||!s)return;const c=[{p:["metadata","deepnote_app_execution_enabled"],od:s.metadata.deepnote_app_execution_enabled,oi:e}];a.submitOp(c,{source:!0},(e=>e&&u(e))),e?n.track("App viewer execution enabled"):n.track("App viewer execution disabled")},toggleClearOutputsInPublishedApp(e){var t,i;const a=null!==(t=null===(i=o.current)||void 0===i?void 0:i.getFocusedNotebookDoc())&&void 0!==t?t:null,s=z.l.createFocusedNotebookSelector()(r.getState());if(!a||!s)return;const c=[{p:["metadata","deepnote_app_clear_outputs"],od:s.metadata.deepnote_app_clear_outputs,oi:e}];a.submitOp(c,{source:!0},(e=>e&&u(e))),e?n.track("App outputs auto-fill enabled"):n.track("App outputs auto-fill disabled")},toggleRunOnInputInPublishedApp(e){var t,i,a;const s=null!==(t=null===(i=o.current)||void 0===i?void 0:i.getFocusedNotebookDoc())&&void 0!==t?t:null,c=z.l.createFocusedNotebookSelector()(r.getState());if(!s||!c)return;const l=[{p:["metadata","deepnote_app_run_on_input_enabled"],od:null===(a=c.metadata.deepnote_app_run_on_input_enabled)||void 0===a||a,oi:e}];s.submitOp(l,{source:!0},(e=>e&&u(e))),e?n.track("App run on input enabled"):n.track("App run on input disabled")},exportChartFilterToCode(e){const o=t.getBlockById(e);if(!o||!(0,q.xV)(o))return;const r=o.metadata.deepnote_chart_filter;if(r)try{var i;const t=null!==(i=o.metadata.deepnote_variable_name)&&void 0!==i?i:"df",a=(0,$.TJ)(t),s=(0,$.ug)(t,a,r);d.insertCellByType("code","below",{cellId:e,source:s}),n.track("Chart selection exported",{blockId:e})}catch(e){l.Z.error({message:"Failed to export filtered DataFrame, please contact support."}),(0,a.D)(e)}},isDataframeSqlCellFocused(){const e=t.getFocusedCellId();if(!e)return!1;const o=t.getBlockById(e);return"sql"===(null==o?void 0:o.type)&&o.metadata.sql_integration_id===H.w8},toggleBlockAiCommandView(e,t){const o=r.getState().layout.blockAiCommandView,n=o.blockId===e&&o.isOpen;s(n?{type:"HIDE_BLOCK_AI_POPOVER",payload:{blockId:e}}:{type:"SHOW_BLOCK_AI_POPOVER",payload:{blockId:e,command:null!=t?t:null}})},showBlockAiCommandView(e){s({type:"SHOW_BLOCK_AI_POPOVER",payload:{blockId:e,command:null}})},hideBlockAiCommandView(e){s({type:"HIDE_BLOCK_AI_POPOVER",payload:{blockId:e}})},updateImageCellAlignment(e,o){const n=J.H.selectCurrentUserAccessType(r.getState());(0,i.C5)(n,c.EJ.MANIPULATE_CELLS)&&t.updateImageCellAlignment(e,o)},updateImageCellWidth(e,o){const n=J.H.selectCurrentUserAccessType(r.getState());(0,i.C5)(n,c.EJ.MANIPULATE_CELLS)&&t.updateImageCellWidth(e,o)}};return d};var ne=o(98960),ie=o(85110),ae=o.n(ie),se=o(84888);const ce=500,le=e=>{const{blockTransforms:t,controllerRef:o,notebookApi:r,store:n}=e,s=n.dispatch;let l=[],u=[];const d=ae()((()=>{l.length>0&&(s({type:"UPDATE_CELL_OUTPUT_HEIGHT",payload:l}),l=[])}),ce,{maxWait:ce}),p=ae()((()=>{u.length>0&&(s({type:"UPDATE_CELL_HEIGHT",payload:u}),u=[])}),ce,{maxWait:ce}),f=ae()((e=>{const o=J.H.selectCurrentUserAccessType(n.getState()),a=t.getAllBlockIds();if(!a||!(0,i.C5)(o,c.EJ.MANIPULATE_CELLS))return;const s=se.r.selectCurrentLayout(n.getState())[e];if(!s)return;const l={};Object.entries(s.cells).forEach((([e,t])=>{var o;t&&a.includes(e)&&(l[e]=null!==(o=l[e])&&void 0!==o?o:{},l[e].deepnote_cell_height=t)})),Object.entries(s.outputs).forEach((([e,t])=>{var o;t&&a.includes(e)&&(l[e]=null!==(o=l[e])&&void 0!==o?o:{},l[e].deepnote_output_heights=t)})),r.updateCellLayoutMetadata(e,l)}),5e3,{maxWait:5e3}),g={outputMessageHandler(e,t){(0,ne.Uh)(t)&&(l.push({notebookId:e,cellId:t.cellId,outputIndex:t.outputIndex,height:t.height}),d(),f(e))},updateCellHeight(e,t){const o=r.getFocusedNotebookId();o?(u.push({notebookId:o,cellId:e,height:t}),p(),f(o)):(0,a.D)(new Error("Cell layout received without focused notebook."),"error")},async fetchOutputsForCell(e){var t;const r=null===(t=o.current)||void 0===t?void 0:t.getControlChannelApi();if(!r)return;const i=await r.fetchOutputs([e]);n.dispatch({type:"NEW_OUTPUTS",cellIdsToOutputs:i})},async fetchOutputsForCells(e){var t;const r=null===(t=o.current)||void 0===t?void 0:t.getControlChannelApi();if(!r)return;const i=await r.fetchOutputs(e);n.dispatch({type:"NEW_OUTPUTS",cellIdsToOutputs:i})}};return g};var ue=o(67439),de=o(60802),pe=o(78914),fe=o(21472),ge=o(28607),he=o(99012),me=o(62835),ye=o.n(me),be=o(42040);const ve=e=>{const{controllerRef:t,store:o,projectTrack:r}=e,n=o.dispatch,s={async requestAdditionalAccess(e){const t=o.getState().project.id;try{return(await fetch(`/api/project/${t}/request-access`,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:e?JSON.stringify({accessType:e}):void 0})).ok?(l.Z.success({message:"Request for additional access has been sent successfully!"}),!0):(l.Z.error({message:"Failed to send a request for additional access. Please, try again."}),!1)}catch{return l.Z.error({message:"Failed to send a request for additional access. Please, try again."}),!1}},getMemoryPodLimit:(e,t)=>e+.1*t>=t?t:null,updateProjectInDb:async(e,t)=>fetch(`/api/project/${e.projectId}`,{method:"PATCH",headers:{Accept:"application/json","Content-Type":"application/json"},credentials:"include",body:JSON.stringify(t)}),async updateLinkSharing(e){const t=o.getState().project.collaborationProperties.currentUserAccessType;if(!(0,i.C5)(t,c.EJ.MANAGE_COLLABORATORS))return;const r={sharing_link_on:"none"!==e,link_access_type:"none"!==e?e:c.WP.VIEW},u=o.getState().project.id;try{n(I.Ud(r)),await s.updateProjectInDb({projectId:u},r)}catch(e){l.Z.error({message:"Oops! Looks like we failed to update your sharing link. Mind trying again?"}),(0,a.D)(new Error("There was an error changing link access"),"error",{error:e,newSettings:r})}finally{var d;null===(d=s.refetchProject())||void 0===d||d.catch((e=>(0,a.D)(e,"warning")))}},async leaveProject(){const e=o.getState().project.id,t=o.getState().project.collaborationProperties.currentUserAccessType;if(!(0,i.C5)(t,c.EJ.LEAVE_PROJECT))return l.Z.warning({message:"You can not leave project with your current access type."}),!1;return 200===(await fetch(`/api/project/${e}/collaborator-myself`,{method:"DELETE",headers:{Accept:"application/json","Content-Type":"application/json"},credentials:"include"})).status||((0,a.D)(new Error("Error leaving project"),"error"),l.Z.error({message:"Oops! Looks like we failed to remove you from the project. Mind trying again?"}),!1)},async addCollaborators(e,t={}){const r=o.getState().project.collaborationProperties.currentUserAccessType;if(!(0,i.C5)(r,c.EJ.MANAGE_COLLABORATORS))return l.Z.warning({message:"You cannot change collaborators with your current access type."}),!1;const n=o.getState().project.collaborationProperties.collaborators.map((e=>e.email)),u=e.filter((e=>!n.includes(e)));if(0===u.length)return l.Z.warning({message:e.length>1?"Collaborators are already invited.":`Collaborator ${e[0]} is already invited.`}),!1;const d=o.getState().project.id;void 0===t.newAccessType&&(t.newAccessType=c.WP.VIEW,(0,a.D)(new Error("Adding collaborator but no access type provided. Defaulting to view"),"warning"));const p={method:"POST",body:{emails:u,userAccessType:t.newAccessType}},f=await fetch(`/api/project/${d}/collaborators`,{method:p.method,headers:{Accept:"application/json","Content-Type":"application/json"},credentials:"include",body:JSON.stringify(p.body)});if(await s.refetchProject(),200!==f.status){let e="";try{e=await f.json()}catch{}return(0,a.D)(new Error("Error adding collaborators"),"error",{errorJson:e}),l.Z.error({message:"There was an error adding collaborators. Refresh the page, and try again."}),!1}return!0},async updateCollaborators(e,t,r={}){const n=o.getState().project.collaborationProperties.currentUserAccessType;if(!(0,i.C5)(n,c.EJ.MANAGE_COLLABORATORS))return l.Z.warning({message:"You cannot change collaborators with your current access type."}),!1;const u=o.getState().project.id;if("change-access-type"===e&&void 0===r.newAccessType)return(0,a.D)(new Error("Trying to change access type but no new access type was provided"),"error"),!1;const d={method:"remove"===e?"DELETE":"PATCH",body:{email:t,userAccessType:r.newAccessType}},p=await fetch(`/api/project/${u}/collaborator`,{method:d.method,headers:{Accept:"application/json","Content-Type":"application/json"},credentials:"include",body:JSON.stringify(d.body)});if(await s.refetchProject(),200!==p.status){let e="";try{e=await p.json()}catch{}return(0,a.D)(new Error("Error changing collaborator"),"error",{errorJson:e}),l.Z.error({message:"Oops! Looks like we failed to update your collaborators. Mind trying again?"}),!1}return!0},closeModal(){o.getState().modalManager.openedModal===I.Qi.FILE_UPLOAD_MODAL&&e.fileApi.removeUploadedItems(),n({type:I.wO.CLOSE_MODAL})},toggleCellCommandsDropdown(){const e=!o.getState().layout.isCellCommandsDropdownOpen;n(e?{type:"SHOW_CELL_COMMANDS_DROPDOWN"}:{type:"HIDE_CELL_COMMANDS_DROPDOWN"})},hideCellCommandsDropdown(){n({type:"HIDE_CELL_COMMANDS_DROPDOWN"})},isTeamHardwareActive(){var e;const t=o.getState().project.owner,r=o.getState().project.teams,n=o.getState().project.hardware;return!(null===(e=r.filter((e=>e.id===t.teamId))[0])||void 0===e||!e.team_hardwares.includes(n))},async setTeamAccessType(e){const t=o.getState().project.id,r=await fetch(`/api/project/${t}/team-access`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({teamAccessType:e})});if(!r.ok){await l.Z.error({message:"Unable to set team access"});const o=new Error(`[${t}] Setting team access to ${e} failed with ${r.status} ${r.statusText}`);(0,a.D)(o,"error")}n(I.xZ(e))},async renameProject(e){const t=o.getState().project.collaborationProperties.currentUserAccessType,r=o.getState().project.isRenamingProject;if(!(0,i.C5)(t,c.EJ.RENAME_PROJECT)||r)return;const a=o.getState().project.id,s=o.getState().project.name;let l=!1;n({type:I.Vm.SET_RENAMING,payload:!0}),n(I.eu(e));try{200===(await fetch(`/api/project/${a}`,{method:"PATCH",headers:{Accept:"application/json","Content-Type":"application/json"},credentials:"include",body:JSON.stringify({name:e})})).status&&(l=!0)}finally{l||n(I.eu(s)),n({type:I.Vm.SET_RENAMING,payload:!1})}},async restartKernel(e){var r;if(!t.current)return;const n=null!=e?e:null===(r=t.current.getFocusedNotebookDoc())||void 0===r?void 0:r.id;if(!n)return;const a=t.current.getControlChannelApi(),s=o.getState().project.collaborationProperties.currentUserAccessType;return(0,i.C5)(s,c.EJ.MANAGE_HARDWARE_LIFECYCLE)?null==a?void 0:a.restartKernel(n):void 0},async refetchProject(){var e;const o=null===(e=t.current)||void 0===e?void 0:e.getControlChannelApi();return null==o?void 0:o.refetchProject()},turnOnNotifications(){Notification.requestPermission().then((e=>{("granted"===e||(0,de.hE)("development"))&&(r.track("Execution notification enabled"),new Notification("Notifications are enabled 🎉"))}))},async selectHardware(e){var r;const a=null===(r=t.current)||void 0===r?void 0:r.getControlChannelApi(),s=o.getState().project.collaborationProperties.currentUserAccessType;if((0,i.C5)(s,c.EJ.MANAGE_HARDWARE))try{n(I.P4(e));try{await(null==a?void 0:a.setHardware(e))||n(I.P4(void 0))}finally{n(I.P4(void 0))}n(I.TW(e))}catch(e){l.Z.error({message:"There was an error during machine selection."})}},async startHardware(){var r;if(o.getState().user.is_anonymous)return e.modalApi.openModal({newModal:I.Qi.SIGN_IN_MODAL,title:"Sign up to run code"}),!1;o.dispatch({type:"UPDATE_HARDWARE_STATUS",hardwareStatus:"submitted"});const n=o.getState().project.collaborationProperties.currentUserAccessType;if(!(0,i.C5)(n,c.EJ.MANAGE_HARDWARE_LIFECYCLE))return!1;const a=null===(r=t.current)||void 0===r?void 0:r.getControlChannelApi(),s=await(null==a?void 0:a.startHardware().catch((()=>(l.Z.warning({message:"Unable to start the machine. Try again, or contact support."}),!1))));return s||o.dispatch({type:"UPDATE_HARDWARE_STATUS",hardwareStatus:"not-exist"}),!!s},async restartProject(){if(o.getState().user.is_anonymous)return void e.modalApi.openModal({newModal:I.Qi.SIGN_IN_MODAL,title:"Sign up to run code"});if(!t.current)return;const r=t.current.getControlChannelApi(),n=o.getState().project.collaborationProperties.currentUserAccessType;return(0,i.C5)(n,c.EJ.MANAGE_HARDWARE_LIFECYCLE)?(o.dispatch({type:"CHANGE_CONNECTION_STATUS",isConnected:!1}),r.restartProject().catch((()=>l.Z.warning({message:"Sorry, we could not restart your project."})))):void 0},async restartHardware(){if(!t.current)return;const e=t.current.getControlChannelApi(),r=o.getState().project.collaborationProperties.currentUserAccessType;return(0,i.C5)(r,c.EJ.MANAGE_HARDWARE_LIFECYCLE)?e.restartHardware().catch((()=>l.Z.warning({message:"Unable to restart the machine. Try again, or contact support."}))):void 0},async stopHardware(){if(o.getState().user.is_anonymous)return void e.modalApi.openModal({newModal:I.Qi.SIGN_IN_MODAL,title:"Sign up to run code"});if(!t.current)return;const r=t.current.getControlChannelApi(),n=o.getState().project.collaborationProperties.currentUserAccessType;return(0,i.C5)(n,c.EJ.MANAGE_HARDWARE_LIFECYCLE)?null==r?void 0:r.stopHardware().catch((()=>{l.Z.warning({message:"Unable to stop the machine. Try again, or contact support."})})):void 0},async restoreProjectVersion(r){const n=o.getState().project.collaborationProperties.currentUserAccessType;if(!(0,i.C5)(n,c.EJ.RESTORE_VERSION))return l.Z.warning({message:"Sorry, you can not restore project to a previous version."}),!1;if(!t.current)return;const a=t.current.getControlChannelApi();await a.restoreProjectVersion(r).catch((()=>l.Z.warning({message:"Sorry, we could not restore project to selected version"}))),e.projectFocusApi.refocusActiveNotebook()},getCurrentDoc(){var e;return null===(e=t.current)||void 0===e?void 0:e.getFocusedDoc()},getCurrentUndoStack(){var e;return null===(e=t.current)||void 0===e?void 0:e.getFocusedFileUndoStack()},getWorkspaceId:()=>o.getState().project.team_id,isItemDockerfile:e=>(0,D.rN)(e)&&e.relativePath===pe.oH,submitDockerBuild(){var e;const i=null===(e=t.current)||void 0===e?void 0:e.getFocusedDoc(),c=o.getState().project.focusedItem,u=o.getState().project.id;(0,O.Hz)(i)&&(0,D.hE)(c)&&s.isItemDockerfile(c)&&(r.track("Environment docker built",{projectId:u}),n(I.jt({status:"WORKING"})),fetch(`/api/cloudbuild/?projectId=${u}`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({dockerFileData:i.data})}).then((e=>{if(!e.ok){if(400===e.status)return void n(I.jt({status:"INVALID_DOCKERFILE"}));if(403===e.status)return void n(I.jt({status:"FORBIDDEN"}));throw new Error(`Submit custom docker build failed with status ${e.status} ${e.statusText}`)}return n(I.jt({status:"WORKING"})),s.refetchProject()})).catch((e=>((0,a.D)(e,"error"),n(I.jt({status:"FAILURE"})),l.Z.error({message:"Error building image"})))))},cancelDockerBuild(){var e;const r=null===(e=t.current)||void 0===e?void 0:e.getFocusedDoc(),i=o.getState().project.focusedItem;(0,O.Hz)(r)&&r.data&&(0,D.hE)(i)&&s.isItemDockerfile(i)&&fetch(`/api/cloudbuild/${(0,fe.P)(r.data)}`,{method:"DELETE",credentials:"include",headers:{"Content-Type":"application/json"}}).then((e=>{if(!e.ok)return Promise.reject(new Error(`Interrupting build failed  ${e.status} ${e.statusText}`))})).catch((e=>((0,a.D)(e,"error"),n(I.jt({status:"FAILURE"})),l.Z.error({message:"Failed to cancel the Docker build"}))))},async fetchDockerBuildStatus(){var e;const r=null===(e=t.current)||void 0===e?void 0:e.getFocusedDoc(),i=o.getState().project.focusedItem;if(!(0,O.Hz)(r)||!r.data)return;if(!(0,D.hE)(i)||!s.isItemDockerfile(i))return;const a=await fetch(`/api/cloudbuild/${(0,fe.P)(r.data)}/latest-build`,{method:"GET",credentials:"include",headers:{"Content-Type":"application/json"}});if(a.ok){const e=await a.json();n(I.jt({status:e.status,outputs:e.outputs,image:e.image,timestamp:e.timestamp}))}else 404===a.status&&n(I.jt({status:"NOT_FOUND",outputs:"",image:""}))},async fetchCurrentImage(){const e=o.getState().config.collaborationServiceUrl,t=o.getState().project.collaborationProperties.currentUserAccessType,r=o.getState().project.id;if((0,i.C5)(t,c.EJ.PROJECT_INFO))if((0,de.hE)("development"))o.dispatch(I.OP("deepnote/python:3.7"));else try{const t=await fetch(`${e}/project/${r}/image`,{credentials:"include",headers:{"Content-Type":"application/json"}});if(t.ok){const{image:e}=await t.json();o.dispatch(I.OP(e))}else(0,he.n_)({message:"Failed to fetch Docker image"})}catch(e){(0,a.D)(e,"fatal")}},async getGithubAppStatus(e){const t=(0,ge.o8)(e);if(!t)return void l.Z.error({message:"We could not parse the url. Are you sure it is a well-formed GitHub url?"});const o=await fetch(`/api/github-apps/${t.owner}/${t.repository}/status`,{method:"GET",credentials:"include",headers:{Accept:"application/json","Content-Type":"application/json"}});return o.ok?await o.json():((0,a.D)(new Error(`Failed to get GitHub apps integration status for repo ${e}`),"warning"),l.Z.error({message:"We could not connect to the GitHub repo. Could you try again?"}))},async linkGitRepo(t,u){const d=o.getState().project.collaborationProperties.currentUserAccessType;if(!(0,i.C5)(d,c.EJ.MANIPULATE_FILES))return;const p=("github"===u?ge.o8:ge.Wn)(t);if(!p)return l.Z.error({message:`We could not parse the url. Are you sure it is a well-formed ${u} url?`});const f=o.getState().project.id,g=new URLSearchParams({projectId:f,repoUrl:t});let h;if(await new Promise(((e,t)=>{const o=setTimeout((()=>{window.deepnote.sendToken=void 0,t(new Error("Failed to get access to the repo within 1 minute."))}),6e4),r=window.open(`/auth/githubAppRepo?${g}`);if(!r){const e=new Error(`Unable to authenticate when adding a ${u} repo. \`popUp\` is undefined`);throw(0,a.D)(e,"error"),e}window.deepnote.sendToken=t=>{h=t,e()},r.onload=()=>{r.location.host===window.location.host&&(clearTimeout(o),e())}})),window.deepnote.sendToken=void 0,!h)return l.Z.error({message:"We could not setup access to the repository. Do you have access to it?"});const m=await fetch("/api/github-apps/connect-repo",{method:"POST",credentials:"include",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({owner:p.owner,repo:p.repository,projectId:f,accessToken:h})});if(!m.ok){let e="Failed to connect the GitHub repository.";try{const t=await m.json();null!=t&&t.error&&(e+=` ${t.error}`)}catch(e){}return(0,a.D)(new Error(e),"error"),l.Z.error({message:e})}return n(I.Ud({linkedRepo:{owner:p.owner,repo:p.repository}})),r.track("GitHub repo cloned",{provider:"github",projectId:f,repository:p.repository,repoUrl:t}),Promise.all([s.refetchProject(),e.fileApi.cloneGitRepo(t,"/",h,u)])},async unlinkGitRepo(e,t){const i=o.getState().project.id,a=o.getState().config.collaborationServiceUrl;if(!(await fetch(`${a}/project/${i}/gitkey`,{method:"DELETE",credentials:"include",headers:{"Content-Type":"application/json"}})).ok)return void l.Z.error({message:"Failed to disconnect integration. Please, try again."});if((await fetch(`/api/github-apps/${i}/${e}/${t}`,{method:"DELETE"})).ok)return r.track("GitHub repo unlinked",{provider:"github",projectId:i,repository:t}),n(I.Ud({linkedRepo:void 0})),s.refetchProject();l.Z.error({message:"Failed to disconnect Github repository. Please, try again."})},async fetchSessionStart(){const e=o.getState().project.id;return fetch(`/api/usage/project/${e}/start`,{method:"GET",credentials:"include",headers:{Accept:"application/json","Content-Type":"application/json"}}).then((async t=>{if(!t.ok){const o=await t.text();return void(0,a.D)(new Error(`Error retrieving start of session for project ${e}, ${o}`),"error")}const{lastSessionStart:o}=await t.json();return o}))},async fetchInactivityGracePeriod(){const e=o.getState().project.id,t=await fetch(`/api/project/${e}/fetch-inactivity-grace-period`,{method:"GET",credentials:"include",headers:{"Content-Type":"application/json"}});if(!t.ok){const o=await t.text();return(0,a.D)(new Error(`[${e}]/fetch-inactivity-grace-period failed with ${t.statusText}`),"error",{responseText:o}),ue.B.duration(15,"m")}const{inactivityGracePeriodSeconds:r}=await t.json();return ue.B.duration(r,"s")},async setInactivityGracePeriod(e){const t=o.getState().project.id;r.track("Inactivity period changed",{projectId:t,inactivityPeriodMinutes:e/60});const n=await fetch(`/api/project/${t}/set-inactivity-grace-period`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({inactivityGracePeriod:e})});if(!n.ok){l.Z.error({message:"Looks like we failed to set the inactivity grace period. Please, try again."});const e=await n.text();(0,a.D)(new Error(`[${t}]/set-inactivity-grace-period failed with ${n.statusText}`),"error",{responseText:e})}},async stopHardwareById(e){const t=await fetch(`/api/project/${e}/stop-hardware`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"}});if(!t.ok)throw l.Z.error({message:"Unable to stop the machine. Try again, or contact support."}),(0,a.D)(new Error(`[${e}]/stop-hardware failed with ${t.statusText}`),"error"),new Error(`[${e}] API /stop-hardware failed with ${t.statusText}`)},async _getRunningProjects(){const e=o.getState().user.id,t=`/api/billing/runningHardware/${J.H.selectWorkspaceId(o.getState())}`,r=await fetch(t,{method:"GET",credentials:"include",headers:{"Content-Type":"application/json"}});return r.ok?await r.json():((0,a.D)(new Error(`[${e}]/runningHardware failed with ${r.statusText}`),"error"),[])},matchUser(e,t){var r,n;const i=o.getState().project.collaborationProperties.collaborators.filter((e=>e.name)),a=i.map((e=>e.email)),s=null!==(r=null===(n=t.current)||void 0===n?void 0:n.filter((e=>!a.includes(e.email))))&&void 0!==r?r:[],c=ye()([...i,...s],(e=>e.email));return(0,be.Lu)(c,e,{keys:["email","name"],threshold:be.Lu.rankings.ACRONYM}).map((e=>({key:e.email,collaborator:e})))},canUser(e){const t=o.getState().project.collaborationProperties.currentUserAccessType,r=o.getState().project.focusedItem;return(0,Z.u)(e)?(0,Z.q)(t,e,r):(0,i.C5)(t,e)},isConnected:()=>o.getState().connection.isConnected,async fetchTunnelingState(){const e=o.getState().project.id,t=await fetch(`/api/tunnel/${e}`,{method:"GET",credentials:"include",headers:{"Content-Type":"application/json"}});if(!t.ok){const o=await t.text();throw(0,a.D)(new Error(`[${e}] GET /api/tunnel failed with ${t.statusText}`),"error",{responseText:o}),new Error("Failed to fetch tunneling configuration. Please contact support.")}const{enabled:r}=await t.json();return r},async setTunnelingState(e){const t=o.getState().project.id,r=await fetch(`/api/tunnel/${t}`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({enabled:e})});if(!r.ok){l.Z.error({message:"Looks like we failed to set tunneling configuration. Please, try again."});const e=await r.text();(0,a.D)(new Error(`[${t}] POST /api/tunneling failed with ${r.statusText}`),"error",{responseText:e})}},fetchUser(){fetch("/api/user/me",{method:"GET",credentials:"include"}).then((async e=>{if(!e.ok)throw new Error(e.statusText);const t=await e.json();o.dispatch({type:"USER_SET",payload:t})})).catch((e=>(0,he.n_)({message:`Error fetching own user data, error: ${e}`})))},fetchConfig(e){fetch(`/api/project/${e}/config`,{method:"GET",credentials:"include"}).then((async e=>{if(!e.ok)throw new Error(e.statusText);const t=await e.json();o.dispatch({type:"CONFIG_SET",payload:t})})).catch((t=>(0,he.n_)({message:`Error fetching config for project ${e}, error: ${t}`})))}};return s};var Ee=o(86263),we=o(2638);function ke(e){const{controllerRef:t,store:o}=e,r=o.dispatch,n={getFocusedItemType(){var e;const r=o.getState().project.focusedItem,n=null===(e=t.current)||void 0===e?void 0:e.getFocusedDoc();return r?n?(0,D.rs)(r)?"terminal":(0,D.JF)(r)?"preview":(0,i.nZ)(n.data)?"notebook":(0,O.Hz)(n)?"plaintext":"none":"none":null},setActiveItem:async e=>(0,D.rN)(e)?n.setActiveFile(e.relativePath):(0,D.mt)(e)?n.setActiveNotebook(e.id):void 0,switchProjectLayout(e){const t=o.getState().project.collaborationProperties.currentUserAccessType,s=o.getState().project.focusedItem;if(e!==Ee.k7.PUBLISHING_EDITOR&&e!==Ee.k7.NEW_PUBLISHING_EDITOR||(0,i.C5)(t,c.EJ.PUBLISH_NOTEBOOK)){if(e!==Ee.k7.NEW_PUBLISHING_EDITOR&&(0,we.p)(`selectedProjectLayout-${o.getState().project.id}`,e.toString()),e===Ee.k7.CONTENT&&!(0,D.hE)(s)&&"preview"!==(null==s?void 0:s.type)){const e=o.getState().project.previouslyFocusedItems.slice().reverse().find((e=>(0,D.hE)(e)||"preview"===(null==e?void 0:e.type)));var l;if(e&&(0,D.hE)(e))null===(l=n.setActiveItem(e))||void 0===l||l.catch((e=>(0,a.D)(e,"warning")))}r({type:"SWITCH_PROJECT_LAYOUT",layout:e})}},async focusToCollaborator(t,r,a){const s=o.getState().project.previouslyFocusedItems,c=o.getState().project.focusedItem;let l;const u=s.length;u>0&&(l=s[u-1]);const d=o.getState().user,p=o.getState().filesystem.entities;if((0,D.hE)(c)&&l&&(0,D.hE)(l)&&r===d.id&&c.id!==l.id)return n.setActiveItem(l);if(a&&t.id){const{switched:e}=await n.setActiveNotebook(t.id);e&&await(0,i._v)(900)}else{const e=t.path?p[t.path]:void 0;if(!e)return;((0,D.rN)(c)||(0,D.JF)(c)?c.relativePath:void 0)!==t.path&&(await n.setActiveFile(e.relativePath),await(0,i._v)(900))}t.focusedCellId&&e.notebookApi.focusCell(t.focusedCellId,{align:"center"})},async setActiveNotebook(r){if(!t.current)return{switched:!1};const n=o.getState(),i=n.project.focusedItem;return(0,D.mt)(i)&&i.id===r?{switched:!1}:(await e.itemFocusApi.setActiveNotebook(r,{addToHistory:!0}),n.layout.selectedProjectLayout===Ee.k7.NEW_PUBLISHING_EDITOR&&o.dispatch({type:"SWITCH_PROJECT_LAYOUT",layout:Ee.k7.CONTENT}),{switched:!0})},refocusActiveNotebook(){const e=o.getState().project.focusedItem;(0,D.mt)(e)&&(o.dispatch((0,I.Kz)()),o.dispatch((0,I.ki)(e)))},openNotebookInNewTab(e,t){const r=o.getState().project,n=(0,N.g)({project:r,notebookInDB:{id:e,name:t}});window.open(n.fullUrlWithFile)},async setActiveFile(n,i){if(!t.current)return;const a=o.getState().project.focusedItem;if(n!==(a&&((0,D.rN)(a)||(0,D.JF)(a))?a.relativePath:void 0)||i){r({type:I.xg.SET_LOADING_FILE_PATH,loadingFilePath:n}),(0,D.dv)(n)&&r({type:"HIDE_RAW_CSV"}),t.current.editorRefs={};try{await e.itemFocusApi.setActiveFile(n,{openRaw:i})}finally{r({type:I.xg.SET_LOADING_FILE_PATH,loadingFilePath:void 0})}}},isFileFocused(e){const t=o.getState().project.focusedItem;return"file"===(null==t?void 0:t.type)&&t.id===e},focusInitNotebook(){e.layoutApi.switchProjectSidebarTab("project");const t=o.getState().filesystem.entities[pe.Fd],r=o.getState().project.init_notebook_id;r?n.setActiveNotebook(r).catch((e=>(0,a.D)(e,"warning"))):t&&(0,v.zE)(t)&&n.setActiveFile(t.relativePath).catch((e=>(0,a.D)(e,"warning")))},focusDockerfile(){const e=o.getState().filesystem.entities[pe.oH];e&&(0,v.zE)(e)&&n.setActiveFile(e.relativePath,!0).catch((e=>(0,a.D)(e,"warning")))}};return n}var Se=o(27704);function Ce(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,r)}return o}function _e(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?Ce(Object(o),!0).forEach((function(t){Te(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):Ce(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}function Te(e,t,o){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var o=e[Symbol.toPrimitive];if(void 0!==o){var r=o.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}const Ie="We failed to create terminal. Likely this is because we failed to load terminals. Try refreshing the page.",Ae=e=>{const{controllerRef:t,store:o,terminalStore:r,projectTrack:n}=e,s=o.dispatch,u={async createTerminal(){var n;if(!e.terminalHandler.isTerminalLoaded())return void l.Z.error({message:"We cannot create a terminal for you, because we failed to load our terminal library. Please try refreshing the page."});const d=null===(n=t.current)||void 0===n?void 0:n.getControlChannelApi(),p=o.getState().project.collaborationProperties.currentUserAccessType,f=o.getState().terminal.isCreatingTerminal,g=(0,i.C5)(p,c.EJ.RUN_TERMINAL),h=e.notebookApi.canExecute(!1);if(!f&&g&&h&&d&&r){s({type:"SET_IS_CREATING_TERMINAL",isCreatingTerminal:!0});try{const{terminalId:t,name:n,createdAt:i}=await(null==d?void 0:d.createNewTerminal()),a=o.getState().terminal.terminals,c=e.terminalHandler.createNewTerminal(d,t);if(!c)throw Error(Ie);const{terminal:l,listener:p}=c;r[t]={terminal:l,version:0,listenerStore:[p]},s({type:"SET_TERMINAL_NAMES",terminals:_e(_e({},a),{},{[t]:{name:n,createdAt:i}})}),u.focusTerminal(t)}catch(e){l.Z.error({message:Ie}),(0,a.D)(e,"warning")}finally{s({type:"SET_IS_CREATING_TERMINAL",isCreatingTerminal:!1})}}},openATerminal(){const e=o.getState().terminal.terminals,t=Object.keys(e),r=t.length>0;n.track("Terminal opened"),r?u.focusTerminal(t[0]):u.createTerminal().catch((e=>(0,a.D)(e,"warning")))},focusTerminal(e){try{const t=o.getState().project.collaborationProperties.currentUserAccessType;if(!(0,i.C5)(t,c.EJ.RUN_TERMINAL))return;const r=o.getState().project.id;(0,X.dG)(r,`${Se.nH}${e}`),window.history.pushState(null,r,`#${Se.nH}${encodeURIComponent(e)}`),s(I.tc(e))}catch(e){(0,a.D)(e,"warning")}},resizeTerminal(e,r){const n=o.getState().connection.hardwareStatus;if((0,h.OJ)(n)&&t.current){const o=t.current.getControlChannelApi();null==o||o.sendTerminalMessage(e,"set_size",r).catch((e=>(0,a.D)(e,"warning")))}},async deleteTerminal(e){var o;const r=null===(o=t.current)||void 0===o?void 0:o.getControlChannelApi();await(null==r?void 0:r.deleteTerminal(e))},async renameTerminal(e,o){var r;const n=null===(r=t.current)||void 0===r?void 0:r.getControlChannelApi();await(null==n?void 0:n.renameTerminal(e,o))}};return u},Oe=e=>{const{store:t}=e,{dispatch:o,getState:r}=t;return{updateScheduling:async n=>{if(t.getState().user.is_anonymous)return void e.modalApi.openModal({newModal:I.Qi.SIGN_IN_MODAL,title:"Sign up to schedule a notebook"});const i=r().project.id,s=r().scheduling;if(n.schedulingEnabled){const e=await fetch(s.schedulingEnabled?`/scheduling/${i}`:"/scheduling",{method:s.schedulingEnabled?"PATCH":"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({projectId:i,notebookId:n.notebookId,crontab:n.crontab,republish:n.republish,emailOnFailed:n.emailOnFailed,emailOnSuccess:n.emailOnSuccess,timezone:n.timezone})});if(!e.ok)return l.Z.error({message:"Failed to update scheduling. Please try again later or contact our support."}),void(0,a.D)(new Error(`[/api/${i}]/scheduling] failed with ${e.statusText}`),"error");l.Z.success({message:"Scheduling settings updated"}),o({type:"UPDATE_SCHEDULING",newSchedulingState:n})}else{const e=await fetch(`/scheduling/${i}`,{method:"DELETE",credentials:"include",headers:{"Content-Type":"application/json"}});if(!e.ok)return l.Z.error({message:"Failed to remove scheduling. Please try again later or contact our support."}),void(0,a.D)(new Error(`DELETE [/api/${i}]/scheduling] failed with ${e.statusText}`),"error");l.Z.success({message:"Scheduling settings updated"}),o({type:"REMOVE_SCHEDULING"})}},fetchScheduling:e=>{fetch(`/scheduling/${e}`,{method:"GET",credentials:"include"}).then((async e=>{if(!e.ok)throw new Error(e.statusText);const o=await e.json();t.dispatch({type:"UPDATE_SCHEDULING",newSchedulingState:o})})).catch((t=>(0,he.n_)({message:`Error fetching scheduling config for project ${e}, error: ${t}`})))}}};var Pe=o(85014),je=o(60716),De=o(48338);const Ne=e=>{const{controllerRef:t,store:o}=e,{dispatch:r,getState:n}=o,s=async(e=De.fL.OVERWRITE_HISTORY_LOGS,t)=>{const r=o.getState(),n=r.project.collaborationProperties.currentUserAccessType;if(!(0,i.C5)(n,c.EJ.MANIPULATE_FILES))return;const a=`/api/project/${r.project.id}/history`,s=null!=t?t:(0,je.n3)(r.history.filters),l=await fetch(a,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({activeLogTypes:s})}),u=await l.json();o.dispatch({type:e,logs:(0,je.X8)(u)})};return{fetchHistory:s,fetchHistoryAuthors:()=>{var e;return null===(e=t.current)||void 0===e?void 0:e.addHistoryAuthors()},filterHistory:(e,t)=>{const{filters:o}=n().history;r({type:De.fL.FILTER_HISTORY,filters:e?(0,je.fF)(o,t):o.filter((e=>e!==t))}),s(De.fL.MERGE_OVERWRITE_HISTORY_LOGS).catch((e=>(0,a.D)(e,"warning")))}}};var Le=o(84899),Fe=o(61402),Re=o(29801),Ue=o(51625);function xe(e,t){return(...o)=>t(e(...o))}const Me=e=>(0,r.W)({commentsApi:xe(s,d.F),editorApi:xe(m,d.F),environmentApi:xe(y.L,d.F),fileApi:xe(L,d.F),historyApi:xe(Ne,d.F),integrationApi:xe(R,d.F),notebookApi:xe(re,d.F),outputsApi:xe(le,d.F),projectApi:xe(ve,d.F),projectFocusApi:xe(ke,d.F),schedulingApi:xe(Oe,d.F),terminalApi:xe(Ae,d.F),layoutApi:xe(x,d.F),commentsPreferencesApi:xe(u,d.F)},{blockTransforms:e.blockTransforms,blockTransport:e.blockTransport,commonApi:e.commonApi,controllerRef:e.controllerRef,fileSaver:e.fileSaver,integrationFetcher:e.integrationFetcher,notebooksFetcher:e.notebooksFetcher,itemFocusApi:e.itemFocusApi,modalApi:e.modalApi,slateRef:e.slateRef,store:e.store,terminalHandler:e.terminalHandler,terminalStore:e.terminalStore,projectTrack:e.projectTrack,gettingStartedMutator:e.gettingStartedMutator}),{ServiceContext:Be,useServices:He}=(0,Fe.A)();function $e(e){const{commonApi:t,modalApi:o,gettingStartedMutator:r}=(0,Le.WG)(),i=(0,Pe.qr)(),a=(0,Re.tu)(),[s,c]=(0,n.useState)(null);return(0,n.useEffect)((()=>{const{blockTransforms:e,blockTransport:n,controllerRef:s,fileSaver:l,integrationFetcher:u,notebooksFetcher:d,itemFocusApi:p,slateRef:f,terminalHandler:g,terminalStore:h,projectTrack:m}=a;c(Me({blockTransforms:e,blockTransport:n,commonApi:t,controllerRef:s,fileSaver:l,integrationFetcher:u,notebooksFetcher:d,itemFocusApi:p,modalApi:o,slateRef:f,store:i,terminalHandler:g,terminalStore:h,projectTrack:m,gettingStartedMutator:r}))}),[t,o,r,i,a]),s?(0,Ue.tZ)(Be.Provider,{value:s,children:e.children}):null}},98189:(e,t,o)=>{"use strict";o.d(t,{cp:()=>p,fw:()=>d});var r=o(13636),n=o(44529),i=o(3285),a=o(91987),s=o(32784),c=o(57313),l=o(51625);const u=(0,a.createContext)([]),d=()=>(0,a.useContext)(u),p=({workspaceId:e,children:t})=>{const{loading:o,data:d,error:p}=(0,c.q)(e,{fetchPolicy:"cache-first"});return(0,a.useEffect)((()=>{p&&(0,s.H0)(p,n.c.WRONG_AUTH_PROVIDER)&&(window.location.href=r._.signIn()+"?workspace_id="+e)}),[p,e]),p&&(0,i.D)(p),o&&!d?null:d?(0,l.tZ)(u.Provider,{value:d,children:t}):null}},29801:(e,t,o)=>{"use strict";o.d(t,{jZ:()=>Ce,tu:()=>Se});var r=o(37496),n=o(93102),i=o(91987),a=o(87340);function s(e){const{store:t}=e;return{async fetchAndStoreIntegrations(e){const o=await fetch(`/api/integration/project/${e}`);if(!o.ok){if(403===o.status)return void a.Z.error({message:"Failed to fetch integrations due to invalid permissions."});throw new Error("Failed fetch integrations request")}const r=await o.json();t.dispatch({type:"INTEGRATION_BATCH_ADD",payload:{integrations:r}})}}}var c=o(19074),l=o(86191),u=o(64686),d=o(69520),p=o(52047),f=o(17110),g=o(18337),h=o(19654);function m(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,r)}return o}function y(e,t,o){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var o=e[Symbol.toPrimitive];if(void 0!==o){var r=o.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function b(e){return{track:(t,o={},r={})=>{(0,h.j)(t,function(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?m(Object(o),!0).forEach((function(t){y(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):m(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}({workspaceId:e},o),r)}}}var v=o(1711);function E(){return{}}var w=o(85014),k=o(72219),S=o(3285),C=o(78914),_=o(45060),T=o(15800),I=o(61707),A=o(1067),O=o(99012),P=o(50061),j=o(94327);function D(e,t,o){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var o=e[Symbol.toPrimitive];if(void 0!==o){var r=o.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}class N{constructor(){D(this,"listeners",[]),D(this,"listenersOncer",[]),D(this,"on",(e=>(this.listeners.push(e),{dispose:()=>this.off(e)}))),D(this,"once",(e=>{this.listenersOncer.push(e)})),D(this,"off",(e=>{const t=this.listeners.indexOf(e);t>-1&&this.listeners.splice(t,1)})),D(this,"emit",(e=>{if(this.listeners.forEach((t=>t(e))),this.listenersOncer.length>0){const t=this.listenersOncer;this.listenersOncer=[],t.forEach((t=>t(e)))}})),D(this,"pipe",(e=>this.on((t=>e.emit(t)))))}}var L=o(40538),F=o(16046);const R=F.z.object({nodes:F.z.array(F.z.object({cellId:F.z.string(),inputVariables:F.z.array(F.z.string()),outputVariables:F.z.array(F.z.string())})),edges:F.z.array(F.z.object({from:F.z.string(),to:F.z.string(),inputVariables:F.z.array(F.z.string())}))});function U(e,t,o){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var o=e[Symbol.toPrimitive];if(void 0!==o){var r=o.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}class x{constructor(e){U(this,"controlChannel",void 0),this.controlChannel=e}async decompressContents(e){return this.controlChannel.request("contents-decompress",{path:e})}async startHardware(){return this.controlChannel.request("start-hardware")}async restartProject(){return this.controlChannel.request("restart-project")}async stopHardware(){return this.controlChannel.request("stop-hardware")}async refetchProject(){return this.controlChannel.request("refetch-project")}async fetchOutputs(e){return this.controlChannel.request("fetch-outputs",{cellIds:e})}async clearNotebookCellOutputs(e,t){return this.controlChannel.request("clear-cell-outputs",{notebookId:e,cellIds:t})}async fetchCellLayoutMetadata(e){return this.controlChannel.request("fetch-cell-layout-metadata",{notebookId:e})}async restartKernel(e){return this.controlChannel.request("restart",{notebookId:e})}async setHardware(e){return this.controlChannel.request("set-hardware",{selection:e})}async restartHardware(){return this.controlChannel.request("restart-hardware")}async createNewItem(e,t){return this.controlChannel.request("contents-new-untitled",{path:e,isNotebook:"notebook"===t,type:"directory"===t?"directory":"file"})}async renameItem(e,t){return this.controlChannel.request("contents-rename",{path:e,newPath:t})}async duplicateItem(e){return this.controlChannel.request("contents-duplicate",{path:e})}async deleteItem(e){return this.controlChannel.request("contents-delete",{path:e})}async saveItem(e){return this.controlChannel.request("contents-save",{id:e})}async createNotebookInDB(e){return this.controlChannel.request("contents-new-notebook",{name:e})}async renameNotebookInDB(e,t,o,r){return this.controlChannel.request("contents-rename-notebook",{notebookId:e,name:t,newName:o,trigger:r})}async duplicateNotebookInDB(e){return this.controlChannel.request("contents-duplicate-notebook",{notebookId:e})}async deleteNotebookInDB(e){return this.controlChannel.request("contents-delete-notebook",{notebookId:e})}async getNotebookInDb(e){return this.controlChannel.request("contents-get-notebook-db",{id:e})}async restoreProjectVersion(e){return this.controlChannel.request("restore-project-version",{versionId:e})}async getExistingTerminals(){return this.controlChannel.request("get-existing-terminals")}async refetchTerminal(e){return this.controlChannel.request("refetch-terminal",{terminalId:e})}async createNewTerminal(){return this.controlChannel.request("new-terminal")}async sendTerminalMessage(e,t,o){return this.controlChannel.request("terminal-message",{message:{type:t,content:o},terminalId:e})}async deleteTerminal(e){return this.controlChannel.request("delete-terminal",{terminalId:e})}async renameTerminal(e,t){return this.controlChannel.request("rename-terminal",{terminalId:e,newName:t})}async executeCells(e,t,o=!1){return this.controlChannel.request("execute-cells",{notebookId:e,cells:t,skipSqlCache:o})}async fetchBlockVariablesDAG(e){return R.parse(await this.controlChannel.request("fetch-block-variables-dag",{notebookId:e}))}async interruptExecution(e){return this.controlChannel.request("interrupt",{notebookId:e})}async exportDataframe(e,t){return this.controlChannel.request("export-dataframe",{notebookId:e,cell:t})}submitUserInput(e){return this.controlChannel.notify("submit-user-input",{notebookId:e})}async requestUser(e){return this.controlChannel.request("get-user",{id:e})}async requestAutocomplete(e,t,o){return this.controlChannel.request("autocomplete",{position:e,notebookId:t,blocks:o})}async requestHover(e,t,o){return this.controlChannel.request("hover",{position:e,notebookId:t,blocks:o})}async requestSignatureHelp(e,t,o){return this.controlChannel.request("signatureHelp",{position:e,notebookId:t,blocks:o})}async fetchFilesystemEntities(e){return this.controlChannel.request("contents-fetch-entities",{relativePaths:"string"==typeof e?[e]:[...new Set(e)]}).catch((e=>Promise.reject(new k.rB("Contents contents-fetch-entities failed, storage service is unavailable.",e))))}async loadItem(e){return this.controlChannel.request("contents-load",{path:e})}async loadNotebook(e){return this.controlChannel.request("contents-load-notebook",{id:e})}register(e,t){return this.controlChannel.register(e,t)}async generateInitNotebook(){return this.controlChannel.request("generate-init-notebook")}async generateDockerfile(){return this.controlChannel.request("generate-dockerfile")}async commMsg(e,t,o,r,n,i=[],a=!1,s=!0){return this.controlChannel.request("comm-msg",{notebookId:e,msgId:o,msg:{content:{comm_id:t,data:r},metadata:n,buffers:i.map((e=>btoa(new Uint8Array(e))))},expectReply:a,disposeOnDone:s})}async requestCommInfo(e){return this.controlChannel.request("comm-info-request",{notebookId:e})}async updateCellLayoutMetadata(e,t){return this.controlChannel.request("store-cell-layout-metadata",{notebookId:e,cellLayoutMetadata:t})}async updateCellTable(e,t,o){return this.controlChannel.request("update-cell-table",{notebookId:e,cellId:t,tableState:o})}async restoreNotebookSession(e){return this.controlChannel.request("restore-notebook-session",{notebookId:e})}}function M(e,t,o){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var o=e[Symbol.toPrimitive];if(void 0!==o){var r=o.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}let B=function(e){return e[e.CONNECT=0]="CONNECT",e[e.DISCONNECT=1]="DISCONNECT",e[e.RECONNECT=2]="RECONNECT",e[e.HARD_RECONNECT=3]="HARD_RECONNECT",e[e.API_CHANGE=4]="API_CHANGE",e}({});class H extends N{constructor(e,t){super(),M(this,"apiVersion",void 0),M(this,"loadProjectId",void 0),M(this,"docProvider",void 0),M(this,"controlChannelApi",void 0),M(this,"socket",void 0),M(this,"sharedbAuthFilter",void 0),M(this,"heartbeatInterval",void 0),M(this,"collabData",void 0),M(this,"transaction",void 0),M(this,"connectionAttemptCount",0),M(this,"retryPolicy",(e=>{const t=Math.min(Math.max(1e3*e,0),5e3);return T.l.pushWithTimeStamp(`connection retry attempt ${e}. Next retry: ${t}`),t}));this.socket=new P.Waterfall((async()=>{this.collabData=await W(e,t),this.apiVersion&&this.collabData.apiVersion!==this.apiVersion&&this.emit(B.API_CHANGE),this.apiVersion=this.collabData.apiVersion,this.connectionAttemptCount+=1;const o=$(this.collabData.collaborationServiceUrl);return console.log(`Connecting to WS url ${o}`),o}),void 0,{connectionTimeout:1e4,emitClose:!0,retryPolicy:this.retryPolicy}),this.socket.addEventListener("error",(e=>{T.l.pushWithTimeStamp("Socket error"),Object.entries(e).forEach((([e,t])=>T.l.push(`Event properties - ${e}: ${t}`)))})),this.socket.addEventListener("close",(e=>{T.l.pushWithTimeStamp(`[connection.ts] socket closed with code ${e.code}, reason ${e.reason}, wasClean: ${e.wasClean}`),Object.entries(e).forEach((([e,t])=>T.l.push(`Event properties - ${e}: ${t}`))),this.sharedbAuthFilter.status="CLOSED",this.emit(B.DISCONNECT)})),this.sharedbAuthFilter=new P.Dam(new P.Pipe(this.socket,"db"));const o=this.sharedbAuthFilter;o.addEventListener("error",(e=>{(0,S.D)(new Error(`ShareDb channel error event: ${e}`),"error",{event:e})}));const r=new P.Cable(new P.Pipe(this.socket,"ct"));this.patchControlChannel(r),this.controlChannelApi=new x(r),this.docProvider=new j.Connection(o),this.socket.addEventListener("open",(async()=>{T.l.pushWithTimeStamp("Socket opened");try{if(!this.collabData)throw new Error("Missing collab data");const e=await r.request("init-project",{sessionId:this.collabData.sessionId,projectId:t},1e4),{loadProjectId:o,collabDocVersion:n}=e,i=this.docProvider.get(t,"collab");this.loadProjectId?this.loadProjectId!==o||i&&n&&i.version>n?(Object.values(this.docProvider.collections).forEach((e=>{Object.values(e).forEach((e=>{e._hardRollback()}))})),this.emit(B.HARD_RECONNECT),this.transaction&&(this.transaction.name="Hard reconnect",this.transaction.finish())):(this.emit(B.RECONNECT),this.transaction&&(this.transaction.name="Reconnect",this.transaction.finish())):this.emit(B.CONNECT),this.sharedbAuthFilter.status="OPEN",this.loadProjectId=o,this.heartbeatInterval&&clearInterval(this.heartbeatInterval),this.heartbeatInterval=setInterval((()=>{r.request("ping",void 0,2e4).catch((e=>{this.heartbeatInterval&&clearInterval(this.heartbeatInterval),console.warn("Heartbeat failed, closing socket.",e),this.closeAndReconnect(4e3,"hearbeat failed"),this.transaction=(0,O.Yr)({name:"General reconnect",op:"reconnect"})}))}),2e4),this.socket.addEventListener("close",(()=>{this.heartbeatInterval&&clearInterval(this.heartbeatInterval),this.transaction=(0,O.Yr)({name:"General reconnect",op:"reconnect"})})),this.connectionAttemptCount=0}catch(e){(0,A.cz)(e,["ProjectDisposingError"])?await(0,A._v)(1e3):(0,A.cz)(e,["ProjectIsSuspendedError","ProjectInMaintenanceError","UserIsSuspendedError"])?await(0,A._v)(1e4):(5===this.connectionAttemptCount&&(0,S.D)(e,"error"),await(0,A._v)(500)),this.socket.failed(e)}})),T.l.pushWithTimeStamp("Connection constructed.")}close(e,t){console.log(`Forced close, reason: ${t}`),Object.values(this.docProvider.collections).forEach((e=>{Object.values(e).forEach((e=>{e.destroy()}))})),this.docProvider.whenNothingPending((()=>{this.docProvider.close(),this.emit(B.DISCONNECT),this.sharedbAuthFilter.status="CLOSED",this.socket.close(e,t)}))}closeAndReconnect(e,t){console.log(`Forced close and reconnect, reason: ${t}`),this.emit(B.DISCONNECT),this.sharedbAuthFilter.status="CLOSED",this.socket.ws.close(e,t)}getDocProvider(){return this.docProvider}getControlChannelApi(){return this.controlChannelApi}patchControlChannel(e){e.requestOld=e.request,e.request=async(t,o,r)=>{if(!["contents-fetch-entities","hover","ping"].includes(t)){const e=`Requesting via control channel: ${t}`;T.l.pushWithTimeStamp(e),(0,O.n_)({message:e,category:"control-channel"})}try{return await e.requestOld(t,o,r)}catch(e){throw T.l.pushWithTimeStamp(`Error in control channel request ${t}: ${JSON.stringify(e)}`),new L.V(`Error in control channel request ${t}`,{cause:e,methodName:t,params:o})}}}}const $=e=>{const t=new URL(e);return t.protocol="https:"===t.protocol?"wss:":"ws",`${t.toString()}/`},W=async(e,t)=>{const o=await fetch(`/api/project/${t}/collaboration`,{method:"GET",credentials:"include",headers:{"Content-Type":"application/json"}}),r=e.getState().user.id;if(200===o.status){const t=await o.json();if(r&&t.userId!==r)throw window.location.reload(),new Error("Unexpected change of user id.");return e.dispatch({type:"UPDATE_SESSION_CONFIG",sessionId:t.sessionId}),t}throw 401===o.status||403===o.status?(r&&window.location.reload(),new Error("Unauthorized access, probably due to expired session, reloading.")):new Error(`Failed to get collab url ${o.status}.`)};var q=o(60802),G=o(77424),Z=o(85508),J=o.n(Z),z=o(32902),V=o.n(z),Y=o(27704),Q=o(63871);function K(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,r)}return o}function X(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?K(Object(o),!0).forEach((function(t){ee(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):K(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}function ee(e,t,o){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var o=e[Symbol.toPrimitive];if(void 0!==o){var r=o.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}class te{constructor(){ee(this,"modelStateCache",{}),ee(this,"iframeMessengers",{})}setIframeMessenger(e,t){this.iframeMessengers[e]={send:t}}removeIframeMessenger(e){delete this.iframeMessengers[e]}async handleCommMsg(e){if(Q.KernelMessage.isCommOpenMsg(e))this.updateWidgetState(e.content.comm_id,JSON.stringify(e.content.data.state));else if(Q.KernelMessage.isCommMsgMsg(e)||Q.KernelMessage.isCommCloseMsg(e)||Q.KernelMessage.isStatusMsg(e)){if(Q.KernelMessage.isCommMsgMsg(e)&&"update"===e.content.data.method){const t=e.content.data.state,o=this.modelStateCache[e.content.comm_id];if("resolved"===(null==o?void 0:o.status)){const r=await o.state;this.modelStateCache[e.content.comm_id].state=Promise.resolve(X(X({},r),t))}}Object.values(this.iframeMessengers).forEach((t=>{t.send(e)}))}else(0,A.UT)(e)}updateWidgetState(e,t){let o;try{o=JSON.parse(t)}catch(e){return void(0,S.D)(new Error("Failed deserializing PyWidget state"),"error",{error:e})}if(Object.keys(o).length>0){const t=this.modelStateCache[e];t&&t.resolveState(o),this.modelStateCache[e]={state:Promise.resolve(o),status:"resolved",resolveState:()=>{}}}}getCachedCommInfo(){return Object.fromEntries(Object.keys(this.modelStateCache).map((e=>[e,{target_name:"jupyter.widget"}])))}clearCache(){this.modelStateCache={}}async handleStateRequest(e,t,o){if(this.modelStateCache[t]){const r=await this.modelStateCache[t].state;return this.iframeMessengers[e].send({channel:"iopub",content:{comm_id:t,data:{state:r,method:"update"}},parent_header:{msg_id:o,msg_type:"comm_msg"},buffers:[],metadata:{},header:{msg_id:"mock_id",msg_type:"comm_msg",date:"mock_date",session:"mock_session",username:"mock_username",version:"5.3"}}),!0}let r=e=>{};const n=new Promise((e=>{r=e}));return this.modelStateCache[t]={state:n,resolveState:r,status:"pending"},!1}}var oe=o(69299),re=o(60716),ne=o(48338),ie=o(15531);let ae;const se=()=>{ae&&(clearInterval(ae),ae=void 0)};function ce(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,r)}return o}function le(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?ce(Object(o),!0).forEach((function(t){ue(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):ce(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}function ue(e,t,o){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var o=e[Symbol.toPrimitive];if(void 0!==o){var r=o.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}class de{constructor(e,t,o){ue(this,"_store",void 0),ue(this,"_integrationFetcher",void 0),ue(this,"_projectFetcher",void 0),ue(this,"_terminalHandler",void 0),ue(this,"_terminalStore",void 0),ue(this,"_payAsYouGoMachinesFetcher",void 0),ue(this,"_notebooksInDbFetch",void 0),ue(this,"projectId",void 0),ue(this,"workspaceId",void 0),ue(this,"textFileUndoStacks",{}),ue(this,"terminalsAlreadyErrored",new Set),ue(this,"editorRefs",{}),ue(this,"fileEditorRef",{current:void 0}),ue(this,"inputRequestEditorRef",{current:void 0}),ue(this,"collabDoc",void 0),ue(this,"docsExecutingMyCell",{}),ue(this,"widgetManager",new te),ue(this,"_connection",null),ue(this,"dispose",(()=>{var e;this.collabDoc.destroy(),null===(e=this._connection)||void 0===e||e.close(1e3,"Closing the project")})),ue(this,"clearRefs",(()=>{this.editorRefs={},this.fileEditorRef.current=void 0})),ue(this,"setupPeriodicFileRefresh",(()=>{var e;e=async()=>{this._store.getState().connection.isConnected&&await this.refreshFilesystem()},se(),ae=setInterval(e,8e3)})),ue(this,"stopPeriodicFileRefresh",(()=>{se()})),this._store=e.store,this._integrationFetcher=e.integrationFetcher,this._projectFetcher=e.projectFetcher,this._terminalHandler=e.terminalHandler,this._terminalStore=e.terminalStore,this._payAsYouGoMachinesFetcher=e.payAsYouGoMachinesFetcher,this.projectId=t,this.workspaceId=o}static getScrollingElement(){return(0,q.sk)()?null:document.getElementById(Y.Ik)}setConnection(e){this._connection=e,this.collabDoc=this.getDoc("collab"),this._registerControlChannel()}getConnection(){if(!this._connection)throw new Error("Controller connection is not configured");return this._connection}getControlChannelApi(){if(!this._connection)throw new Error("Controller connection is not configured");return this._connection.getControlChannelApi()}_registerControlChannel(){if(!this._connection)throw new Error("Controller connection is not configured");const e=this.getControlChannelApi();e.register("refetch-project",(()=>(this._store.dispatch(_.jt()),this._projectFetcher.fetchProject(this.projectId,!0)))),e.register("refetch-hardware-info",(async()=>(await this._payAsYouGoMachinesFetcher.refetch(),this._projectFetcher.fetchProject(this.projectId,!0)))),e.register("new-outputs",(async e=>{this._store.dispatch({type:"NEW_OUTPUTS",cellIdsToOutputs:e.cellIdsToOutputs})})),e.register("reload-project",(async e=>("dispose"===e.reason?a.Z.loading({message:"Your machine will be restarted in 4 seconds.",duration:4}).then((()=>{a.Z.success({message:"Restarting the machine...",duration:2})}),(()=>{})):"refresh"===e.reason&&a.Z.loading({message:"Hi! We released a new update. Your page will be refreshed to load the latest version of Deepnote.",duration:4}).then((()=>{a.Z.success({message:"Refreshing the page...",duration:2})}),(()=>{})),setTimeout((()=>{window.location.reload()}),5e3)))),e.register("new-history-logs",(async e=>{this._store.dispatch({type:ne.fL.APPEND_HISTORY_LOGS,logs:(0,re.X8)(e)}),this.addHistoryAuthors()})),e.register("integration-connect",(async()=>{await this._integrationFetcher.fetchAndStoreIntegrations(this.projectId)})),e.register("collab-message",(async e=>{e&&("collab-error"===e.severity?a.Z.error({duration:e.durationSeconds,message:e.message}):"collab-info"===e.severity?a.Z.info({duration:e.durationSeconds,message:e.message}):"collab-success"===e.severity&&a.Z.success({duration:e.durationSeconds,message:e.message}))})),e.register("contents-refresh",(async()=>this.refreshFilesystem())),e.register("contents-refresh-notebooks",(async()=>{if(this._notebooksInDbFetch)return this._notebooksInDbFetch()})),e.register("new-terminal",(async t=>{const{terminalId:o,name:r,createdAt:n}=t,i=this._store.getState().terminal.terminals;if(i[o])return;const a=this._terminalHandler.createNewTerminal(e,o);if(!a)throw Error("We failed to create terminal. Likely this is because we failed to load xterm.");const{terminal:s,listener:c}=a;this._terminalStore[t.terminalId]={terminal:s,version:0,listenerStore:[c]},this._store.dispatch({type:"SET_TERMINAL_NAMES",terminals:le(le({},i),{},{[t.terminalId]:{name:r,createdAt:n}})})})),e.register("delete-terminal",(async e=>{this._terminalHandler.deleteTerminal(e.terminalId)})),e.register("rename-terminal",(async e=>{const t=this._store.getState().terminal.terminals,o=le(le({},t[e.terminalId]),{},{name:e.newName});this._store.dispatch({type:"SET_TERMINAL_NAMES",terminals:le(le({},t),{},{[e.terminalId]:o})})})),e.register("terminal-disconnected",(async e=>{})),e.register("terminal-stdout",(async t=>{t.forEach((async t=>{const o=t.terminalId,r=this._terminalStore[o];if(r)await this._terminalHandler.terminalStdOut(r,t,e);else if(!this.terminalsAlreadyErrored.has(o)){this.terminalsAlreadyErrored.add(o);const e=new Error(`Received a message ${JSON.stringify(t)}, but there is no such terminal.`);(0,S.D)(e,"error")}}))})),e.register("comm-msg",(async e=>{await this.widgetManager.handleCommMsg(e)}))}addHistoryAuthors(){const e=this._store.getState().project.collaborationProperties.currentUserAccessType;if(!(0,A.C5)(e,G.EJ.MANIPULATE_FILES))return;const t=this._store.getState().history.projectLogs,o=this._store.getState().history.historyAuthors;V()(t.map((e=>e.userId)).filter((e=>e&&!o[e]))).forEach((async e=>{const t=await this.getControlChannelApi().requestUser(e);this._store.dispatch({type:ne.fL.ADD_HISTORY_AUTHOR,author:t})}))}async refreshFilesystem(){const e=this._store.getState().filesystem.expandedDirPaths;try{await this.fetchFilesystemEntities(e)}catch(e){if(e instanceof k.rB)return void this._store.dispatch({type:_.xg.SET_FILESYSTEM_UNAVAILABLE,isUnavailable:!0});throw e}}possiblyDisplayNotification(e,t,o,r,n){const i=!!this.docsExecutingMyCell[e],a=!(null==r||!r.find((e=>e.sessionId===n)));this.docsExecutingMyCell[e]=a;if(!(i&&!a))return;if("granted"!==Notification.permission&&!(0,q.hE)("development"))return;const s=this._store.getState().project.focusedItem;if(!(0,ie.hE)(s)||e!==(null==s?void 0:s.id)||!document.hasFocus()){new Notification("Finished execution",{body:`In ${o}`}).onclick=()=>{window.focus()},(0,h.j)("Execution notification displayed",{workspaceId:t})}}getFocusedDoc(){const e=this._store.getState().project.focusedItem;if((0,ie.hE)(e))return this.getDoc(e.id)}getFocusedNotebookDoc(){const e=this._store.getState().project.focusedItem;if((0,ie.hE)(e))return this.getNotebookDoc(e.id)}getNotebookDoc(e){const t=this.getDoc(e);if((0,A.nZ)(t.data))return t}getDoc(e){if(!this._connection)throw new Error("Controller connection is not configured");return this._connection.getDocProvider().get(this.projectId,e)}getFocusedFileUndoStack(){const e=this._store.getState().project.focusedItem;if((0,ie.hE)(e))return this.textFileUndoStacks[e.id]}async fetchFilesystemEntities(e){const t=await this.getControlChannelApi().fetchFilesystemEntities(e),o=(0,oe.wT)(t);J()(o,this._store.getState().filesystem.entities)||this._store.dispatch({type:_.xg.ENTITIES_LOADED,entities:t,partial:!1})}setupNotebooksInDbRefetch(e){this._notebooksInDbFetch=e}}var pe=o(86401),fe=o(2611);class ge extends k.GU{}const he=e=>({createController:(t,o)=>{const r=new de(e,t,o);return r.setConnection(new H(e.store,t)),r}}),me=e=>{const{controllerRef:t,itemFocusApi:o,store:r}=e;if(!t.current)throw new Error("Controller is not available");const n=t.current;return{initialize:()=>{r.dispatch({type:"PROJECT_INITIALIZATION_STARTED"}),r.dispatch({type:"CLEAR_SHAREDB"}),T.l.pushWithTimeStamp("starting function initialize()");const t=n.projectId,i=e.projectFetcher.fetchProject(t),a=setTimeout((()=>{T.l.pushWithTimeStamp("initialization timed out"),(0,S.D)(new Error("Initialisation of project timed out"),"error",{latestEvents:T.l.getItems(),waterfall:n.getConnection().socket});r.dispatch({type:"PROJECT_INITIALIZATION_WARNING",warning:"This is taking longer than usual. We are still trying though. If the issue persists, please try restarting your browser."})}),3e4),s=e=>{if(clearTimeout(a),e){const t="Something went wrong during project inititalisation. Please try again later.";r.dispatch({type:"PROJECT_INITIALIZATION_ERROR",error:t}),(0,S.D)(e,"error"),(0,I.Y)(!1)}else r.dispatch({type:"PROJECT_INITIALIZATION_FINISHED"})};let c=!1;const l=async a=>{try{n.collabDoc.subscribed||await(0,pe.EM)((e=>n.collabDoc.subscribe(e))),c||(c=!0,(0,fe.I)(n.collabDoc,r,"collabDoc"),function(){var e;const t=null===(e=n.collabDoc.data)||void 0===e?void 0:e.hardwareStatus;t&&r.dispatch({type:"UPDATE_HARDWARE_STATUS",hardwareStatus:t});const o=(0,pe.z3)(["hardwareStatus"],(()=>{var e;null!==(e=n.collabDoc.data)&&void 0!==e&&e.hardwareStatus&&r.dispatch({type:"UPDATE_HARDWARE_STATUS",hardwareStatus:n.collabDoc.data.hardwareStatus})}));n.collabDoc.on("op",o),n.collabDoc.on("load",(()=>{var e;null!==(e=n.collabDoc.data)&&void 0!==e&&e.hardwareStatus&&r.dispatch({type:"UPDATE_HARDWARE_STATUS",hardwareStatus:n.collabDoc.data.hardwareStatus})}))}()),await i,r.dispatch({type:"CHANGE_CONNECTION_STATUS",isConnected:!0});const l=n.refreshFilesystem(),u=e.terminalHandler.initializeProjectTerminals(n.getControlChannelApi()),d=e.integrationFetcher.fetchAndStoreIntegrations(t);await Promise.all([l,u]);const p=o.focusActiveItem(!a),f=async function(){const e=n.projectId,t=n.getControlChannelApi(),i=r.getState().project.init_notebook_id;try{if(i){const r=await t.loadNotebook(i);if(!r)throw console.log("Init notebook failed to load by ID",i),new Error(`[${e}] Init file not found!`);await o.loadDocAndSubscribe(r.id,"/"),console.log("Init notebook loaded by ID",i)}else if(r.getState().filesystem.entities[C.Fd]){const r=await t.loadItem(C.Fd);if(!r)throw console.log("Init notebook failed to load by path",C.Fd),new Error(`[${e}] Init file not found!`);await o.loadDocAndSubscribe(r.id,C.Fd),console.log("Init notebook loaded by path",C.Fd)}else console.log("No init notebook set up")}catch(e){(0,S.D)(new ge("Failed to load init notebook",{cause:e}),"error")}}();await p,s(),(0,I.Y)(!0),n.setupPeriodicFileRefresh(),await Promise.all([d,f])}catch(e){s(e)}};n.getConnection().on((async e=>{if(console.debug("Connection event:",e),e===B.CONNECT&&(T.l.pushWithTimeStamp("CONNECT"),n.widgetManager.clearCache(),await l(!1)),e===B.RECONNECT&&(T.l.pushWithTimeStamp("RECONNECT"),n.widgetManager.clearCache(),await l(!0)),e===B.HARD_RECONNECT){T.l.pushWithTimeStamp("HARD_RECONNECT"),console.log("HARD RECONNECT");(async()=>{n.widgetManager.clearCache(),await(0,pe.EM)((e=>n.collabDoc.once("load",e))),await o.focusActiveItem(!1),n.setupPeriodicFileRefresh(),r.dispatch({type:"CHANGE_CONNECTION_STATUS",isConnected:!0})})().catch((e=>{(0,S.D)(e,"fatal"),window.location.reload()}))}e===B.API_CHANGE&&(T.l.pushWithTimeStamp("API_CHANGE"),n.getConnection().close(4001,"Backend API version changed"),r.dispatch({type:_.wO.OPEN_MODAL,payload:{newModal:_.Qi.REFRESH_MODAL,title:"New version is out!",message:"We released a new version of Deepnote that requires a page refresh. Please refresh the page to continue."}})),e===B.DISCONNECT&&(n.stopPeriodicFileRefresh(),T.l.pushWithTimeStamp("DISCONNECT"),r.dispatch({type:"CHANGE_CONNECTION_STATUS",isConnected:!1}))})),T.l.pushWithTimeStamp("initialisation of initialisation class done");return()=>{clearTimeout(a)}}}};var ye=o(8641),be=o(18882),ve=o(84899),Ee=o(61402),we=o(51625);const{ServiceContext:ke,useServices:Se}=(0,Ee.A)();function Ce(e){const{commonApi:t}=(0,ve.WG)(),o=(0,w.qr)(),a=(0,r.x)(),[h,m]=(0,i.useState)(null);return(0,i.useEffect)((()=>{var r,i;m((r={commonApi:t,store:o,apolloClient:a},i={projectId:e.projectId,workspaceId:e.workspaceId},(0,n.W)({blockFetchQueue:p.z,blockTransactionQueue:f.L,blockTransforms:v.y,blockTransport:d.o,controllerRef:e=>({current:e.controllerFactory.createController(i.projectId,i.workspaceId)}),controllerInit:me,fileSaver:g.O,integrationFetcher:s,itemFocusApi:ye.v,projectFetcher:u.P,notebooksFetcher:c.Z,payAsYouGoMachinesFetcher:l.z,terminalHandler:be.H,terminalStore:E,slateRef:()=>({current:null}),projectTrack:()=>b(i.workspaceId)},{commonApi:r.commonApi,store:r.store,apolloClient:r.apolloClient,controllerFactory:he})))}),[t,o,e.projectId,a,e.workspaceId]),(0,i.useEffect)((()=>{if(!h)return;const{controllerInit:e,controllerRef:t}=h,o=e.initialize(),r=t.current;return()=>{o(),null==r||r.dispose()}}),[h,o]),h?(0,we.tZ)(ke.Provider,{value:h,children:e.children}):null}},28630:(e,t,o)=>{"use strict";o.d(t,{QW:()=>s,L3:()=>l});var r=o(69531);function n(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,r)}return o}function i(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?n(Object(o),!0).forEach((function(t){a(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):n(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}function a(e,t,o){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var o=e[Symbol.toPrimitive];if(void 0!==o){var r=o.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}const s=i(i({},r.QW),{},{redshift:i(i({},r.QW.redshift),{},{upsellModalType:"integration-redshift"}),athena:i(i({},r.QW.athena),{},{upsellModalType:"integration-athena"}),github:i({},r.QW.github),s3:i(i({},r.QW.s3),{},{upsellModalType:"integration-s3"}),"big-query":i(i({},r.QW["big-query"]),{},{upsellModalType:"integration-bigquery"}),gcs:i(i({},r.QW.gcs),{},{upsellModalType:"integration-gcs"}),snowflake:i(i({},r.QW.snowflake),{},{upsellModalType:"integration-snowflake"}),dbt:i(i({},r.QW.dbt),{},{upsellModalType:"integration-snowflake"}),ecr:i(i({},r.QW.ecr),{},{upsellModalType:"integration-ecr"}),gcr:i(i({},r.QW.gcr),{},{upsellModalType:"integration-gcr"}),dockerhub:i(i({},r.QW.dockerhub),{},{upsellModalType:"integration-dockerhub"}),"sql-server":i(i({},r.QW["sql-server"]),{},{upsellModalType:"integration-sql-server"}),trino:i(i({},r.QW.trino),{},{upsellModalType:"integration-trino"}),dremio:i(i({},r.QW.dremio),{},{upsellModalType:"integration-dremio"}),ssh_tunnel:i({},r.QW.ssh_tunnel),github_package:i({},r.QW.github_package)});var c=o(37936);function l(e){return e===c.ws.CONNECTED||e===c.ws.ALWAYS_ON}},19074:(e,t,o)=>{"use strict";o.d(t,{Z:()=>n});var r=o(1241);function n(e){const{apolloClient:t}=e;return{async fetchNotebooks(e,o){var n,i,a,s;const c=await t.query({query:r.x3,variables:{id:e},fetchPolicy:null!==(n=null==o?void 0:o.fetchPolicy)&&void 0!==n?n:"network-only"});return"Project"===(null==c||null===(i=c.data)||void 0===i||null===(a=i.projectById)||void 0===a?void 0:a.__typename)&&null!==(s=c.data.projectById.notebooks)&&void 0!==s?s:[]}}}},86191:(e,t,o)=>{"use strict";o.d(t,{z:()=>n});var r=o(70523);function n(e){const{apolloClient:t}=e;return{async refetch(){await t.refetchQueries({include:[r.PU]})}}}},64686:(e,t,o)=>{"use strict";o.d(t,{P:()=>a});var r=o(1067),n=o(99012),i=o(45060);function a(e){const{store:t}=e;return{async fetchProject(e,o){const a=o?`/api/project/${e}?refetch`:`/api/project/${e}`;return fetch(a,{method:"GET",credentials:"include"}).then((e=>{if(!e.ok)throw window.location.reload(),new Error(e.statusText);return e.json()})).then((e=>{var n;o&&(0,r.Zn)(null===(n=e.collaborationProperties)||void 0===n?void 0:n.currentUserAccessType)>(0,r.Zn)(t.getState().project.collaborationProperties.currentUserAccessType)?t.dispatch({type:i.wO.OPEN_MODAL,payload:{newModal:i.Qi.REFRESH_MODAL,title:"You were granted new permissions!",message:"Project owner granted you extra permissions! Please reload the page to continue."}}):t.dispatch((0,i.Ud)(e))})).catch((e=>(0,n.n_)({message:`Error refetching project from ${a}, error: ${e}`})))}}}},14442:(e,t,o)=>{"use strict";o.d(t,{f:()=>l});var r=o(37496),n=o(91987),i=o(71327);function a(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,r)}return o}function s(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?a(Object(o),!0).forEach((function(t){c(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):a(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}function c(e,t,o){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var o=e[Symbol.toPrimitive];if(void 0!==o){var r=o.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function l(e,t){const o=(0,r.x)(),[a,c]=(0,n.useState)({connected:!1,connecting:!1,error:null}),[l,u]=(0,n.useState)(1),d=(0,i.q)(t.variables),p=Boolean(t.skip),f=(0,n.useRef)(t.onConnect);f.current=t.onConnect;const g=(0,n.useRef)(t.onData);g.current=t.onData;const h=(0,n.useRef)(t.onError);h.current=t.onError;const m=(0,n.useRef)(t.onComplete);return m.current=t.onComplete,(0,n.useEffect)((()=>{if(p)return void c({connected:!1,connecting:!1,error:null});const t=o.subscribe({query:e,variables:d});let r=null;const n=t.subscribe({next(e){var t;void 0!==e&&(null===(t=g.current)||void 0===t||t.call(null,{data:{data:e.data,loading:!1,variables:d},client:o}))},error(e){var t;e&&(c((t=>s(s({},t),{},{error:e,connected:!n.closed}))),null===(t=h.current)||void 0===t||t.call(null,e));r=n.closed?setTimeout((()=>{r=null,u((e=>e+1))}),1e4):null},complete(){var e;null===(e=m.current)||void 0===e||e.call(null)}});c({connecting:!1,connected:!0,error:null});let i=setTimeout((()=>{var e;i=null,null===(e=f.current)||void 0===e||e.call(null),c((e=>s(s({},e),{},{connecting:!1,connected:!0})))}),1e3);return()=>{i&&clearTimeout(i),r&&(clearTimeout(r),r=null),n.unsubscribe()}}),[l,d,o,e,p]),a}},69682:(e,t,o)=>{"use strict";o.d(t,{E:()=>n});var r=o(98189);function n(e){var t,o,n,i,a;const s=(0,r.fw)().find((t=>t.name===e));return{canUseFeature:null!==(t=null==s?void 0:s.canUse)&&void 0!==t&&t,options:{minimumRequiredPlan:null!==(o=null==s||null===(n=s.options)||void 0===n?void 0:n.minimumRequiredPlan)&&void 0!==o?o:void 0,minimumRequiredRole:null!==(i=null==s||null===(a=s.options)||void 0===a?void 0:a.minimumRequiredRole)&&void 0!==i?i:void 0}}}},33581:(e,t,o)=>{"use strict";o.d(t,{Z:()=>a});var r=o(91987),n=o(33811),i=o(2638);function a(e,t,o=!1){const[a,s]=(0,r.useState)((()=>{var o;let r;return"undefined"!=typeof window&&(r=(0,n.KM)(e)),null!==(o=r)&&void 0!==o?o:t}));return[a,r=>{if("undefined"!=typeof window)try{const c=r instanceof Function?r(a):r;s(c),o&&c===t?(0,i.E)(e):(0,n.RQ)(e,c)}catch(e){console.log(e)}}]}},71327:(e,t,o)=>{"use strict";o.d(t,{q:()=>a});var r=o(85508),n=o.n(r),i=o(91987);function a(e,t=n()){const o=(0,i.useRef)(),r=o.current,a=void 0!==r&&t(r,e);return(0,i.useEffect)((()=>{a||(o.current=e)}),[e,a]),a?r:e}},79305:(e,t,o)=>{"use strict";o.d(t,{q:()=>a,u:()=>i});var r=o(77424),n=o(1067);function i(e){return e===r.EJ.MANIPULATE_CELLS||e===r.EJ.EXECUTE_CELL||e===r.EJ.ADD_COMMENT||e===r.EJ.VIEW_COMMENTS||e===r.EJ.RESOLVE_COMMENT_THREAD||e===r.EJ.EDIT_INPUT_CELL_VALUE||e===r.EJ.VIEW_NOTEBOOK_VARIABLES||e===r.EJ.AUTOCOMPLETE||e===r.EJ.PUBLISH_NOTEBOOK||e===r.EJ.SCHEDULE_NOTEBOOK||e===r.EJ.REQUEST_VARIABLE_DETAILS}function a(e,t,o){return"file"!==(null==o?void 0:o.type)&&(0,n.C5)(e,t)}},26700:(e,t,o)=>{"use strict";function r(e,t,o){e.cache.modify({id:`Notebook:${t}`,fields:{blocks:(e,{readField:t,toReference:r})=>{var n;const i=e.filter((e=>{var r;const n=t("id",e),i=null!==(r=o.deletedBlockIds)&&void 0!==r?r:new Set;return!n||!i.has(n)})),a=new Set(i.map((e=>t("id",e))).filter(Boolean)),s=[...null!==(n=o.upsertedBlockIds)&&void 0!==n?n:[]].map((e=>a.has(e)?null:r({__typename:"Block",id:e}))).filter(Boolean);return[...i,...s]}}})}o.d(t,{U:()=>r})},57313:(e,t,o)=>{"use strict";o.d(t,{q:()=>a});var r=o(64119),n=o(64705);const i=r.Ps`
  query CanUseFeatureGatesData($workspaceId: String!) {
    canUseBillingFeatures(workspaceId: $workspaceId) {
      name
      canUse
      options {
        minimumRequiredPlan
        minimumRequiredRole
      }
    }
  }
`;function a(e,t={}){const{data:o,loading:r,error:a}=(0,n.a)(i,{variables:{workspaceId:e},fetchPolicy:t.fetchPolicy});return{data:o?null==o?void 0:o.canUseBillingFeatures:[],loading:r,error:a}}},21324:(e,t,o)=>{"use strict";o.d(t,{W:()=>r});const r={selectIsConnected:e=>e.connection.isConnected,selectHardwareStatus:e=>e.connection.hardwareStatus}},36968:(e,t,o)=>{"use strict";o.d(t,{Q:()=>l});var r=o(11524),n=o(86341),i=o(15531),a=o(47358),s=o(57664);const c=e=>e.filesystem.entities,l={selectEntities:c,createFileCountSelector:()=>(0,n.P1)(c,(e=>Object.values(null!=e?e:{}).filter(r.zE).filter(i.v5).length)),createInitNotebookSelector:()=>(0,n.P1)(s.l.selectSharedbFiles,a.H.selectProjectInitNotebookId,((e,t)=>{if(!t)return null;const o=e[t];return"string"!=typeof o&&o?o:null})),createFileSelector:e=>(0,n.P1)(c,(t=>Object.values(null!=t?t:{}).find((t=>t.relativePath===e))))}},38046:(e,t,o)=>{"use strict";o.d(t,{q:()=>p});var r=o(86341),n=o(35327),i=o(36968),a=o(23029),s=o(57664);const c=(e,t,o)=>{if(!t)return"missing";if("busy"===t.kernelStatus||"notReady"===t.kernelStatus)return"running";return e.some((e=>{const t=o[e];return!!t&&(0,n.j)(t)}))?"errored":"ok"},l=(e,t)=>{var o;return c(null!==(o=null==e?void 0:e.cellOrder)&&void 0!==o?o:[],e,t)},u=()=>(0,r.P1)(s.l.createFocusedNotebookSelector(),(e=>{var t;return null!==(t=null==e?void 0:e.kernelStatus)&&void 0!==t?t:"notReady"})),d=e=>e.connection.hardwareStatus,p={selectHardwareStatus:d,createBlockApiInitNotebookStatusSelector:(e,t)=>(0,r.P1)((()=>t),s.l.createNotebookSelector(e),a.U.selectOutputs,c),createSharedbInitNotebookStatusSelector:()=>(0,r.P1)(i.Q.createInitNotebookSelector(),a.U.selectOutputs,l),createKernelStatusSelector:u,createRuntimeStatusSelector:()=>(0,r.P1)(u(),d,((e,t)=>"notReady"!==e&&"ready"===t?"ready":"stopping"===t||"submitted"===t||"scaling-up"===t||"ready"===t&&"notReady"===e?"preparing":"not-ready"))}},84888:(e,t,o)=>{"use strict";o.d(t,{r:()=>i});var r=o(86341);const n=e=>e.notebookLayout.cachedLayout,i={createInitialPlaceholderHeightSelector:e=>(0,r.P1)(n,(t=>{var o,r;return null!==(o=null===(r=t[e])||void 0===r?void 0:r.deepnote_cell_height)&&void 0!==o?o:0})),selectCachedLayout:n,selectCurrentLayout:e=>e.notebookLayout.currentLayout}},23029:(e,t,o)=>{"use strict";o.d(t,{U:()=>s});var r=o(86341),n=o(35928),i=o(62039);const a=e=>e.output,s={selectOutputs:a,createCellOutputSelector:(e,t)=>(0,r.P1)(a,(o=>t.cleared?i.F:(0,n.N4)(o,e)))}},47358:(e,t,o)=>{"use strict";o.d(t,{H:()=>i});var r=o(86341);const n=e=>e.project.scrollTarget,i={selectCurrentUserAccessType:e=>e.project.collaborationProperties.currentUserAccessType,selectProjectInitNotebookId:e=>e.project.init_notebook_id,selectWorkspaceId:e=>e.project.team_id,selectProjectId:e=>e.project.id,selectFocusedItem:e=>e.project.focusedItem,selectFocusedItemId:e=>{const t=e.project.focusedItem;return t&&"preview"!==t.type?t.id:null},selectFocusedNotebookPath:e=>{if(e.project.focusedItem&&"relativePath"in e.project.focusedItem)return e.project.focusedItem.relativePath},createScrollTargetForCellSelector:e=>(0,r.P1)(n,(t=>(null==t?void 0:t.cellId)===e?t:null))}},57664:(e,t,o)=>{"use strict";o.d(t,{l:()=>d});var r=o(1067),n=o(77424),i=o(86341),a=o(15531),s=o(47358);const c=e=>e.sharedbState.files,l=e=>e.sharedbState.collabDoc.cellOwnership,u=()=>(0,i.P1)(c,s.H.selectFocusedItem,((e,t)=>t&&(0,a.hE)(t)&&(0,r.nZ)(e[t.id])?e[t.id]:null)),d={selectSharedbFiles:c,createOwnerCellIdSelector:e=>(0,i.P1)(l,(t=>{var o,r;return null!==(o=null===(r=t[e])||void 0===r?void 0:r.owner_user_id)&&void 0!==o?o:null})),createNotebookSelector:e=>(0,i.P1)(c,(t=>e&&t[e]&&(0,r.nZ)(t[e])?t[e]:null)),createFocusedNotebookSelector:u,createExecutionQueueSelector:()=>(0,i.P1)(u(),(e=>{var t;return null!==(t=null==e?void 0:e.executionQueue)&&void 0!==t?t:[]})),createExecutingCellIdSelector:()=>(0,i.P1)(u(),(e=>{var t,o;return null!==(t=null==e||null===(o=e.executionQueue.find((e=>e.isExecuting)))||void 0===o?void 0:o.cellId)&&void 0!==t?t:null})),createPersistedSessionSelector:()=>(0,i.P1)(d.createFocusedNotebookSelector(),(e=>{if(null!=e&&e.metadata.deepnote_persisted_session){if(new Date(e.metadata.deepnote_persisted_session.createdAt).getTime()>Date.now()-n.wn)return e.metadata.deepnote_persisted_session}return null})),createTextFileSelector:e=>(0,i.P1)(c,(t=>{const o=t[e];return"string"==typeof o?o:""}))}},69520:(e,t,o)=>{"use strict";o.d(t,{o:()=>u});var r=o(1067),n=o(77424),i=o(72037),a=o(35928),s=o(49952),c=o(18434),l=o(17534);function u(e){const{blockTransactionQueue:t,store:o}=e;return{saveCell(e,a,u){const d=o.getState().project.collaborationProperties.currentUserAccessType,p=(0,r.C5)(d,n.EJ.MANIPULATE_CELLS)?(0,s.TK)(u):(0,r.C5)(d,n.EJ.EDIT_INPUT_CELL_VALUE)&&(0,c.FZ)(u)?(0,s.AU)(u):null;if(!p)return void console.error("The user is not allowed to update the block",u);const f={id:(0,i.EL)(),notebookId:e,operations:[{updateBlock:{blockId:a,blockDataUpdate:p}}]};(0,l.fF)("Block API: saveCell",f),t.queueTransaction(f)},saveNewCell(e,o,r,n,a){var c;const u=(0,s.TK)(n),d={id:(0,i.EL)(),notebookId:e,operations:[{insertBlock:{blockId:o,insertAfterBlockId:null!==(c=null==a?void 0:a.id)&&void 0!==c?c:null,blockData:u}}]};(0,l.fF)("Block API: saveNewCell",d),t.queueTransaction(d)},saveDeletedCell(e,o,r,n){const a={id:(0,i.EL)(),notebookId:e,operations:[{deleteBlock:{blockId:o}}]};(0,l.fF)("Block API: saveDeletedCell",a),t.queueTransaction(a)},saveCellMove(e,o,r,n,a){var s;const c={id:(0,i.EL)(),notebookId:e,operations:[{moveBlock:{blockId:o,moveAfterBlockId:null!==(s=null==a?void 0:a.id)&&void 0!==s?s:null}}]};(0,l.fF)("Block API: saveCellMove",c),t.queueTransaction(c)},saveCellFocus(e,t){(0,a.Z2)(e,t)}}}},52047:(e,t,o)=>{"use strict";o.d(t,{z:()=>y});var r=o(64119),n=o(40934),i=o(3285),a=o(1067),s=o(24249),c=o.n(s),l=o(79675),u=o.n(l),d=o(3215),p=o(45585),f=o(8283),g=o(18434),h=o(26700);const m=r.Ps`
  query FetchChangedBlocks(
    $notebookId: String!
    $sinceHistoryId: String
    $sinceVersions: [BlockIdVersionPairInput!]!
    $includeAddedBlocks: Boolean!
  ) {
    notebookById(id: $notebookId) {
      id
      block_history_id
      changedBlocksSinceVersions(
        sinceHistoryId: $sinceHistoryId
        sinceVersions: $sinceVersions
        includeAddedBlocks: $includeAddedBlocks
      ) {
        blockId
        blockVersion
        block {
          ...FullBlockFragment
        }
      }
    }
  }

  ${d.q}
`;function y(e){const t={};let o=!1,s=!1,l=!1,d=null,y=()=>{};const b=async(t,o,n)=>{if(0===n.knownBlockVersions.length&&!n.includeAddedBlocks)return;const i=(t=>{var o;const n=e.apolloClient.readFragment({id:`Notebook:${t}`,fragment:r.Ps`
        fragment KnownNotebookBlockHistory on Notebook {
          id
          block_history_id
        }
      `});return null!==(o=null==n?void 0:n.block_history_id)&&void 0!==o?o:null})(t),a=await e.apolloClient.query({query:m,variables:{notebookId:t,sinceHistoryId:i,sinceVersions:n.knownBlockVersions,includeAddedBlocks:n.includeAddedBlocks}});c()(a.data,"No data returned from changedBlocksSinceVersions query"),c()(a.data.notebookById,"Notebook not available for changedBlocksSinceVersions query");const s=a.data.notebookById.changedBlocksSinceVersions;f.MO.withoutSaving(o,(()=>{s.forEach((e=>{(0,p.L)(o,e.blockId,e.block)}))}));const l=new Set(s.map((e=>e.block?null:e.blockId)).filter(Boolean)),u=new Set(s.map((e=>e.block?e.blockId:null)).filter(Boolean));(0,h.U)(e.apolloClient,t,{deletedBlockIds:l,upsertedBlockIds:u})},v=async e=>{if(await d,o||s||l)return;const r=t[e];if(!r||0===r.blocks.length)return void delete t[e];const{editor:c,blocks:p}=r,f=u()(p.map((({blockId:e,incomingBlockVersion:t})=>{var o;const r=null===(o=(0,g.cP)(c,e))||void 0===o?void 0:o.block.version;return r&&t&&r>=t?null:{id:e,version:null!=r?r:0}})));o=!0;try{var h,m;await b(e,c,{knownBlockVersions:f,includeAddedBlocks:!1}),t[e]={editor:c,blocks:(null!==(h=null===(m=t[e])||void 0===m?void 0:m.blocks)&&void 0!==h?h:[]).filter((e=>!p.includes(e)))}}catch(e){e instanceof Error&&!("networkError"in e)&&(0,i.D)(e,"error"),console.debug("Block Fetch Queue: problem with fetch, waiting 5s before retrying.",e instanceof n.c?`${e.name}: ${e.message}`:e),await(0,a._v)(5e3)}finally{o=!1}return s?(s=!1,E(e,c)):v(e)},E=async(e,r)=>{if(await d,o||s||l)return void(s=!0);const c=[...(0,g.am)(r)].map((([e])=>({id:e.id,version:e.version})));l=!0,s=!1;try{var u,p,f;const o=t[e],n=null!==(u=null==o?void 0:o.blocks)&&void 0!==u?u:[];await b(e,r,{knownBlockVersions:c,includeAddedBlocks:!0}),t[e]={editor:r,blocks:(null!==(p=null===(f=t[e])||void 0===f?void 0:f.blocks)&&void 0!==p?p:[]).filter((e=>!n.includes(e)))},l=!1}catch(e){l=!1,e instanceof Error&&!("networkError"in e)&&(0,i.D)(e,"error"),console.debug("Block Fetch Queue: problem with catchup, waiting 5s before retrying.",e instanceof n.c?`${e.name}: ${e.message}`:e),await(0,a._v)(5e3),s=!0}finally{l=!1}return s?(s=!1,E(e,r)):v(e)};return{pause(){d=new Promise((e=>{y=e}))},resume(){d=null,y()},async fetchBlockUpdate(o,r){var n,a;const{blockId:s,blockVersion:c}=r,l=e.slateRef.current;if(l)return t[o]={editor:l,blocks:[...null!==(n=null===(a=t[o])||void 0===a?void 0:a.blocks)&&void 0!==n?n:[],{blockId:s,incomingBlockVersion:c}]},v(o).catch((e=>{(0,i.D)(e,"error",{notebookId:o,blockId:s,incomingBlockVersion:c})}))},async catchUpWithBlockUpdates(t){const o=e.slateRef.current;if(o)return E(t,o).catch((e=>{(0,i.D)(e,"error",{notebookId:t})}))}}}},17110:(e,t,o)=>{"use strict";o.d(t,{L:()=>g});var r=o(64119),n=o(3285),i=o(1067),a=o(24249),s=o.n(a),c=o(3215),l=o(45585),u=o(8283),d=o(26700),p=o(17534);const f=r.Ps`
  mutation SubmitBlockTransactions($transactions: [BlockTransaction!]!) {
    submitBlockTransactions(transactions: $transactions) {
      results {
        id
        status
        notebookId
        blockUpdates {
          blockId
          blockVersion
          block {
            # NOTE: We are using the full fragment and not just amend as we need to update the Apollo client cache
            #   to have fresh full block data for switching between cached notebooks. The extra data fetched this way
            #   as opposed to only fetch the amend fragment is not fed into Slate directly, only on notebook load/switch.
            # ...AmendBlockFragment
            ...FullBlockFragment
          }
        }
      }
    }
  }

  # \${AMEND_BLOCK_FRAGMENT}
  ${c.q}
`;function g(e){const{apolloClient:t,blockFetchQueue:o,slateRef:r}=e,a=[];let c=!1;const g=async()=>{if(c)return;const e=a.slice();if(0!==e.length){o.pause(),c=!0;try{const o=await t.mutate({mutation:f,variables:{transactions:e}});s()(o.data,"No data returned from submitBlockTransactions mutation"),a.splice(0,e.length);const n=o.data.submitBlockTransactions.results,i=r.current;i&&u.MO.withoutSaving(i,(()=>{n.flatMap((e=>e.blockUpdates)).forEach((e=>{(0,l.X)(i,e.blockId,e.block)}))}));const c=n.filter((e=>"success"===e.status));!function(e,t){const{deletedBlockIdsByNotebook:o,upsertedBlockIdsByNotebook:r}=function(e){const t=new Map,o=new Map;return e.forEach((e=>{var r,n;const i=null!==(r=t.get(e.notebookId))&&void 0!==r?r:new Set,a=null!==(n=o.get(e.notebookId))&&void 0!==n?n:new Set;e.blockUpdates.forEach((e=>{e.block?(a.add(e.blockId),i.delete(e.blockId)):(i.add(e.blockId),a.delete(e.blockId))})),t.set(e.notebookId,i),o.set(e.notebookId,a)})),{deletedBlockIdsByNotebook:t,upsertedBlockIdsByNotebook:o}}(t);new Set([...o.keys(),...r.keys()]).forEach((t=>{var n,i;(0,d.U)(e,t,{deletedBlockIds:null!==(n=o.get(t))&&void 0!==n?n:null,upsertedBlockIds:null!==(i=r.get(t))&&void 0!==i?i:null})}))}(t,c)}catch(e){e instanceof Error&&!("networkError"in e)&&(0,n.D)(e,"error"),(0,p.fF)("Block Transaction Queue: problem with submission, waiting 5s before retrying.",e),await(0,i._v)(5e3)}finally{c=!1}g().catch((e=>{(0,n.D)(e,"error")}))}else o.resume()};return{queueTransaction(e){a.push(e),g().catch((e=>{(0,n.D)(e,"error")}))}}}},18337:(e,t,o)=>{"use strict";o.d(t,{O:()=>c});var r=o(72219),n=o(1067),i=o(77424),a=o(8097),s=o(87340);function c(e){const{controllerRef:t,store:o}=e,c=t.current,l={async forceSave(e){if(!c)throw new Error("Controller is not available");try{await(0,a.V)(l.saveFile(e),5e3),s.Z.success({message:"Changes have been saved. FYI, they are also auto-saved every 10 seconds.",duration:2e3})}catch(e){e instanceof r.Lc?s.Z.error({message:"You do not have enough permissions to save content of this file."}):(e instanceof r.r6||e instanceof a.W)&&s.Z.error({message:"File could not be saved. There is a problem with the server connection."})}},async saveFile(e){if(!c)throw new Error("Controller is not available");const t=o.getState().project.collaborationProperties.currentUserAccessType;if(!(0,n.C5)(t,i.EJ.MANIPULATE_FILES))throw new r.Lc("Cannot save file");const a=c.getControlChannelApi();await a.saveItem(e).catch((()=>{throw new r.r6("Cannot save file")}))}};return l}},1711:(e,t,o)=>{"use strict";o.d(t,{y:()=>P});var r=o(97113),n=o(1067),i=o(72037),a=o(14058),s=o(3285),c=o(19654),l=o(85508),u=o.n(l),d=o(55236),p=o(18434);function f(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,r)}return o}function g(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?f(Object(o),!0).forEach((function(t){h(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):f(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}function h(e,t,o){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var o=e[Symbol.toPrimitive];if(void 0!==o){var r=o.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function m(e,t){switch(t.type){case"move-block":(0,p.GW)(e,{at:t.sourcePath,to:t.targetPath,targetBlockGroup:t.targetBlockGroup});break;case"set-block-group":(0,p.wW)(e,t.blockPath,t.targetBlockGroup);break;default:(0,n.vE)(t)}}function y(e,t){const o=t>0?e[t-1]:null,[r,n,i]=e.slice(t,t+3);if(!n)return null;const a=Boolean(o&&o.block_group===r.block_group)&&(!n||n.block_group!==r.block_group),s=Boolean(n&&i&&n.block_group===i.block_group&&n.block_group!==r.block_group),c=!a&&s;return a?{type:"set-block-group",blockPath:(0,p.Ep)(t),targetBlockGroup:null}:n&&c?{type:"set-block-group",blockPath:(0,p.Ep)(t),targetBlockGroup:n.block_group}:{type:"move-block",sourcePath:(0,p.Ep)(t),targetPath:(0,p.Ep)(t+1),targetBlockGroup:r.block_group}}function b(e,t){const o=y(e.slice().reverse(),E(e.length,t));return o?function(e,t){switch(t.type){case"move-block":return g(g({},t),{},{sourcePath:v(e,t.sourcePath),targetPath:v(e,t.targetPath)});case"set-block-group":return g(g({},t),{},{blockPath:v(e,t.blockPath)});default:(0,n.vE)(t)}}(e.length,o):null}function v(e,t){const o=[...t];return o[1]=E(e,t[1]),o}function E(e,t){return e-1-t}var w=o(77839),k=o(16925),S=o(19941),C=o(62039),_=o(87340),T=o(35928);function I(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,r)}return o}function A(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?I(Object(o),!0).forEach((function(t){O(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):I(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}function O(e,t,o){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var o=e[Symbol.toPrimitive];if(void 0!==o){var r=o.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}const P=e=>{const{commonApi:t,slateRef:o,store:l}=e;return{getBlocksByIds(e){const t=o.current;return t?Array.from((0,p.am)(t,{match:t=>e.includes(t.id)})).map(p.Bu):null},getAllBlockIds(){const e=o.current;return e?Array.from((0,p.am)(e,{at:(0,p.Dr)([])})).map(p.Bu).map((({block:e})=>e.id)):null},getExecutableBlocksInRange(e,t){const r=o.current;if(!r)return null;const n=(0,p.am)(r,{match:p.Uo}),i=[];let a=!e;for(const o of n){const r=(0,p.Bu)(o);if(r.block.id===t)break;(a||r.block.id===e)&&(a=!0,i.push(r.block))}return i},getCodeBlocks(e){const t=o.current;if(!t)return null;const r=(0,p.am)(t,{match:t=>!("code"!==t.type||e.excludeShellBlocks&&(0,n.Lw)((0,S.y)(t)))}),i=[];for(const[e]of r)i.push(e);return i},getBlocksByTypes(e){const t=o.current;if(!t)return null;const r=(0,p.am)(t,{match:t=>e.includes(t.type)}),n=[];for(const[e]of r)n.push(e);return n},splitCell(){var e;const t=o.current;if(!t)return null;const r=(0,p.UA)(t);if(!r)return null;const n=r.block,s=(0,p.Su)(r.path);if(!(0,p.J2)(n))return null;const c={id:(0,i.EL)(),type:"code"},l=null===(e=t.selection)||void 0===e?void 0:e.focus.offset,u=(0,S.y)(n),f=(0,T.KX)(u.slice(0,l),"trailing"),g=(0,T.KX)(u.slice(l),"leading"),h=s+1,m=a._I.code.createNewCell({id:c.id,source:g,existingCellCounts:{}});return this.transact((()=>{d.YR.insertNodes(t,(0,k.J)(c.id,m,{sortingKey:null,blockGroup:null}),{at:(0,p.Dr)([h])}),d.YR.setNodes(t,{text:f},{at:(0,S.v)((0,p.Dr)([s])),voids:!0})})),c},async formatCell(e,t){const r=o.current;if(!r)return;const n=e?(0,p.cP)(r,e):(0,p.UA)(r);if(!n||!(0,p.J2)(n.block))return(0,s.D)(new Error("Block source not found")),_.Z.error({message:"Formatting failed"});const i=(0,S.y)(n.block),a=await t(i);if(null===a)return;const c=e?(0,p.cP)(r,e):(0,p.UA)(r);c&&(0,p.J2)(c.block)&&(0,S.y)(c.block)===i&&d.YR.setNodes(r,{text:a},{at:(0,S.v)(n.path),voids:!0})},setVoidBlockSource(e,t){const r=o.current;if(!r)return;const n=(0,p.cP)(r,e);return n?(0,p.J2)(n.block)?void d.YR.setNodes(r,{text:t},{at:(0,S.v)(n.path),voids:!0}):((0,s.D)(new Error("Cannot set new source on a non-void block")),void _.Z.error({message:"Failed to set block source"})):((0,s.D)(new Error("Block not found, cannot set new source")),void _.Z.error({message:"Failed to set block source"}))},getFocusedCellId(){var e;const t=o.current,r=t?(0,p.UA)(t):null;return null!==(e=null==r?void 0:r.block.id)&&void 0!==e?e:null},getFocusedCellType(){var e;const t=o.current,r=t?(0,p.UA)(t):null;return null!==(e=null==r?void 0:r.block.type)&&void 0!==e?e:null},getCellIndex(e){const t=o.current,r=t?(0,p.cP)(t,e):null;return r?(0,p.Su)(r.path):-1},getBlockById(e){var t;const r=o.current,n=r?(0,p.cP)(r,e):null;return null!==(t=null==n?void 0:n.block)&&void 0!==t?t:null},getCellType(e){var t;const r=o.current,n=r?(0,p.cP)(r,e):null;return null!==(t=null==n?void 0:n.block.type)&&void 0!==t?t:null},focusCell(e,t){const r=o.current;if(!r)return{focusChanged:!1};const n=(0,p.cP)(r,e);if(!n)return{focusChanged:!1};const i=n.path,[,a]=d.ML.first(r,i);return d.YR.select(r,{path:a,offset:0}),(0,p.$R)(r),{focusChanged:!0}},defocus(){const e=o.current;e&&d.YR.deselect(e)},doesPositionExist(e){const t=o.current;if(!t)return!1;const r=(0,p.cP)(t,e.cellId),n=r&&(0,p.J2)(r.block)?(0,S.y)(r.block):null,i=n?n.split("\n")[e.line-1]:null;return null!=i&&i.length>=e.offset},insertCell(e,t,r){const i=o.current;if(!i)return null;const a=(0,p.zB)(i);if(!a)return null;const s=(()=>{if("notebook-end"===t)return a.children.length;if("below"===t||"above"===t||"left"===t||"right"===t){const e=null!=r&&r.cellId?(0,p.cP)(i,r.cellId):(0,p.UA)(i);if(!e)return a.children.length;const o=(0,p.Su)(e.path);return"above"===t||"left"===t?o:o+1}(0,n.vE)(t)})();return d.YR.insertNodes(i,(0,k.J)(e.cellId,e,{sortingKey:null,blockGroup:null}),{at:(0,p.Dr)([s])}),{id:e.cellId,type:e.cell_type}},insertCellByType(e,t,r={}){var n,s;const c=o.current;if(!c)return null;const l=(0,p.Sd)(c),u=null!==(n=r.source)&&void 0!==n?n:"",d=r.cellId&&"pandas-dataframe"===(null===(s=r.integration)||void 0===s?void 0:s.type)?this.getCellDataFrameVariableName(r.cellId):null,f=(0,i.EL)(),g=a._I[e],h="sql"===e?(0,T.S6)({id:f,integrationId:r.integration.id,source:u,variableName:d,existingCellCounts:l}):g.createNewCell({id:f,source:u,existingCellCounts:l,metadata:r.metadata});return r.appCoordinates&&(h.metadata.deepnote_app_coordinates=r.appCoordinates),r.hideCodeInPublishedApp&&w.hI.includes(e)&&(h.metadata.deepnote_app_is_code_hidden=!0),this.insertCell(h,t,r)},getCellDataFrameVariableName(e){var t,r;const n=o.current;if(!n)return null;const i=(0,p.cP)(n,e);if(!i)return null;const a=i.block;return"sql"===(null==a?void 0:a.type)?null!==(t=a.metadata.deepnote_variable_name)&&void 0!==t?t:null:"code"===(null==a?void 0:a.type)?(0,T.Vl)(null!==(r=(0,T.sb)((0,S.y)(a).split("\n")))&&void 0!==r?r:""):null},convertCell(e,t,r){const n=o.current;if(!n)return;const i=(0,p.cP)(n,e);if(!i||i.block.type===t)return;(0,c.j)("Block type changed",{from:i.block.type,to:t,workspaceId:r.workspaceId});const a=(0,T.lH)(i.block,t);d.YR.setNodes(n,a,{at:i.path})},getCellSqlIntegrationId(e){var t;const r=o.current;if(!r)return null;const n=(0,p.cP)(r,e);return n&&"sql"===n.block.type&&null!==(t=n.block.metadata.sql_integration_id)&&void 0!==t?t:null},async changeSqlCellIntegration(e,t){const r=o.current;r&&(0,p.HT)(r,e,{sql_integration_id:t})},getNextAvailableCellId(e,{canBePreviousBlock:t}){const r=o.current;if(!r)return null;const n=(0,p.zB)(r),i=(0,p.cP)(r,e);if(!n||!i)return null;const a=(0,p.Su)(i.path);if(n.children.length!==a+1){const e=n.children[a+1];return e&&(0,p._C)(e)?e.id:null}if(t){const e=n.children[a-1];return e&&(0,p._C)(e)?e.id:null}return null},up(e){const t=o.current;if(!t)return null;const r=(0,p.zB)(t),n=(0,p.cP)(t,e);if(!n||!r)return null;const i=(0,p.Su)(n.path),a=b(r.children,i);return a?(m(t,a),n.block.id):null},down(e){const t=o.current;if(!t)return null;const r=(0,p.zB)(t),n=(0,p.cP)(t,e);if(!n||!r)return null;const i=(0,p.Su)(n.path),a=y(r.children,i);return a?(m(t,a),n.block.id):null},moveCells(e,t,r,n){const i=o.current;if(!i)return;const a=(0,p.cP)(i,n);if(!a)return;const s=this.getCellIndex(t),c=(0,p.Su)(a.path),l="above"===r||"left"===r?c:c+1+0,u=s<l?l-1:l;(0,p.GW)(i,{match:t=>e.includes(t.id),to:(0,p.Dr)([u]),targetBlockGroup:"left"===r||"right"===r?a.block.block_group:null})},duplicateCell(e){const t=o.current;if(!t)return null;const r=(0,p.cP)(t,e);if(!r)return null;const n=(0,p.Su)(r.path)+1,i=(0,p.Qi)(r.block,{existingVariableNames:(0,p.gz)(t)});return d.YR.insertNodes(t,i,{at:(0,p.Dr)([n])}),i.id},duplicateCells(e){const t=o.current;if(!t)return null;const r=[...(0,p.am)(t,{match:t=>e.includes(t.id)})],n=r.at(-1);if(!n)return null;const i=(0,p.Su)(n[1])+1,a=[];return d.ML.withoutNormalizing(t,(()=>{r.forEach((([e],o)=>{const r=(0,p.Qi)(e,{existingVariableNames:(0,p.gz)(t)}),n=i+o;d.YR.insertNodes(t,r,{at:(0,p.Dr)([n])}),a.push(r.id)}))})),a},deleteCell(e){const t=o.current;if(!t)return;const r=(0,p.cP)(t,e);r&&d.YR.removeNodes(t,{at:r.path})},deleteCells(e){const t=o.current;t&&d.YR.removeNodes(t,{at:(0,p.Dr)([]),match:t=>(0,p._C)(t)&&e.includes(t.id)})},getFocusedCellOutputs(){const e=o.current;if(!e)return C.F;const t=(0,p.UA)(e);if(!t)return C.F;const r=(0,p.Uo)(t.block)&&t.block.state.output_cleared,n=l.getState().output[t.block.id];return r||!n||(0,T.BO)(n)?C.F:n},setCellSharingStatus(e,t){const r=o.current;r&&(0,p.HT)(r,e,{allow_embed:t})},toggleAllCellVisibility(e,t={}){var r;const n=o.current;if(!n)return;const i="output"===e?"is_output_hidden":"is_code_hidden",a=[...(0,p.am)(n)],s=a.some((([e])=>("is_code_hidden"in e.metadata||"is_output_hidden"in e.metadata)&&Boolean(e.metadata[i]))),c=null!==(r=t.newSetting)&&void 0!==r?r:!s;return a.forEach((([t])=>{this.toggleCellVisibility(t.id,e,{newSetting:c})}))},toggleCellVisibility(e,t,r={}){var n;const i=o.current;if(!i)return;const a="output"===t?"is_output_hidden":"is_code_hidden",c="output"===t?"deepnote_app_is_output_hidden":"deepnote_app_is_code_hidden",l=(0,p.cP)(i,e);if(!l)return void(0,s.D)(new Error("Trying to toggle cell output visibility, but there is no cell"),"error");if(!(0,p.Uo)(l.block))return void(0,s.D)(new Error("Trying to toggle cell output visibility, but the cell is not executable"),"warning");const u=l.block.metadata[a],d=null!==(n=r.newSetting)&&void 0!==n?n:!u,f=null==l.block.metadata[c]?{[c]:d}:{};(0,p.HT)(i,e,A({[a]:d},f))},addCellToApp(e,n={}){const i=o.current;if(!i)return;const a=(0,p.cP)(i,e);if(!a)return;const s=t.getCellElement(e),c=(0,T.Z8)(a.block.type,s);let l=0;if(!n.isNewPublishingExperienceEnabled){const e=(0,p.am)(i,{at:(0,p.Dr)([]),match:e=>(0,r.$q)(e)});l=Math.max(...[...e].map((([e])=>{var t,o,r,n,i;return(null!==(t=null===(o=e.metadata.deepnote_app_coordinates)||void 0===o?void 0:o.y)&&void 0!==t?t:0)+(null!==(r=null===(n=e.metadata)||void 0===n||null===(i=n.deepnote_app_coordinates)||void 0===i?void 0:i.h)&&void 0!==r?r:0)})),0)+1}(0,p.HT)(i,e,(e=>{e.deepnote_app_coordinates=A(A({},c),{},{y:l}),"is_code_hidden"in e&&void 0!==e.is_code_hidden&&(e.deepnote_app_is_code_hidden=e.is_code_hidden),"is_output_hidden"in e&&void 0!==e.is_output_hidden&&(e.deepnote_app_is_output_hidden=e.is_output_hidden)}))},updateCellAppCoordinates(e,t){var r;const n=o.current;if(!n)return;const i=(0,p.cP)(n,e);if(!i)return;const{x:a,y:s,w:c,h:l}=null!==(r=i.block.metadata.deepnote_app_coordinates)&&void 0!==r?r:{};u()({x:a,y:s,w:c,h:l},t)||(0,p.HT)(n,e,{deepnote_app_coordinates:t})},removeCellFromApp(e){const t=o.current;t&&(0,p.HT)(t,e,(e=>{delete e.deepnote_app_coordinates}))},toggleCellCodeInApp(e,t){const r=o.current;r&&(0,p.HT)(r,e,{deepnote_app_is_code_hidden:t})},toggleCellOutputInApp(e,t){const r=o.current;r&&(0,p.HT)(r,e,{deepnote_app_is_output_hidden:t})},createArticleFromEmptyState(){const e=o.current;if(!e)return;const t=(0,p.am)(e);for(const[e]of t)this.addCellToApp(e.id)},createDashboardFromEmptyState(){const e=o.current;if(!e)return;const t=(0,p.am)(e).next().value,{block:r}=(0,p.Bu)(t);r&&this.addCellToApp(r.id)},createPowerfulArticleFromEmptyState(){const e=o.current;if(!e)return;const t=(0,p.am)(e);for(const[e]of t)this.addCellToApp(e.id,{isNewPublishingExperienceEnabled:!0})},clearAllAppCoordinates(){const e=o.current;if(!e)return;const t=(0,p.am)(e,{at:(0,p.Dr)([]),match:e=>(0,r.$q)(e)});for(const[o]of t)(0,p.HT)(e,o.id,(e=>{delete e.deepnote_app_coordinates}))},async editVisualizationCellSpec(e,t){const r=o.current;if(!r)return;const n=(0,p.cP)(r,e);n&&("visualization"===n.block.type?(0,p.HT)(r,e,{deepnote_visualization_spec:t}):(0,s.D)(new Error(`Trying to deepnote_visualization_spec property on cell type ${n.block.type}`),"error"))},editCellVariableName(e,t){const r=o.current;if(!r)return;const i=(0,p.cP)(r,e);if(!i)return;const a=i.block.type;"input-date"===a||"input-select"===a||"input-slider"===a||"input-text"===a||"sql"===a||"visualization"===a?(0,p.HT)(r,e,(e=>{t?e.deepnote_variable_name=(0,n.mk)(t):delete e.deepnote_variable_name})):(0,s.D)(new Error(`Trying to change variable name property on cell type ${a}`),"error")},editInputCellSelectMetadata(e,t,r,n,i){var a;const c=o.current;if(!c)return;const l=(0,p.cP)(c,e);if(!l)return;const u=l.block.type;if("input-date"!==u&&"input-select"!==u&&"input-slider"!==u&&"input-text"!==u)return void(0,s.D)(new Error("Trying to change input property on non-input cell type"),"error");const d=null!==(a=t[0])&&void 0!==a?a:"",f=l.block.metadata.deepnote_variable_value,g=t.includes(f)?f:d;(0,p.HT)(c,e,{deepnote_variable_value:g,deepnote_variable_options:t,deepnote_variable_custom_options:r,deepnote_variable_selected_variable:n,deepnote_variable_select_type:i})},setCellColor(e,t){const r=o.current;if(!r)return;const n=(0,p.cP)(r,e);n&&((0,p.my)(n.block)?(0,p.HT)(r,e,{color:t}):(0,s.D)(new Error("Trying to change color property on non-callout cell"),"error"))},ensureSelectInputValidValue(e){var t;const r=o.current;if(!r)return;const n=(0,p.cP)(r,e);if(!n||"input-select"!==n.block.type)return;const{block:i}=n,a=null!==(t=i.metadata.deepnote_variable_options)&&void 0!==t?t:[],s=i.metadata.deepnote_variable_value;var c;"from-variable"===i.metadata.deepnote_variable_select_type&&Boolean(i.metadata.deepnote_variable_selected_variable)&&!a.includes(s)&&(0,p.HT)(r,e,{deepnote_variable_value:null!==(c=a[0])&&void 0!==c?c:""})},updateImageCellAlignment(e,t){const r=o.current;if(!r)return;const n=(0,p.cP)(r,e);n&&((0,p.Jo)(n.block)?(0,p.HT)(r,e,{deepnote_img_alignment:null!=t?t:void 0}):(0,s.D)(new Error(`Trying to set image block property on non-image cell: ${n.block.type}`),"error"))},updateImageCellWidth(e,t){const r=o.current;if(!r)return;const n=(0,p.cP)(r,e);n&&((0,p.Jo)(n.block)?(0,p.HT)(r,e,{deepnote_img_width:null!=t?t:void 0}):(0,s.D)(new Error(`Trying to set image block property on non-image cell: ${n.block.type}`),"error"))},transact(e){const t=o.current;t&&d.ML.withoutNormalizing(t,e)}}}},35327:(e,t,o)=>{"use strict";o.d(t,{j:()=>a});var r=o(1067),n=o(79638);const i=["Syntax error:","[31mERROR","Killed |"];function a(e){return e.some((e=>(0,n.VZ)(e)||(0,n.ee)(e)&&e.text&&i.some((t=>(0,r.vu)(e.text,"").includes(t)))))}},15531:(e,t,o)=>{"use strict";o.d(t,{BV:()=>g,CO:()=>b,C_:()=>m,G5:()=>l,JF:()=>c,QP:()=>p,UY:()=>u,aq:()=>f,dv:()=>d,hE:()=>s,h_:()=>h,mt:()=>i,rN:()=>a,rs:()=>n,v5:()=>v});var r=o(78914);const n=e=>!!e&&"terminal"===e.type,i=e=>!!e&&"notebook"===e.type,a=e=>!!e&&"file"===e.type,s=e=>i(e)||a(e),c=e=>!!e&&"preview"===e.type,l=e=>null==e?void 0:e.toLowerCase().endsWith(".ipynb"),u=e=>e.toLowerCase().endsWith(".zip")||e.toLowerCase().endsWith(".tar")||e.toLowerCase().endsWith(".tar.gz"),d=e=>null==e?void 0:e.toLowerCase().endsWith(".csv"),p=e=>e.toLowerCase().endsWith(".py"),f=e=>e.toLowerCase().endsWith(".txt"),g=e=>e.toLowerCase().endsWith(".xlsx"),h=e=>e.toLowerCase().endsWith("dockerfile"),m=e=>e.toLowerCase().endsWith(".pdf"),y=[".png",".jpg",".jpeg",".gif",".svg",".webp"],b=e=>y.some((t=>e.toLowerCase().endsWith(t))),v=e=>!e.relativePath.startsWith("/.deepnote")&&e.relativePath!==r.Fd},69299:(e,t,o)=>{"use strict";o.d(t,{_U:()=>d,Zg:()=>m,hU:()=>c,mD:()=>u,UO:()=>l,Of:()=>h,uX:()=>b,xb:()=>v,K:()=>f,F5:()=>g,wT:()=>y});var r=o(78914),n=o(63791),i=o(11524);var a=o(37778),s=o(66648);function c(e){const t=["/"];let o="";for(const r of s.dirname(s.normalize(e)).split("/"))r&&(o=`${o}/${r}`,t.push(o));return t}function l(e){return s.basename(e)}function u(e){return e.substr(e.lastIndexOf(".")+1)}function d(e,t){if(e===t)return!1;const o=e.split("/");return!t.split("/").every(((e,t)=>o[t]===e))}function p(e){const t=e.relativePath.split("/");return t[t.length-1]}function f(e,t,o){const r=p(e);if("file"===t.type){const e=function(e,t){const o=e.relativePath.split("/");if(1===o.length)return null;const r=t[o.slice(0,o.length-1).join("/")];return r||null}(t,o);if(null!=e&&e.children)return!e.children.includes(r);return p(t)!==r}return!t.children||!t.children.includes(r)}const g=e=>{const t=e.relativePath;return"/"!==t&&t!==r.Fd&&!t.startsWith("/.deepnote")};function h(e){try{const r=new URL(e);if(r.host===window.location.host&&r.protocol===window.location.protocol){var t,o;const e=null!==(t=null!==(o=r.pathname.match(/^\/workspace\/([^/]+)\/project\/([^/]+)/))&&void 0!==o?o:r.pathname.match(/^\/project\/([^/]+)/))&&void 0!==t?t:null,i=null==e?void 0:e[e.length-1],a=i?(0,n.ae)(i):null;if(!e||!a)return null;const s=e[0].length+1,c=decodeURIComponent(r.pathname.substr(s));return{filePath:c.startsWith("/")?c:`/${c}`,cellId:r.hash.substr(1)||void 0,projectNameSlug:a.name,projectId:a.id}}return null}catch(e){return null}}const m=(e,t)=>{const{relativePath:o}=e;return s.basename(o)===t.relativePath||t.relativePath===o||s.dirname(o)===t.relativePath?o:(0,i.IQ)(e)&&"/"===t.relativePath?`/${s.basename(e.relativePath)}`:(0,i.zE)(t)&&"/"===s.dirname(t.relativePath)?`/${s.basename(o)}`:(0,i.zE)(t)&&(0,i.zE)(t)?`${s.dirname(t.relativePath)}/${s.basename(o)}`:(0,i.IQ)(e)?`${t.relativePath}/${s.basename(o)}`:"/"===t.relativePath?`/${s.basename(o)}`:`${t.relativePath}/${s.basename(o)}`},y=e=>{const t={};return e.forEach((e=>{t[e.relativePath]=e})),t},b=(e,t)=>{const o=((e,t)=>{let o=e.replace(/^~/,"/root");if(t.isAbsolute(o)){const e=/^\/root\/work\/|^\/work\//;o=o.replace(e,""),o=t.normalize(o)}return o})(e,s);return`/api/project/${t}/download-file?path=${encodeURIComponent(o)}`},v=e=>{if(e.resourceSrc){if((0,a.n)(e.resourceSrc)){const t=(0,s.join)(e.pathToFolder,e.resourceSrc);return b(t,e.projectId)}return e.resourceSrc}}},61707:(e,t,o)=>{"use strict";o.d(t,{Y:()=>n});var r=o(93541);const n=e=>{const t=(0,r.x1)();t&&"pageload"===t.op&&(e?(t.setStatus("ok"),t.tags["project-initialisation"]="successful"):(t.setStatus("internal_error"),t.tags["project-initialisation"]="failed"),t.finish())}},28424:(e,t,o)=>{"use strict";function r(e){return e.location?(t=e.location)&&"block_id"in t?t.block_id:null:null;var t}o.d(t,{$:()=>r})},26199:(e,t,o)=>{"use strict";o.d(t,{g:()=>i,j:()=>a});var r=o(28607),n=o(60802);const i=({project:e,filePath:t,urlHash:o,notebookInDB:i})=>(0,r.gC)({serverUrl:n.KB,project:e,filePath:t,urlHash:o,notebookInDB:i}),a=({project:e,author:t})=>(0,r.jD)({serverUrl:n.KB,project:e,author:t})},65317:(e,t,o)=>{"use strict";o.d(t,{Z:()=>i});var r=o(3285),n=o(87340);function i(e,t,o=3){let i=0;const a={current:null};return[a,async()=>{for(;i<o&&!a.current;){i++;try{a.current=await e()}catch(e){i===o&&((0,r.D)(e,"warning",{message:"We failed loading a library 3 times.",userFacingMessage:t}),t&&(n.Z.closeAll(),n.Z.error({message:t})))}}return a.current}]}},40972:(e,t,o)=>{"use strict";o.d(t,{Z:()=>c});var r=o(97054),n=o(91987),i=o(65317),a=o(51625);const s={default:(...e)=>(0,a.BX)("div",{children:["Component failed to load. Please refresh the browser or"," ",(0,a.tZ)(r.r,{isExternal:!0,href:"mailto:help@deepnote.com",children:"contact our support"}),"."]})};function c(e,t=3){const[,o]=(0,i.Z)(e,null,t),r=async()=>{const e=await o();return null!=e?e:s};return(0,n.lazy)(r)}},60716:(e,t,o)=>{"use strict";o.d(t,{LI:()=>b,X8:()=>m,fF:()=>y,n3:()=>h,zM:()=>E});var r=o(77424),n=o(1067),i=o(36042),a=o.n(i),s=o(32902),c=o.n(s),l=o(69299),u=o(48338);function d(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,r)}return o}function p(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?d(Object(o),!0).forEach((function(t){f(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):d(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}function f(e,t,o){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var o=e[Symbol.toPrimitive];if(void 0!==o){var r=o.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}const g={[u.AY.VERSION_AUTOMATIC]:[r.TD.PROJECT_VERSION],[u.AY.VERSION_MANUAL]:[r.TD.PROJECT_VERSION],[u.AY.SNAPSHOT_AUTOMATIC]:[r.TD.SNAPSHOT],[u.AY.SNAPSHOT_MANUAL]:[r.TD.SNAPSHOT],[u.AY.FILE_CHANGES]:[r.TD.EDIT_NOTEBOOK,r.TD.NEW_FILE,r.TD.NEW_DIRECTORY,r.TD.DELETE_FILE,r.TD.RENAME_FILE],[u.AY.EXECUTIONS]:[r.TD.EXECUTE_CELL,r.TD.EXECUTE_ALL,r.TD.EXECUTE_PUBLISHED],[u.AY.KERNEL]:[r.TD.KERNEL_INTERRUPT,r.TD.KERNEL_RESTART],[u.AY.HARDWARE]:[r.TD.RESTART_HARDWARE,r.TD.HARDWARE_PREEMPTION,r.TD.HARDWARE_OUT_OF_QUOTA,r.TD.HARDWARE_SHUTDOWN_INACTIVITY,r.TD.PAY_AS_YOU_GO_DISABLED],[u.AY.SCHEDULED_RUNS]:[r.TD.SCHEDULED_RUN_FAILED,r.TD.SCHEDULED_RUN_SUCCESS,r.TD.SCHEDULED_RUN_SKIPPED],[u.AY.NOTEBOOK_SCHEDULE]:[r.TD.NOTEBOOK_SCHEDULING_ENABLED,r.TD.NOTEBOOK_SCHEDULING_DISABLED,r.TD.NOTEBOOK_SCHEDULING_UPDATED],[u.AY.PUBLISHING]:[r.TD.PUBLISH_NOTEBOOK,r.TD.UNPUBLISH_NOTEBOOK,r.TD.TOGGLE_PUBLIC_LISTING,r.TD.TOGGLE_PUBLISHED_ACCESS]};(0,n.UT)(0),(0,n.UT)(0);const h=e=>c()(a()(e.map((e=>g[e])))),m=e=>e.map((e=>{var t,o,n,i,a;return(e=>!("type"in e))(e)?{id:e.id,userId:null!==(i=e.user_id)&&void 0!==i?i:void 0,projectId:e.project_id,fileId:void 0,type:r.TD.PROJECT_VERSION,createdAt:new Date(e.created_at),metadata:null!==(a=e.metadata)&&void 0!==a?a:void 0}:{id:String(e.id),userId:null!==(t=e.user_id)&&void 0!==t?t:void 0,projectId:e.project_id,fileId:null!==(o=e.file_id)&&void 0!==o?o:void 0,type:e.type,createdAt:new Date(e.created_at),metadata:null!==(n=e.metadata)&&void 0!==n?n:void 0}})),y=(e,t)=>e.includes(t)?e:[...e,t],b=e=>{var t;const o=v(e),r="API"===(null===(t=e.metadata)||void 0===t?void 0:t.triggeredBy)?" (via API)":"";return p(p({},o),{},{name:(null==o?void 0:o.name)+r})},v=e=>{switch(e.type){case r.TD.EXECUTE_CELL:return{type:u.AY.EXECUTIONS,color:u.er.EXECUTIONS,name:"Block executed"};case r.TD.EXECUTE_ALL:return{type:u.AY.EXECUTIONS,color:u.er.EXECUTIONS,name:"Notebook executed"};case r.TD.EXECUTE_PUBLISHED:return{type:u.AY.EXECUTIONS,color:u.er.EXECUTIONS,name:"Published notebook executed"};case r.TD.EDIT_NOTEBOOK:return{type:u.AY.FILE_CHANGES,color:u.er.FILE_CHANGES,name:"Notebook modified"};case r.TD.NEW_FILE:{var t;const o=(0,l.UO)(null===(t=e.metadata)||void 0===t?void 0:t.path);return{type:u.AY.FILE_CHANGES,color:u.er.FILE_CHANGES,name:"File created",description:o}}case r.TD.DELETE_FILE:{var o;const t=(0,l.UO)(null===(o=e.metadata)||void 0===o?void 0:o.path);return{type:u.AY.FILE_CHANGES,color:u.er.FILE_CHANGES,name:"File deleted",description:t}}case r.TD.RENAME_FILE:{var i,a;const t=(0,l.UO)(null===(i=e.metadata)||void 0===i?void 0:i.path),o=(0,l.UO)(null===(a=e.metadata)||void 0===a?void 0:a.newPath);return{type:u.AY.FILE_CHANGES,color:u.er.FILE_CHANGES,name:"File renamed",description:`${t} → ${o}`}}case r.TD.NEW_DIRECTORY:{var s;const t=(0,l.UO)(null===(s=e.metadata)||void 0===s?void 0:s.path);return{type:u.AY.FILE_CHANGES,color:u.er.FILE_CHANGES,name:"Directory created",description:t}}case r.TD.KERNEL_RESTART:return{type:u.AY.KERNEL,color:u.er.KERNEL,name:"Kernel restart"};case r.TD.KERNEL_INTERRUPT:return{type:u.AY.KERNEL,color:u.er.KERNEL,name:"Kernel interrupt"};case r.TD.RESTART_HARDWARE:return{type:u.AY.HARDWARE,color:u.er.HARDWARE,name:"Machine restarted",description:"All state was cleared"};case r.TD.HARDWARE_PREEMPTION:return{type:u.AY.HARDWARE,color:u.er.HARDWARE,name:"Machine was preempted.",description:"All state was cleared"};case r.TD.HARDWARE_OUT_OF_QUOTA:return{type:u.AY.HARDWARE,color:u.er.HARDWARE,name:"Machine quota ran out.",description:"All state was cleared"};case r.TD.PAY_AS_YOU_GO_DISABLED:return{type:u.AY.HARDWARE,color:u.er.HARDWARE,name:"Pay-as-you-go machines have been disabled.",description:"All state was cleared"};case r.TD.HARDWARE_SHUTDOWN_INACTIVITY:return{type:u.AY.HARDWARE,color:u.er.HARDWARE,name:"Machine was shut down.",description:"Machine was shut down due to inactivity"};case r.TD.SNAPSHOT:{var c,d;const t=e.metadata;return{type:t.automatic?u.AY.SNAPSHOT_AUTOMATIC:u.AY.SNAPSHOT_MANUAL,color:t.automatic?u.er.SNAPSHOT_AUTOMATIC:u.er.SNAPSHOT_MANUAL,name:null===(c=e.metadata)||void 0===c?void 0:c.label,description:null===(d=e.metadata)||void 0===d?void 0:d.description}}case r.TD.PROJECT_VERSION:var p,f;return{type:e.userId?u.AY.VERSION_MANUAL:u.AY.VERSION_AUTOMATIC,color:e.userId?u.er.VERSION_MANUAL:u.er.VERSION_AUTOMATIC,name:null===(p=e.metadata)||void 0===p?void 0:p.title,description:null===(f=e.metadata)||void 0===f?void 0:f.description};case r.TD.NOTEBOOK_SCHEDULING_DISABLED:var g,h;return{type:u.AY.NOTEBOOK_SCHEDULE,color:u.er.NOTEBOOK_SCHEDULE,name:null===(g=e.metadata)||void 0===g?void 0:g.title,description:null===(h=e.metadata)||void 0===h?void 0:h.message};case r.TD.NOTEBOOK_SCHEDULING_ENABLED:var m,y;return{type:u.AY.NOTEBOOK_SCHEDULE,color:u.er.NOTEBOOK_SCHEDULE,name:null===(m=e.metadata)||void 0===m?void 0:m.title,description:null===(y=e.metadata)||void 0===y?void 0:y.message};case r.TD.NOTEBOOK_SCHEDULING_UPDATED:var b,v;return{type:u.AY.NOTEBOOK_SCHEDULE,color:u.er.NOTEBOOK_SCHEDULE,name:null===(b=e.metadata)||void 0===b?void 0:b.title,description:null===(v=e.metadata)||void 0===v?void 0:v.message};case r.TD.SCHEDULED_RUN_FAILED:var E;return{type:u.AY.SCHEDULED_RUNS,color:u.er.SCHEDULED_RUNS,name:"Scheduled run",description:null===(E=e.metadata)||void 0===E?void 0:E.message};case r.TD.SCHEDULED_RUN_SKIPPED:var w;return{type:u.AY.SCHEDULED_RUNS,color:u.er.SCHEDULED_RUNS,name:"Scheduled run",description:null===(w=e.metadata)||void 0===w?void 0:w.message};case r.TD.SCHEDULED_RUN_SUCCESS:var k;return{type:u.AY.SCHEDULED_RUNS,color:u.er.SCHEDULED_RUNS,name:"Scheduled run",description:null===(k=e.metadata)||void 0===k?void 0:k.message};case r.TD.PUBLISH_NOTEBOOK:return{type:u.AY.PUBLISHING,color:u.er.PUBLISHING,name:"Notebook published"};case r.TD.UNPUBLISH_NOTEBOOK:return{type:u.AY.PUBLISHING,color:u.er.PUBLISHING,name:"Notebook unpublished"};case r.TD.TOGGLE_PUBLIC_LISTING:return{type:u.AY.PUBLISHING,color:u.er.PUBLISHING,name:"Notebook listed/unlisted"};case r.TD.TOGGLE_PUBLISHED_ACCESS:return{type:u.AY.PUBLISHING,color:u.er.PUBLISHING,name:"Notebook published access changed"};default:(0,n.vE)(e.type)}};function E(e,t){return Date.now()-e<864e5*t}},91905:(e,t,o)=>{"use strict";o.d(t,{v:()=>n});var r=o(85014);function n(){return{projectId:(0,r.mr)((e=>e.project.id))}}},70523:(e,t,o)=>{"use strict";o.d(t,{PU:()=>s,vP:()=>u});var r=o(64119),n=o(64705),i=o(44539),a=o(91987);const s=r.Ps`
  query GetPayAsYouGoMachinesData($id: String!) {
    team(id: $id) {
      ... on Team {
        id
        payAsYouGoMachinesAllowed
      }
    }
  }
`,c=r.Ps`
  mutation SetPayAsYouGoMachinesAllowed($id: String!, $allowed: Boolean!) {
    setPayAsYouGoMachinesAllowed(team_id: $id, allowed: $allowed) {
      ... on Team {
        id
        payAsYouGoMachinesAllowed
      }
    }
  }
`,l=!0;function u(e){var t;const{data:o,loading:r,error:u}=(0,n.a)(s,{variables:{id:e},fetchPolicy:"cache-first"}),[d,{error:p}]=(0,i.D)(c),f=(0,a.useCallback)((async t=>{await d({variables:{id:e,allowed:t},optimisticResponse:{setPayAsYouGoMachinesAllowed:{id:e,payAsYouGoMachinesAllowed:t}}})}),[d,e]);return{data:{payAsYouGoMachinesAllowed:"Team"===(null==o||null===(t=o.team)||void 0===t?void 0:t.__typename)?o.team.payAsYouGoMachinesAllowed:l},mutations:{setPayAsYouGoMachinesAllowed:f},loading:r,error:u,setPayAsYouGoMachinesAllowedError:p}}},1241:(e,t,o)=>{"use strict";o.d(t,{C9:()=>h,IY:()=>c,x3:()=>f});var r=o(64119),n=o(64705),i=o(44539),a=o(66648),s=o(91987);const c="/",l=r.Ps`
  mutation CreateNotebook($projectId: String!, $name: String!) {
    createNotebook(id: $projectId, name: $name) {
      notebook {
        id
        name
      }
    }
  }
`,u=r.Ps`
  mutation DeleteNotebook($projectId: String!, $id: String!) {
    deleteNotebook(projectId: $projectId, id: $id) {
      id
    }
  }
`,d=r.Ps`
  mutation RenameNotebook($projectId: String!, $id: String!, $name: String!) {
    renameNotebook(projectId: $projectId, id: $id, name: $name) {
      notebook {
        id
        name
      }
    }
  }
`,p=r.Ps`
  mutation DuplicateNotebook($projectId: String!, $id: String!) {
    duplicateNotebook(projectId: $projectId, id: $id) {
      notebook {
        id
        name
      }
    }
  }
`,f=r.Ps`
  query GetNotebooksForProjectList($id: String!) {
    projectById(id: $id) {
      __typename
      ... on Project {
        id
        notebooks {
          id
          name
          working_directory
          updated_at
        }
      }
    }
  }
`,g=r.Ps`
  mutation SetWorkingDirectoryForNotebook($projectId: String!, $id: String!, $workingDirectory: String!) {
    setWorkingDirectoryForNotebook(projectId: $projectId, id: $id, workingDirectory: $workingDirectory) {
      notebook {
        id
        name
        working_directory
        updated_at
      }
    }
  }
`,h=e=>{var t,o;const{data:r,loading:h,error:m,refetch:y}=(0,n.a)(f,{variables:{id:e.projectId},fetchPolicy:"cache-first"}),b=(0,s.useCallback)(((t,{data:o})=>{if(null!=o&&o.createNotebook.notebook)return t.modify({id:`Project:${e.projectId}`,fields:{notebooks:(e,{toReference:t})=>[...null!=e?e:[],t(o.createNotebook.notebook,!0)]}})}),[e.projectId]),[v]=(0,i.D)(l,{update:b}),E=(0,s.useCallback)(((e,{data:t})=>{if(null!=t&&t.renameNotebook.notebook)return e.modify({id:e.identify(null==t?void 0:t.renameNotebook.notebook),fields:{name:()=>t.renameNotebook.notebook.name}})}),[]),[w]=(0,i.D)(d),k=(0,s.useCallback)(((t,{data:o})=>{if(null!=o&&o.deleteNotebook)return t.modify({id:`Project:${e.projectId}`,fields:{notebooks:(e,{readField:t})=>e.filter((e=>{var r;return t("id",e)!==(null==o||null===(r=o.deleteNotebook)||void 0===r?void 0:r.id)&&e}))}})}),[e.projectId]),[S]=(0,i.D)(u,{update:k}),C=(0,s.useCallback)(((t,{data:o})=>{if(null!=o&&o.duplicateNotebook.notebook)return t.modify({id:`Project:${e.projectId}`,fields:{notebooks:(e,{toReference:t})=>[...null!=e?e:[],t(o.duplicateNotebook.notebook,!0)]}})}),[e.projectId]),[_]=(0,i.D)(p,{update:C}),T=(0,s.useCallback)((async(t,o)=>{await w({variables:{id:t,name:o,projectId:e.projectId},optimisticResponse:{renameNotebook:{__typename:"RenameNotebookResponse",notebook:{id:t,name:o}}}})}),[e.projectId,w]),I=(0,s.useCallback)((async t=>{await S({variables:{id:t,projectId:e.projectId}})}),[e.projectId,S]),A=(0,s.useCallback)((async t=>{var o;const{data:r}=await v({variables:{projectId:e.projectId,name:null!=t?t:""}});return null!==(o=null==r?void 0:r.createNotebook)&&void 0!==o?o:null}),[v,e.projectId]),O=(0,s.useCallback)((async t=>{var o;const{data:r}=await _({variables:{id:t,projectId:e.projectId}});return null!==(o=null==r?void 0:r.duplicateNotebook)&&void 0!==o?o:null}),[_,e.projectId]),P=(0,s.useCallback)(((e,{data:t})=>{var o;const r=null==t||null===(o=t.setWorkingDirectoryForNotebook)||void 0===o?void 0:o.notebook;if(r)return e.modify({id:e.identify(r),fields:{working_directory:()=>r.working_directory}})}),[]),[j]=(0,i.D)(g,{update:P}),D=(0,s.useCallback)((async(t,o)=>{let r=a.normalize(o);r.startsWith(c)||(r=`/${r}`),await j({variables:{id:t,workingDirectory:r,projectId:e.projectId}})}),[e.projectId,j]);return{data:{notebooks:"Project"===(null==r||null===(t=r.projectById)||void 0===t?void 0:t.__typename)&&null!==(o=r.projectById.notebooks)&&void 0!==o?o:[]},refetch:y,loading:h,error:m,mutations:{createNotebook:A,deleteNotebook:I,renameNotebook:T,duplicateNotebook:O,setWorkingDirectoryForNotebook:D},mutationCallbacks:{createNotebookMutationCallback:b,renameNotebookMutationCallback:E,deleteNotebookMutationCallback:k,duplicateNotebookMutationCallback:C,setWorkingDirectoryForNotebookCallback:P}}}},34974:(e,t,o)=>{"use strict";(0,o(60802).sk)()&&void 0!==o.g&&(o.g.window=void 0)},69531:(e,t,o)=>{"use strict";o.d(t,{B1:()=>u,nm:()=>n,QW:()=>y});var r=o(51625);const n=({standardPlanDisplayName:e,proPlanDisplayName:t,enterprisePlanDisplayName:o}={standardPlanDisplayName:"Free",proPlanDisplayName:"Team",enterprisePlanDisplayName:"Enterprise"})=>[{question:"Is there a free version of Deepnote?",answer:"Absolutely! Individuals and small teams can use Deepnote for free — no credit card or payment details needed. Just sign up to get started."},{question:`How is the ${e} Plan different from the ${t} and ${o} Plans?`,answer:(0,r.BX)(r.HY,{children:["The ",e," plan is designed for hobbyists and individuals. It allows up to 3 editors and 5 projects in the workspace.",(0,r.tZ)("br",{}),(0,r.tZ)("br",{}),"Our ",t," plan is designed for, well, teams. The ",t," plan allows for an unlimited number of editors to create an unlimited number of projects. The ",t," plan also includes more advanced features such as an extended 30-day version history and static IP addresses.",(0,r.tZ)("br",{}),(0,r.tZ)("br",{}),"For larger organizations who need a little (or a lot) more, we have the ",o," plan. The"," ",o," plan comes with unlimited version history, Okta SSO, dedicated support resources, and the option for customized machines to fit your needs."]})},{question:"Do you offer any education or non-profit discounts?",answer:(0,r.BX)(r.HY,{children:["Yes! Students, teachers, and other learning courses in academia get free access to our Education plan. The Education plan offers all the benefits of the ",t," plan, except access to stronger machines.",(0,r.tZ)("br",{}),(0,r.tZ)("br",{}),"To get started with the Education plan, simply sign up for a Deepnote account with an email address from your school or organization."]})},{question:"What happens if I run out of computation time?",answer:(0,r.BX)(r.HY,{children:["In the rare case that you run out of computation time, you have a few options:",(0,r.tZ)("br",{}),(0,r.tZ)("br",{}),"1. Wait until the month rolls over and the hours are replenished.",(0,r.tZ)("br",{}),"2. Invite more editors or admins to your workspace. Every additional editor will add 750 hours to the workspace’s total computation time. ",(0,r.tZ)("br",{}),"3. You can also pay for more machine hours at an hourly rate (see our Pricing table).",(0,r.tZ)("br",{}),(0,r.tZ)("br",{}),"Note: Even if you run out of hours, you can still access and edit all your notebooks."]})}];function i(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,r)}return o}function a(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?i(Object(o),!0).forEach((function(t){s(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):i(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}function s(e,t,o){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var o=e[Symbol.toPrimitive];if(void 0!==o){var r=o.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}const c={"data-warehouses-and-lakes-in-jupyter-compatible-data-notebooks":"Data warehouses & lakes","databases-in-jupyter-compatible-data-notebooks":"Databases","local-files-and-file-hosting-in-jupyter-compatible-data-notebooks":"Files","collaboration-and-productivity-in-jupyter-compatible-data-notebooks":"Collaboration & productivity","machine-learning-ops-in-jupyter-compatible-data-notebooks":"Machine learning","data-transformation-and-processing-in-jupyter-compatible-data-notebooks":"Data processing","docker-container-registries-in-jupyter-compatible-data-notebooks":"Docker container registries","version-control-in-jupyter-compatible-data-notebooks":"Version control"},l={"aws-data-stack-in-jupyter-compatible-notebooks":"AWS stack","google-cloud-platform-data-stack-in-jupyter-compatible-notebooks":"Google Cloud stack","azure-data-stack-in-jupyter-compatible-notebooks":"Azure stack"},u=(a(a(a({},c),l),{},{all:"All"}),a(a(a({},c),l),{},{all:"All","data-warehouses-and-lakes-in-jupyter-compatible-data-notebooks":"Data warehouse & lake","databases-in-jupyter-compatible-data-notebooks":"Database","local-files-and-file-hosting-in-jupyter-compatible-data-notebooks":"File","docker-container-registries-in-jupyter-compatible-data-notebooks":"Docker container registry"}),"https://portal.productboard.com/deepnote/1-deepnote-product-portal/tabs/1-under-consideration/submit-idea");var d=o(39486),p=o(13636),f=o(37936);function g(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,r)}return o}function h(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?g(Object(o),!0).forEach((function(t){m(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):g(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}function m(e,t,o){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var o=e[Symbol.toPrimitive];if(void 0!==o){var r=o.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}const y={mongodb:h(h({},f.kM.mongodb),{},{icon:d.bep,iconBgColor:"#F5FCF7",landingDesciption:"Connect to a MongoDB instance and query data with pymongo.",landingLink:"/integrations/mongodb",usageType:"Built-in",category:"Database"}),pgsql:h(h({},f.kM.pgsql),{},{icon:d._CE,iconBgColor:"#337EBB14",landingDesciption:"Connect to a Postgres instance and use SQL directly from a notebook interface.",landingLink:"/integrations/postgresql",usageType:"Built-in",category:"Database"}),clickhouse:h(h({},f.kM.clickhouse),{},{icon:d.kc_,iconBgColor:"#FFFBEC",landingDesciption:"Connect to a ClickHouse instance and use SQL directly from a notebook interface.",isNew:!0,usageType:"Built-in",category:"Database"}),redshift:h(h({},f.kM.redshift),{},{icon:d.UQY,iconBgColor:"rgba(67, 135, 250, 0.1)",landingDesciption:"Connect to a Redshift warehouse and query the data using Deepnote SQL blocks.",landingLink:p._.docsPage("redshift"),usageType:"Built-in",category:"Data warehouse"}),athena:h(h({},f.kM.athena),{},{icon:d.UjL,iconBgColor:"#fcf1d0",landingDesciption:"Connect to Athena instance and query the data using Deepnote SQL blocks.",usageType:"Built-in",category:"Data warehouse"}),github:h(h({},f.kM.github),{},{icon:d.ETn,iconBgColor:"#9099A31A",iconColor:"#393A3F",landingDesciption:"Attach a repository to your project to read or commit to any branch.",landingLink:"/integrations/github",usageType:"Built-in",category:"Other"}),gitlab:h(h({},f.kM.gitlab),{},{icon:d.Ts0,iconBgColor:"rgba(0, 0, 0, 0.05)"}),env:h(h({},f.kM.env),{},{icon:d.Qmz,iconBgColor:"rgba(0, 0, 0, 0.05)",usageType:"Built-in",category:"Others"}),"google-drive":h(h({},f.kM["google-drive"]),{},{icon:d.mfL,iconBgColor:"#FDF7E5",landingDesciption:"Mount Google Drive directories in your projects to read and edit its files.",landingLink:"/integrations/drive",usageType:"Built-in",category:"Files"}),local:h(h({},f.kM.local),{},{icon:d.rG2,iconBgColor:"rgba(0, 0, 0, 0.05)",usageType:"Built-in",category:"Files"}),s3:h(h({},f.kM.s3),{},{icon:d.Lrn,iconBgColor:"#F1E5E2",landingDesciption:"Attach a bucket to your project and read, edit or upload files to the bucket.",landingLink:"/integrations/s3",usageType:"Built-in",category:"Files"}),mysql:h(h({},f.kM.mysql),{},{icon:d.Em1,iconBgColor:"#E7F5FF",landingDesciption:"Connect to a MySQL instance and query the data using Deepnote SQL blocks.",usageType:"Built-in",category:"Database"}),mariadb:h(h({},f.kM.mariadb),{},{icon:d.kG7,iconBgColor:"#E7F5FF",landingDesciption:"Connect to a MariaDB instance and query the data using Deepnote SQL blocks.",usageType:"Built-in",category:"Database"}),mindsdb:h(h({},f.kM.mindsdb),{},{icon:d.PZJ,iconBgColor:"#00B06D20",usageType:"Built-in",category:"Files"}),"big-query":h(h({},f.kM["big-query"]),{},{icon:d.pn3,iconBgColor:"rgba(67, 135, 250, 0.1)",landingDesciption:"Connect to your BigQuery warehouse and query the data using Deepnote SQL blocks.",landingLink:"/integrations/bigquery",usageType:"Built-in",category:"Data warehouse"}),gcs:h(h({},f.kM.gcs),{},{icon:d.C0D,iconBgColor:"#E5F1FD",landingDesciption:"Mount both public and private buckets directly to the project filesystem.",usageType:"Built-in",category:"Data processing"}),snowflake:h(h({},f.kM.snowflake),{},{icon:d.jeN,iconBgColor:"#E6F9FE",landingDesciption:"Connect to a Snowflake warehouse and query the data using Deepnote SQL blocks.",landingLink:"/integrations/snowflake",usageType:"Built-in",category:"Data warehouse"}),dbt:h(h({},f.kM.dbt),{},{icon:d.TvS,iconBgColor:"#E6F9FE",landingDesciption:"Connect to a Snowflake warehouse and query the data using Deepnote SQL blocks.",landingLink:"/integrations/snowflake",usageType:"Built-in",category:"Data warehouse"}),dropbox:h(h({},f.kM.dropbox),{},{icon:d.Xwr,iconBgColor:"#EBF2FE",landingDesciption:"Read and write to your Dropbox files directly from a notebook."}),arize:h(h({},f.kM.arize),{},{icon:d.Lj3,iconBgColor:"rgba(238, 51, 138, 0.1)"}),slack:h(h({},f.kM.slack),{},{icon:d.mUE,iconBgColor:"rgba(236, 178, 46, 0.1)"}),wandb:h(h({},f.kM.wandb),{},{icon:d.DZE,iconBgColor:"#000"}),ecr:h(h({},f.kM.ecr),{},{icon:d._qN,iconBgColor:"#FC6D261A",landingDesciption:"Authenticate and use your private Docker images from AWS ECR as a base for Deepnote projects.",usageType:"Built-in",category:"Docker container"}),gcr:h(h({},f.kM.gcr),{},{icon:d.Kyf,iconBgColor:"#FDF7E5",landingDesciption:"Authenticate and use your private Docker images from GCR as a base for Deepnote projects.",usageType:"Built-in",category:"Docker container"}),dockerhub:h(h({},f.kM.dockerhub),{},{icon:d.y3m,iconBgColor:"#E7F5FF",landingDesciption:"Authenticate and use your private Docker images from DockerHub as a base for Deepnote projects.",usageType:"Built-in",category:"Docker container"}),"pandas-dataframe":h(h({},f.kM["pandas-dataframe"]),{},{icon:d.VHe,iconBgColor:"rgba(0, 0, 0, 0.05)"}),"ssh-key":h(h({},f.kM["ssh-key"]),{},{icon:d.BKe,iconBgColor:"rgba(0, 0, 0, 0.05)",usageType:"Built-in",category:"Other"}),python:h(h({},f.kM.python),{},{icon:d.gxY,iconBgColor:"#0277BD"}),"sql-server":h(h({},f.kM["sql-server"]),{},{icon:d.HwW,iconBgColor:"rgba(0, 0, 0, 0.05)",landingDesciption:"Connect to a Azure SQL or Microsoft SQL Server instance and query the data using Deepnote SQL blocks.",usageType:"Built-in",category:"Data warehouse"}),julia:h(h({},f.kM.dbt),{},{icon:d.e7x,iconBgColor:"#9259a3"}),rlang:h(h({},f.kM.dbt),{},{icon:d.JWN,iconBgColor:"#276DC3"}),javascript:h(h({},f.kM.dbt),{},{icon:d.r3e,iconBgColor:"#f7df1e"}),pytorch:h(h({},f.kM.dbt),{},{icon:d.BjK,iconBgColor:"#EE4C2C"}),tensorflow:h(h({},f.kM.dbt),{},{icon:d.RPH,iconBgColor:"#FFA800"}),plotly:h(h({},f.kM.dbt),{},{icon:d.P9k,iconBgColor:"#25fefd"}),pandas:h(h({},f.kM.dbt),{},{icon:d.FhJ,iconBgColor:"#130754"}),spark:h(h({},f.kM.dbt),{},{icon:d.xT3,iconBgColor:"#e25a1c"}),dataproc:h(h({},f.kM.dataproc),{},{icon:d.am9,iconBgColor:"rgba(67, 135, 250, 0.1)",landingDesciption:"Connect to a Google Dataproc and use Spark directly from a notebook interface.",landingLink:"/integrations/dataproc"}),notion:h(h({},f.kM.notion),{},{icon:d.xT3,iconBgColor:"#e25a1c"}),airtable:h(h({},f.kM.airtable),{},{icon:d.xT3,iconBgColor:"#e25a1c"}),telegram:h(h({},f.kM.telegram),{},{icon:d.xT3,iconBgColor:"#e25a1c"}),supabase:h(h({},f.kM.supabase),{},{icon:d.xT3,iconBgColor:"#e25a1c"}),influxdb:h(h({},f.kM.influxdb),{},{icon:d.xT3,iconBgColor:"#e25a1c"}),onedrive:h(h({},f.kM.onedrive),{},{icon:d.xT3,iconBgColor:"#e25a1c"}),"azure-blob-storage":h(h({},f.kM["azure-blob-storage"]),{},{icon:d.xT3,iconBgColor:"#e25a1c"}),"deepnote-api":h(h({},f.kM["deepnote-api"]),{},{icon:d.xT3,iconBgColor:"#e25a1c"}),"snowflake-snowpark":h(h({},f.kM["snowflake-snowpark"]),{},{icon:d.xT3,iconBgColor:"#e25a1c"}),"great-expectations":h(h({},f.kM["great-expectations"]),{},{icon:d.xT3,iconBgColor:"#e25a1c"}),"weights-and-biases":h(h({},f.kM["weights-and-biases"]),{},{icon:d.xT3,iconBgColor:"#e25a1c"}),comet:h(h({},f.kM.comet),{},{icon:d.xT3,iconBgColor:"#e25a1c"}),neptune_ai:h(h({},f.kM.neptune_ai),{},{icon:d.xT3,iconBgColor:"#e25a1c"}),trino:h(h({},f.kM.trino),{},{icon:d.h90,iconBgColor:"#e25a1c"}),dremio:h(h({},f.kM.dremio),{},{icon:d.$UR,iconBgColor:"#e25a1c"}),"google-sheets":h(h({},f.kM["google-sheets"]),{},{icon:d.K55,iconBgColor:"#e25a1c"}),box:h(h({},f.kM.box),{},{icon:d.O5d,iconBgColor:"#e25a1c"}),ssh_tunnel:h(h({},f.kM.ssh_tunnel),{},{icon:d.BKe,iconBgColor:"rgba(0, 0, 0, 0.05)",usageType:"Built-in",category:"Other"}),github_package:h(h({},f.kM.github_package),{},{icon:d.ETn,iconBgColor:"rgba(0, 0, 0, 0.05)",usageType:"Built-in",category:"Files"}),alloydb:h(h({},f.kM.alloydb),{},{icon:d.P4D,iconBgColor:"#337EBB14",landingDesciption:"Connect to a Google AlloyDB instance and use SQL directly from a notebook interface.",landingLink:"/integrations/google-alloydb",usageType:"Built-in",category:"Database"}),"cloud-sql":h(h({},f.kM["cloud-sql"]),{},{icon:d.P4D,iconBgColor:"#337EBB14",landingDesciption:"Connect to a Google Cloud SQL instance and use SQL directly from a notebook interface.",landingLink:"/integrations/google-cloud-sql",usageType:"Built-in",category:"Database"}),spanner:h(h({},f.kM.spanner),{},{icon:d.rcu,iconBgColor:"#337EBB14",landingDesciption:"Connect to a Google Spanner instance and use SQL directly from a notebook interface.",landingLink:"/integrations/google-spanner",usageType:"Built-in",category:"Database"}),materialize:h(h({},f.kM.materialize),{},{icon:d.b8x,iconBgColor:"#337EBB14",landingDesciption:"Connect to a Materialize instance and use SQL directly from a notebook interface.",landingLink:"/integrations/materialize",usageType:"Built-in",category:"Database"})}},98960:(e,t,o)=>{"use strict";o.d(t,{Uh:()=>a,c_:()=>s,k0:()=>n,nn:()=>i,pv:()=>r});const r=e=>"object"==typeof e&&"new-output"===e.type&&"data"in e&&"metadata"in e&&"cellId"in e&&"outputIndex"in e,n=e=>"object"==typeof e&&"output-dimension"===e.type&&"outputIndex"in e&&"cellId"in e&&"offsetY"in e,i=e=>"object"==typeof e&&"output-initialized"===e.type&&e.payload&&["one-iframe-canvas","fill-iframe"].includes(e.payload.type),a=e=>"object"==typeof e&&"layout-updated"===e.type&&"height"in e&&"cellId"in e&&"outputIndex"in e,s=e=>r(e)||i(e)||(e=>"object"==typeof e&&"init-output"===e.type&&"cellId"in e&&"outputIndex"in e)(e)||a(e)||n(e)},97113:(e,t,o)=>{"use strict";o.d(t,{$q:()=>n,fG:()=>i,t1:()=>a});var r=o(14058);function n(e){var t;return Boolean(null===(t=e.metadata)||void 0===t?void 0:t.deepnote_app_coordinates)}function i(e){return!e.isStatic&&(0===e.displayableOutputsCount&&(!e.cell.metadata.is_output_hidden&&!!e.cell.metadata.deepnote_app_outputs_were_cleared))}function a(e){return!!((0,r.M1)(e)||(0,r.dZ)(e)||(0,r.NT)(e)||(0,r.B1)(e))&&("string"==typeof e.source&&""===e.source.trim())}},9551:(e,t,o)=>{"use strict";o.d(t,{n:()=>i});var r=o(88451),n=o.n(r);function i(e){n()(e)}},21472:(e,t,o)=>{"use strict";o.d(t,{P:()=>i});var r=o(23150),n=o(42218);const i=e=>{const t=(0,r.parse)(e,{includeComments:!1}).map((e=>e.raw)).join("");return(0,n.sha224)(t)}},78914:(e,t,o)=>{"use strict";o.d(t,{Fd:()=>r,oH:()=>n});const r="/init.ipynb",n="/Dockerfile"},11524:(e,t,o)=>{"use strict";function r(e){return!!e&&"directory"===e.type}function n(e){return!!e&&"file"===e.type}o.d(t,{IQ:()=>r,zE:()=>n})},80351:(e,t,o)=>{"use strict";o.d(t,{d:()=>r,R:()=>n});const r=["snowflake","s3","sql-server","big-query","mysql","athena","pgsql","redshift","google-drive","mongodb"],n={GET_INTRODUCED:"GET_INTRODUCED",GET_INTRODUCED_SUBSTEP_WELCOME_NOTEBOOK:"GET_INTRODUCED_SUBSTEP_WELCOME_NOTEBOOK",GET_INTRODUCED_SUBSTEP_PRODUCT_DEMO:"GET_INTRODUCED_SUBSTEP_PRODUCT_DEMO",DATA_CONNECTION_SUBSTEP_CSV_UPLOADED:"DATA_CONNECTION_SUBSTEP_CSV_UPLOADED",DATA_CONNECTION:"DATA_CONNECTION",CREATE_FIRST_PROJECT:"CREATE_FIRST_PROJECT",INVITE_COLLABORATORS:"INVITE_COLLABORATORS"}},37778:(e,t,o)=>{"use strict";o.d(t,{n:()=>s,$:()=>c});var r=o(95078),n=o.n(r),i=o(10869),a=o.n(i);const s=e=>!e.startsWith("https://")&&!e.startsWith("http://")&&!e.startsWith("data:"),c=(e,t)=>{let o=!1;if(e.value&&e.value.toLowerCase().includes("<img")){const r=n()().parse(e.value);a()(r,(e=>{var r;const n=null===(r=e.properties)||void 0===r?void 0:r.src;"img"===e.tagName&&n&&s(n)&&(e.properties.src=t(n),o=!0)})),o&&(e.value=n()().stringify(r))}return o}},21823:(e,t,o)=>{"use strict";o.d(t,{js:()=>r.js,yC:()=>r.yC,vQ:()=>n,aR:()=>r.aR});o(71534),o(1067),o(62437);var r=o(3126);function n(e){const t="/"===e[0]?e.substring(1):e;return t.substring(0,t.lastIndexOf(".ipynb"))||t}},3126:(e,t,o)=>{"use strict";o.d(t,{AX:()=>i,aR:()=>n,js:()=>s,yC:()=>a});var r=o(72037);function n(e){return{id:e.substring(e.length-r.wZ,e.length),name:e.substring(0,e.length-r.wZ-1)}}function i(e,t){return`${encodeURIComponent(t)}-${e}`}function a(e,t){return!e.find((e=>e.name===t))}function s(e,t,o={}){var r;const n=null!==(r=null==o?void 0:o.separator)&&void 0!==r?r:"-";let i=void 0===o.startingNumber?1:o.startingNumber,s=t+(o.startWithNumber?n+i:""),c=a(e,s);for(;!c;)i+=1,s=t+n+i,c=a(e,s);return s}},77535:(e,t,o)=>{"use strict";o.d(t,{MT:()=>r.MT,Pd:()=>r.Pd,Rq:()=>r.Rq,Zu:()=>r.Zu,wi:()=>r.wi});var r=o(62437)},62437:(e,t,o)=>{"use strict";o.d(t,{MT:()=>c,Pd:()=>i,Rq:()=>a,Zu:()=>u,wi:()=>l});var r=o(79638),n=o(38537);o(1067);function i(e){return r.Li(e)||r.Xg(e)}function a(e){return i(e)&&Boolean(e.data[n.Sn])}const s=[n.PW];function c(e){if(!i(e))return!0;return!Object.keys(e.data).every((e=>s.includes(e)))}function l(e){return i(e)&&Boolean(e.data[n.PW])}function u(e){if(i(e)&&Boolean(e.data[n.PW])){return e.data[n.PW]}return null}},28607:(e,t,o)=>{"use strict";o.d(t,{gC:()=>s,jD:()=>a,o8:()=>u,Wn:()=>d});var r=o(48489),n=o(3126),i=o(63791);function a({serverUrl:e,project:t,author:o}){const r=(0,i.qi)(t.id,t.name),n=function(e){return e?`@${e.slug}`:"publish"}(o),a=`/${n}/${r}`;return{publishedProjectPath:a,publishedProjectUrl:`${e}${a}`}}function s({serverUrl:e,project:t,workspace:o,filePath:a,urlHash:s,notebookInDB:c}){const l=function(e){var t,o;if(e)return`/workspace/${(0,r.B)(e.id,e.name)}/project`;const n=null!==(t=null===(o=("undefined"!=typeof window?window.location.pathname:"/").match(/^\/workspace\/([^/]+)/))||void 0===o?void 0:o[0])&&void 0!==t?t:null;return`${null!=n?n:""}/project`}(o),u=(0,i.qi)(t.id,t.name),d=`${l}/${u}`,p=`${e}${d}`,f=s?`#${s}`:"";if(c){const e=`/notebook/${(0,n.AX)(c.id,c.name)}${f}`;return{projectSlug:u,projectUrl:d,fullProjectUrl:p,relativeUrlWithFile:d+e,fullUrlWithFile:p+e}}const g=a?`/${encodeURIComponent(a)}${f}`:`${f}`;return{projectSlug:u,projectUrl:d,fullProjectUrl:p,relativeUrlWithFile:d+g,fullUrlWithFile:p+g}}var c=o(61669),l=o.n(c);const u=e=>{if(!e)return null;let t;if(e.startsWith("https://raw.githubusercontent.com/")){const o=/^https:\/\/raw\.githubusercontent\.com\/([^/]+)\/([^/]+)(?:\/([^/]+)\/(.+)?)?/.exec(e);if(!o)return null;t={owner:o[1],repository:o[2],ref:o[3]?o[3]:"master",filePath:o[4]?o[4]:"/"}}const o=l()(e);if(o&&"github.com"===o.source&&(t={owner:o.owner,repository:o.name,ref:o.ref,filePath:o.filepath||"/"}),!t)return null;return/^[a-z\d](?:[a-z\d]|-(?=[a-z\d])){0,60}$/i.test(t.owner)&&/^[A-Za-z0-9_.-]{0,100}$/.test(t.repository)?t:null};function d(e){if(!e)return null;const{full_name:t}=l()(e),o=t.split("/"),r=o[0],n=o.slice(1),i=/^[A-Za-z0-9_.-]{0,100}$/;if(!/^[a-z_\d](?:[a-z_\d]|-(?=[a-z_\d])){0,60}$/i.test(r))return null;for(const e of n)if(!i.test(e))return null;return{owner:r,repository:n.join("/")}}},63376:(e,t,o)=>{"use strict";o.d(t,{C:()=>y,b:()=>m});var r=o(76699),n=o(26612),i=o(55075),a=o(51192),s=o(39486),c=o(51625);const l=["children","status","hasIcon"],u=["children"];function d(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,r)}return o}function p(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?d(Object(o),!0).forEach((function(t){f(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):d(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}function f(e,t,o){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var o=e[Symbol.toPrimitive];if(void 0!==o){var r=o.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function g(e,t){if(null==e)return{};var o,r,n=function(e,t){if(null==e)return{};var o,r,n={},i=Object.keys(e);for(r=0;r<i.length;r++)o=i[r],t.indexOf(o)>=0||(n[o]=e[o]);return n}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)o=i[r],t.indexOf(o)>=0||Object.prototype.propertyIsEnumerable.call(e,o)&&(n[o]=e[o])}return n}const h={info:{bg:"blue.50",border:"blue.200",text:"blue.950",icon:"blue.600"},success:{bg:"green.50",border:"green.200",text:"green.950",icon:"green.600"},error:{bg:"red.50",border:"red.200",text:"red.950",icon:"red.600"},warning:{bg:"yellow.50",border:"yellow.200",text:"yellow.950",icon:"yellow.600"},neutral:{bg:"gray.100",border:"gray.300",text:"gray.950",icon:"gray.600"}};function m(e){const{children:t,status:o="info",hasIcon:a=!1}=e,u=g(e,l);return(0,c.BX)(r.b,p(p({status:"neutral"===o?"info":o,p:4,borderRadius:"md",borderWidth:"1px",borderColor:h[o].border,bgColor:h[o].bg,color:h[o].text,fontSize:"xs",display:"flex",flexDirection:a?"row":"column",alignItems:"flex-start"},u),{},{children:[a&&(0,c.tZ)(n.z,{color:h[o].icon,as:"info"===o?s.G_m:void 0,boxSize:4,m:0,p:0}),(0,c.tZ)(i.xu,{ml:a?3:0,children:t})]}))}function y(e){const{children:t}=e,o=g(e,u);return(0,c.tZ)(a.x,p(p({fontWeight:600,pb:1},o),{},{children:t}))}},79314:(e,t,o)=>{var r={"./en-au":31321,"./en-au.js":31321,"./en-ca":78153,"./en-ca.js":78153,"./en-gb":5029,"./en-gb.js":5029,"./en-ie":38725,"./en-ie.js":38725,"./en-il":19734,"./en-il.js":19734,"./en-in":44520,"./en-in.js":44520,"./en-nz":61742,"./en-nz.js":61742,"./en-sg":79800,"./en-sg.js":79800};function n(e){var t=i(e);return o(t)}function i(e){if(!o.o(r,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return r[e]}n.keys=function(){return Object.keys(r)},n.resolve=i,e.exports=n,n.id=79314},31469:()=>{}}]);
//# sourceMappingURL=4252.bundle.f92475ba.js.map